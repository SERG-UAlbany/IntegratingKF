{"version":3,"sources":["assets/appstore.svg","assets/googleplaystore.png","assets/icon_note_blue.png","assets/icon_note_red.png","assets/icon_riseabove_blue.png","assets/icon_riseabove_red.png","assets/icon_attachment.gif","assets/icon_view.png","assets/sample_view.gif","store/api.js","store/userReducer.js","store/scaffoldReducer.js","store/dialogReducer.js","store/kftag.service.js","store/notifier.js","store/noteActions.js","store/async_actions.js","store/noteReducer.js","store/globalsReducer.js","legacy_api/user.js","config.js","components/Login/Login_helper.js","components/Login/LoginForm.jsx","components/Login/SignUpForm.jsx","components/CommunityView/TopNavbar.js","components/attachmentCollapse/AttachPanel.js","legacy_api/object.js","components/CommunityView/GraphView/GraphView_helper.js","components/CommunityView/GraphView/GraphView.jsx","store/access.js","components/NoteContent/NoteContent.js","store/riseAboveReducer.js","components/CommunityView/LightView/Notes.js","components/CommunityView/LightView/ListOfNotes.js","components/CommunityView/LightView/LightView.js","components/CommunityView/ViewSettingsPopover.jsx","components/dialog/Dialog.js","components/drawDialog/DrawTool.js","components/editor/MCEditor.js","components/scaffold/scaffold.service.js","components/scaffold/ScaffoldSelect.js","components/attachmentArea/AttachArea.js","components/writeTab/WriteTab.js","components/historyTab/History.js","components/propertiesTab/Properties.js","components/authorSelect/AuthorSelect.js","components/authorsTab/AuthorTab.js","components/annotator/annotator.service.js","store/store.js","components/annotator/Annotator.js","components/note/Note.js","components/dialog/NoteDialog.js","components/attachment/Attachment.js","components/dialog/AttachmentDialog.js","components/drawDialog/DrawDialog.js","components/dialogHandler/DialogHandler.js","components/modals/NewRiseAboveModal.js","WebSocket.js","components/CommunityView/View.js","components/Login/Login.jsx","components/Dashboard/Dashboard_helper.js","legacy_api/community.js","components/Dashboard/Dashboard.jsx","ProtectedRoute.jsx","App.js","index.js"],"names":["module","exports","url","localStorage","getItem","apiUrl","setServer","server","endsWith","substring","length","setItem","setToken","token","axios","defaults","headers","common","sessionStorage","getUser","a","get","data","postContribution","communityId","obj","post","getCommunity","putCommunity","object","put","getGroups","getCommunityViews","getLinks","objectId","direction","type","links","filter","each","putLink","linkId","link","postLink","fromId","toId","from","to","deleteLink","delete","linksSearch","query","getObject","putObject","postAttachment","authorId","newobj","title","authors","status","permission","version","postContribObject","getCommunityAuthors","getRecords","contribId","uploadFile","file","onProgress","formData","FormData","append","onUploadProgress","getViews","postView","getApiLinksReadStatus","viewId","then","result","body","results","i","push","catch","error","addUser","createAction","addAuthors","resetAuthors","userReducer","createReducer","state","action","payload","_id","forEach","author","fetchAuthors","dispatch","api","clearAuthors","requestScaffold","receiveScaffold","scaffoldReducer","isFetching","items","fetched","fetchScaffolds","contextId","scaffold_promise","res","Promise","all","scaffolds","map","scaffoldId","el","includes","supports","scaffold","openDialog","closeDialog","focusDialog","openAttachPanel","closeAttachPanel","dialogCounter","dialogReducer","dialogs","drawTool","focused","attachPanel","dlgs","dlg","id","zIndex","createScaffoldStartTag","isTemplate","tag","createScaffoldEndTag","createReferenceTag","contId","text","preProcess","toConnections","fromConnections","doc","jq","$","supportStart","find","addClass","elem","startsWith","hasClass","ref","conn","innerHTML","_from","supportEnd","references","_to","html","postProcess","contributionId","handler","endtags","supportLinksIds","supportStarts","supportEnds","toCreate","supportStartsIds","supportId","split","oldId","newId","toDeleteSupports","referenceLinksIds","kfReferences","kfreferenceIds","referenceId","toDeleteReferences","notifConfig","insert","container","animationIn","animationOut","dismiss","duration","addNotification","notif","store","addRAView","removeRAView","addToRAView","createView","options","registerToCommunity","newView","community","views","makeRiseabove","note","riseabove","noteModified","loadRiseAboveData","viewLinks","readLinks","addNote","removeNote","editNote","addAttachment","removeAttachment","setAttachments","setWordCount","setLinks","setRecords","removeContribAuthor","addContribAuthor","setAnnotation","setAnnotationsLoaded","removeAnnotation","setViewNotes","addViewNote","setCheckedNotes","updateCheckedNotes","setViewLinks","addViewLink","setBuildsOn","setReferences","setSupports","setRiseAboveViewNotes","setRiseAboveNotes","setReadLinks","removeViewLink","removeViewNote","noteReducer","attachments","viewNotes","checkedNotes","buildsOn","riseAboveNotes","riseAboveViewNotes","raViews","notes","Object","assign","noteId","attachment","att","attId","wordCount","wc","contrib","fromLinks","toLinks","records","auth","annos","annotation","value","annoId","checked","createNote","contextMode","content","mode","group","_groupMembers","undefined","buildson","langInNote","docId","myself","coauthors","ca","createdBy","docShared","text4search","window","alert","newNote","view","newN","x","y","confirmButton","editable","buildOnNote","getState","globals","fetchAttachments","link_atts","attach","dialogId","message","wasActive","prev_text","fetchBuildsOn","fetchLinks","viewLink","fetchRecords","users","formatter","Intl","DateTimeFormat","dateFormatOptions","record","firstName","lastName","format","Date","timestamp","openContribution","isDemo","noteBody","role","buildOn","annoLinks","annLink","anno","modelId","annot","fetchViewNotes","noteLinks","linksMap","reduce","filteredObj","riseAboveNoteIds","lnk","buildOnResult","reverse","filteredBuildOn","fetchReferences","filteredReferences","fetchSupports","fetchReadLinks","setDemoStatus","setGlobalToken","setCurrentLoginForm","setCommunity","setCommunitySettings","setCommunityId","setCurrentServer","setViewId","setLoggedUser","setView","setCurrViewSettingsObj","setAuthor","setViews","editCommunity","setUserId","setIsAuthenticated","setCommunities","setUserCommunities","setSearchQuery","setSearchFilter","setSocketStatus","year","month","day","hour","minute","second","hour12","initState","currentLoginForm","currentServer","user","currViewSettingsObj","language","showAuthor","showGroup","showTime","thisViewsViewSettingsObj","communityViewSettingsObj","communitySettings","userId","isAuthenticated","communities","userCommunities","searchQuery","searchFilter","servers","key","socketStatus","globalsReducer","viewSetting","rootContextId","fetchAuthor","getAuthor","fetchCommunitySettings","fetchCommGroups","groups","fetchLoggedUser","clear","location","replace","fetchCommunityViews","fetchViewCommunityData","commId","getUserTokenServerPair","username","password","fetch","method","JSON","stringify","response","console","log","json","SERVERS","name","DEMOSERVER","getServerName","getServerURL","extractTokenFromStorage","uname","parse","executePromises","pwd","login_form_component","promises","document","getElementById","userStorage","successfulLogin","errorMessage","serverTokenPair","viewPreference","label","removeItem","style","display","setState","responseHandler","getLoginData","server_data","LoginForm","props","inputChangeHandler","event","target","val","formSubmitHandler","preventDefault","history","openSignUpForm","tooltip","popover","width","setAttribute","className","onSubmit","this","autoComplete","placeholder","required","onChange","htmlFor","tabIndex","data-toggle","data-trigger","data-content","color","onClick","href","src","app_store","alt","marginLeft","googleplay_store","Component","mapDispatchToProps","compose","withRouter","connect","SignUpForm","serverSelectHandler","singaporeSelected","test","confirmPassword","firstname","lastname","email","registrationKey","postNewUser","resultErrorMessage","errorCode","openLoginForm","verifyRecaptcha","recaptchaVerified","userAuthenticationMethod","signUpButton","sitekey","disabled","s","classNamePrefix","minLength","maxLength","TopNavbar","handleFilter","e","handleInputChange","handleSearchSubmit","signUp","handleChange","bind","Authorization","onViewClick","prevProps","prevState","currentView","reset","searchInput","userName","Input","support","j","defaultValue","values","sort","b","aName","toLowerCase","bName","Navbar","Button","goToDashboard","Brand","communityTitle","Text","Nav","Form","FormGroup","InputGroup","InputGroupAddon","addonType","InputGroupText","cursor","Link","logout","ownProps","AttachPanel","useSelector","useDispatch","useState","progress","setProgress","handleClose","onClose","onFileSelect","fileList","files","Array","upload_promises","indexOf","_URL","URL","webkitURL","addImageProcess","createObjectURL","img","naturalWidth","height","naturalHeight","createAttachment","resolve","reject","createElement","onload","onerror","attachRes","uploadRes","filename","tmpFilename","newAttachment","linkToNote","linkToView","inlineAttach","data_mce_src","serverUrl","onNewInlineAttach","attach_type","newX","newY","w","h","showInPlace","progressEvent","percentCompleted","Math","round","loaded","total","Modal","show","onHide","Header","closeButton","Title","Body","File","FileDrop","onFrameDragEnter","onFrameDragLeave","onFrameDrop","onDragOver","onDragLeave","onDrop","ProgressBar","now","Footer","variant","getApiObjectsObjectId","handleNote","nodeData","authorData","viewSettings","readStatus","authorName","matchAuthorId","date","parseDate","created","groupName","isPositionLocked","draggable","canOpen","fixed","kfId","locked","classes","nodeClass","position","handleAttachment","nodes","String","imageUrl","slice","bounds","createCytoscapeId","download","handleDrawing","DOMParser","parseFromString","svg","aspect_ratio","childNodes","attributes","node_height","parseInt","encodeURIComponent","handleView","authorsInfo","has","set","Cytoscape","use","CytoscapePanZoom","CytoscapeNodeHtmlLabel","CytoscapeSupportImages","CytoscapeContextMenus","CytoscapeSpread","GraphView","elements","edges","kfToCyMap","removedSearchElements","removedBoxSelectElements","removedEdgeElements","currViewLinksLength","loadElements","supportImageIsDuplicate","compareSupportImages","findCyIdsFromKfId","updateReadLinks","focusRecentAddition","filterNodes","handleNodeOpen","getViewSettingsInfo","updateViewSettings","runLayout","prevViewLinksLength","forceRender","keys","si","cy","supportimages","Map","_private","supportImages","graph_nodes","addNodesToGraph","graph_edges","edgeData","concat","fromCount","toCount","k","source","initialDisplay","addEdgesToGraph","self","graph_results","cy_elements","initialRemovedEdgeElements","images","addSupportImage","renderer","redraw","imgs","cytoscapeIds","countInstances","batch","cy_elems","isRiseAbove","classToRemove","classToAdd","removeClass","cyIds","newestCyElem","on","q","restore","setImageVisible","nodesToHide","collection","elem_type","elem_title","English","cy_ids","union","elem_author","noteIds","curr_date","elem_date","secondsDiff","remove","evt","cy_node","onNoteClick","add","newInfo","edgesToHide","layoutType","layout","animate","prelayout","run","zoomFactor","zoomDelay","minZoom","maxZoom","fitPadding","panSpeed","panDistance","panDragAreaSize","panMinPercentSpeed","panInactiveArea","panIndicatorMinOpacity","zoomOnly","fitSelector","animateOnFit","fitAnimationDuration","sliderHandleIcon","zoomInIcon","zoomOutIcon","resetIcon","panzoom","evtType","menuItems","selector","onClickFunction","coreAsWell","contextMenus","nodeHtmlLabel","halign","valign","halignBox","valignBox","cssClass","tpl","updateParentLayoutProp","newViewLink","updateViewLink","setTimeout","dragging","b1","b2","cases","anyPropUpdated","currViewLinkUpdated","switchedToEmptyView","searchTriggered","viewSettingsChanged","layoutChanged","CytoscapeComponent","normalizeElements","stylesheet","unread_note_icon","read_note_icon","unread_riseabove_icon","read_riseabove_icon","attachment_icon","view_icon","hideEdgesonViewport","textureOnViewPort","autolock","selectable","wheelSensitivity","authorRequirementTable","private","r","protected","public","isAuthorOrGroupMember","isAuthor","isGroupMember","isEditable","requiredPermission","fullfillRequirement","NoteContent","noteList","handleSubmit","addView","viewError","topleft","config","min","Axios","visible","handleRiseAbove","noOfNotes","confirm","createRiseAbove","getRiseAboveNotes","riseAboveId","openNote","persist","Row","Col","md","Alert","isOpen","RiseAboveNotes","EditNoteButton","index","access","dangerouslySetInnerHTML","__html","riseAboveNoteId","noteResponse","putResponse","objId","linkRes","Notes","authorObj","setOpen","open","checkNote","updateNoteMobile","isCheckedMobile","showNote","riseAboveData","NoteMobile","hasChildren","children","icon","medium","up","aria-controls","aria-expanded","isChecked","Collapse","in","hierarchy","small","down","ListOfNotes","getNotes","LightView","showView","showRiseAbove","filteredData","getBuildOnHierarchy","onCloseDialog","onConfirmDrawDialog","filterResults","parent","child","final_h","entries","showModel","drawing","addDrawing","closeDrawDialog","filteredResults","some","note_date","sm","clearSearch","ViewSettingsPopover","tempViewSettingObj","thisViewsViewSettingObj","initializeSettings","handleViewTypeChange","handleViewSettingsChange","toggleViewSettingEnable","pushViewSettingsChange","pushCommunitySettingsChange","temp","switchView","domElem","parentNode","siblings","newObject","updateViewObject","updateCommunityContextObject","thisViewsViewSettingEnabled","OverlayTrigger","placement","trigger","delay","hide","rootClose","overlay","Popover","Content","Accordion","defaultActiveKey","Card","Toggle","as","eventKey","dialog_style","Dialog","default","pageXOffset","pageYOffset","onMouseDown","dragHandleClassName","alignItems","size","onConfirm","buildon","onBuildOnClick","DrawTool","onLoad","getIframeRef","wnd1","iframe_ref","contentWindow","bg","svgCanvas","current_drawing_","all_layers","wnd2","widd","getBBox","heig","svgElem_","selectAllInCurrentLayer","groupSelectedElements","alignSelectedElements","ungroupSelectedElement","clearSelection","setResolution","getSvgString","canvas","ctx","getContext","btoa","drawImage","p","toDataURL","frame","setSvgString","React","MCEditor","apiKey","init","setup","editor","onEditorSetup","content_css","menubar","statusbar","media_live_embeds","plugins","external_plugins","toolbar","onEditorChange","addHyphen","initText","supportContentId","getTime","toString","ScaffoldSelect","scaffoldSelected","returnSupport","onScaffoldSelected","addhyphen","initialText","scaffold_text","tagCreator","scaffoldService","selected","initVal","onSelectChange","Container","Group","controlId","Control","AttachArea","atts","selectedImgs","setSelectedImgs","onNewAttachClick","getElementsByClassName","tagName","getAttribute","classList","cls_name","downloadUrl","onAttachDelete","WriteTab","onNewAttachmentClick","inline","attachId","deleteAttach","History","acc","read","edit","Properties","onPermissionChange","contribution","AuthorSelect","select_options","selectedOption","setSelectedOption","isClearable","onAuthorSelected","AuthorTab","communityAuthors","group_options","g","contribGroup","idx","removeAuthor","setKFPlugin","annotatorHandler","scaffoldElement","Annotator","Plugin","KFPlugin","pluginInit","annotator","subscribe","annotationCreated","annotationUpdated","annotationDeleted","displayEditor","viewer","annotations","displayViewer","editorHidden","annotatorInitialized","__hasProp","hasOwnProperty","RichText","_super","call","ctor","constructor","prototype","__super__","__extends","editorId","element","apply","arguments","tinymce","toolbar_items_size","extended_valid_elements","supported","addField","load","updateEditor","updateViewer","ed","mceditor","activeEditor","getContent","css","ReactDOM","unmountComponentAtNode","scaffoldSidebar","ui","registry","addSidebar","onSetup","sidebar","overflow","fontSize","render","onShow","field","count","editors","setContent","textDiv","permissions","update","admin","showEditPermissionsCheckbox","vm2m","isPublic","loc","ranges","start","end","configureStore","reducer","devTools","contentRef","createRef","fixPopupLocation","loadAnnotations","annotatedElem","current","scaffoldElem","annotPlugins","onDelete","containerId","annotsFetched","off","annots","highlights","onAnnotsLoaded","$element","attr","adder","observer","MutationObserver","mutationsList","takeRecords","observe","attributeOldValue","onCreate","onUpdate","invert","popup","dlgOffset","offset","ppOffset","top","left","selection","insertContent","contentTag","dom","setCursorLocation","Note","selectedTab","onNoteChange","onTabSelected","onAnnotationCreated","onAnnotationDeleted","onAnnotationUpdated","snapshot","onDrawingInserted","addSupport","deleteAttachment","select","wordcount","getCount","labels","numwords","scaffoldWordCount","onDrawButton","onDrawToolOpen","tab","createAnnotation","noteAuthor","deleteAnnotation","model","modifyAnnotation","modified","Tabs","activeKey","onSelect","Tab","mountOnEnter","dlgId","raViewLinks","raReadLinks","ann","anno_updated","att_link","currentAuthor","NoteDialog","dialog","reduxNote","setNote","setDrawTool","setSvg","setDrawing","useEffect","prevNote","noteChanged","Attachment","attachAuthor","setSelectedTab","transition","AttachmentDialog","attachmentChanged","DrawDialog","drawingAuthor","onDialogClose","drawingChanged","wnd","point","fill","newDrawing","svgCanvasToString","onDialogConfirm","DialogHandler","onFocusDialog","useCallback","elt","NewRiseAboveModal","setTitle","riseAboveTitle","WebSocketContext","createContext","socket","ws","syncUpdates","modelName","item","subscribeToView","emit","openConnection","sync","io","path","unsyncUpdates","removeAllListeners","unsubscribeToView","disconnect","Provider","View","handleNewViewInput","clearGraphViewProps","nextView","renderTooltip","Tooltip","updateLayout","demoCommunityTitle","showModal","showAttachPanel","showRiseAboveModal","handleNewViewSubmit","handleShow","match","params","context","fetchNewViewDifference","pathname","addViewUrl","newViewId","viewsObj","linkObj","reload","viewToRender","DropdownButton","drop","Dropdown","Item","Label","varient","myViews","contextType","Login","modalContent","modalDialogClassName","toggleFullScreenModal","getUserToken","newClass","formToRender","sample_view","dialogClassName","padding","loadServer","dashboard_component","getUserCommunities","compareStrings","_community","userCommunityData","currentServerURL","updateUserCommunities","getUserInfo","getCommunities","serverCommunityData","community_options","c","updateCommunities","joinCommunity","postCommunityRegistration","joinCommunityErrorMessage","userinfo","toggleSidebar","div","Dashboard","domElement","serverName","innerText","serverURL","serverTokenPairs","currentServerName","activeServerURL","viewType","handleViewChange","selectedViewType","newServerTokenPair","handleCommunityDropDownChange","selectedCommunityToJoin","serverList","communityRegistrationKey","enterCommunity","welcomeViewId","aTag","appendChild","click","class","appendUserServers","isSearchable","data-target","aria-label","ProtectedRoute","component","rest","loggedIn","App","exact","WebSocket"],"mappings":"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","file":"static/js/main.101aadc5.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/appstore.9eadb2de.svg\";","module.exports = __webpack_public_path__ + \"static/media/googleplaystore.10b871ef.png\";","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAYAAAAe2bNZAAAACXBIWXMAAC4jAAAuIwF4pT92AAAGaGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDAgNzkuMTYwNDUxLCAyMDE3LzA1LzA2LTAxOjA4OjIxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoTWFjaW50b3NoKSIgeG1wOkNyZWF0ZURhdGU9IjIwMTgtMDYtMjFUMTE6Mjc6NDYtMDU6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDE4LTA5LTEyVDE2OjU4OjM1LTA1OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDE4LTA5LTEyVDE2OjU4OjM1LTA1OjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgcGhvdG9zaG9wOklDQ1Byb2ZpbGU9InNSR0IgSUVDNjE5NjYtMi4xIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjEyZTJiMzk4LThjNzQtNDE1OS1iNTRiLTQxNjNhZGNiNmY4MyIgeG1wTU06RG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOmM5Y2JkYzI3LTEwYmMtOWQ0Yy05MjFmLTg1MGRjOTBmZTAwNiIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjk3YjYxMzJlLTM1ZGItNDE3OS04MDMyLTYxMWRkMWYwNzVhYSI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6OTdiNjEzMmUtMzVkYi00MTc5LTgwMzItNjExZGQxZjA3NWFhIiBzdEV2dDp3aGVuPSIyMDE4LTA2LTIxVDExOjI3OjQ2LTA1OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoTWFjaW50b3NoKSIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY29udmVydGVkIiBzdEV2dDpwYXJhbWV0ZXJzPSJmcm9tIGFwcGxpY2F0aW9uL3ZuZC5hZG9iZS5waG90b3Nob3AgdG8gaW1hZ2UvcG5nIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDoxMmUyYjM5OC04Yzc0LTQxNTktYjU0Yi00MTYzYWRjYjZmODMiIHN0RXZ0OndoZW49IjIwMTgtMDktMTJUMTY6NTg6MzUtMDU6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE4IChNYWNpbnRvc2gpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDwvcmRmOlNlcT4gPC94bXBNTTpIaXN0b3J5PiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pia9hzQAAAD6SURBVFiF7dY/SgNBGIbx366LghqCf25kG1MJXsMDeAjxGFqaFCnU0kN4B1MZsDEW7sJImDVCxkkxT/OywzfwzAffzFYn149j3OJYPua4anCP3YwiMMBdjSazSEdV4z23Rcuizm0QUmRiFJkYRSZGkYlRZGIUmRhFJkaRibFNMoPU/7/PeMFyjdqPlDJPOPvLhpQyszYrDNvsYyelzGGbQ7xiv6e2wl5KmTrI0zXqp/8xTUssfql5wGgbRnuCMfnvmSnOu4+cMhOMwoVcMj860lHrH7lNEd7AKx0JZT4TCYSHPAhEVjrS0eASNzjasMy8zRpvvt+pi74NXzMDHXjf0mfDAAAAAElFTkSuQmCC\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAYAAAAe2bNZAAAACXBIWXMAAC4jAAAuIwF4pT92AAAKp2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDAgNzkuMTYwNDUxLCAyMDE3LzA1LzA2LTAxOjA4OjIxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIiB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoTWFjaW50b3NoKSIgeG1wOkNyZWF0ZURhdGU9IjIwMTgtMDYtMjFUMTE6Mjc6NDYtMDU6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDE4LTA5LTEyVDE4OjA1OjUwLTA1OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDE4LTA5LTEyVDE4OjA1OjUwLTA1OjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgcGhvdG9zaG9wOklDQ1Byb2ZpbGU9InNSR0IgSUVDNjE5NjYtMi4xIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOmExYzgwOTQwLTIzMjYtNDc4NS05ZTA0LWE0MDJjMDdiNDI2ZCIgeG1wTU06RG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjcyNzMyNjhjLTE1OTEtYzA0Mi1iM2IxLWM5NjVhNzE5MzRkOCIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjcwMTg5MDJiLTU5YjctNDNkNy1iODc1LTk5YmUyNTM2MWJiNCIgdGlmZjpPcmllbnRhdGlvbj0iMSIgdGlmZjpYUmVzb2x1dGlvbj0iMzAwMDAwMC8xMDAwMCIgdGlmZjpZUmVzb2x1dGlvbj0iMzAwMDAwMC8xMDAwMCIgdGlmZjpSZXNvbHV0aW9uVW5pdD0iMiIgZXhpZjpDb2xvclNwYWNlPSIxIiBleGlmOlBpeGVsWERpbWVuc2lvbj0iMTg3MSIgZXhpZjpQaXhlbFlEaW1lbnNpb249IjE4NzEiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjcwMTg5MDJiLTU5YjctNDNkNy1iODc1LTk5YmUyNTM2MWJiNCIgc3RFdnQ6d2hlbj0iMjAxOC0wNi0yMVQxMToyNzo0Ni0wNTowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggKE1hY2ludG9zaCkiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjBiYzRiZGFkLTVkNTQtNDAzYS1iNGIwLWY0ZmViZTgyNzM0YSIgc3RFdnQ6d2hlbj0iMjAxOC0wOS0xMlQxODowMDozMi0wNTowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmMxM2M1OWI3LWE1MmItNDdkZC1hMmUwLTE3M2E1MGY3OGEyNCIgc3RFdnQ6d2hlbj0iMjAxOC0wOS0xMlQxODowNTo1MC0wNTowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmExYzgwOTQwLTIzMjYtNDc4NS05ZTA0LWE0MDJjMDdiNDI2ZCIgc3RFdnQ6d2hlbj0iMjAxOC0wOS0xMlQxODowNTo1MC0wNTowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOmMxM2M1OWI3LWE1MmItNDdkZC1hMmUwLTE3M2E1MGY3OGEyNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo3MDE4OTAyYi01OWI3LTQzZDctYjg3NS05OWJlMjUzNjFiYjQiIHN0UmVmOm9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo3MDE4OTAyYi01OWI3LTQzZDctYjg3NS05OWJlMjUzNjFiYjQiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7C07tpAAAA+0lEQVRYhe3WMUoDQRSH8d+ui4IaguKBBNuYSvAatt5CPIaWJkUaLT2BlXcwlQEbY+EujIRZI2ScFPM1f3Z4A988eDNbvVyfjnGLY/mY46rBPXYzisAAdzWazCIdVY333BYtizq3QUiRiVFkYhSZGEUmRpGJUWRiFJkYRSbGNskMUv//PuEZyzVqP1LKPOLsLxtSyszarDBss4+dlDKHbQ7xiv2e2gp7KWXqIE/WqJ/+xzQtsfil5gGjbRjtCcbkv2emOO8+cspMMAoXcsn86EhHrX/kNkV4A690JJT5TCQQHvIgEFnpSEeDS9zgaMMy8zZrvPl+py76NnwBLFcduiEp6KQAAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAYAAAAe2bNZAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAJ/mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDAgNzkuMTYwNDUxLCAyMDE3LzA1LzA2LTAxOjA4OjIxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDE4LTA5LTEyVDIxOjI1OjE0LTA1OjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxOC0wOS0xMlQyMTo1MjozNC0wNTowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAxOC0wOS0xMlQyMTo1MjozNC0wNTowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoxYWYyNTA0Yy1hMDg0LTQwZDAtOTBjYi00N2VjOTM3MDk5MGIiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDo0NmM4MjBiYi01NGUyLTYxNDgtODE0Ny04ZGI2N2MxYjlkYzQiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDoxZTRlNGRmMi0zYjYwLTQ0OWQtOWY1OS1hZDBlZjExMWNlMDMiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjFlNGU0ZGYyLTNiNjAtNDQ5ZC05ZjU5LWFkMGVmMTExY2UwMyIgc3RFdnQ6d2hlbj0iMjAxOC0wOS0xMlQyMToyNToxNC0wNTowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggKE1hY2ludG9zaCkiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBpbWFnZS9wbmcgdG8gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6M2E4ZGZjNmQtZmVkNC00MzI4LTgzMjgtMzRmY2M2YjIyMzExIiBzdEV2dDp3aGVuPSIyMDE4LTA5LTEyVDIxOjM4OjQ1LTA1OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoTWFjaW50b3NoKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6MjZlZDljYjYtOGJlZi00NDllLWI2NzQtNzZiYzAzNDIxYjY0IiBzdEV2dDp3aGVuPSIyMDE4LTA5LTEyVDIxOjUyOjM0LTA1OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoTWFjaW50b3NoKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY29udmVydGVkIiBzdEV2dDpwYXJhbWV0ZXJzPSJmcm9tIGFwcGxpY2F0aW9uL3ZuZC5hZG9iZS5waG90b3Nob3AgdG8gaW1hZ2UvcG5nIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJkZXJpdmVkIiBzdEV2dDpwYXJhbWV0ZXJzPSJjb252ZXJ0ZWQgZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6MWFmMjUwNGMtYTA4NC00MGQwLTkwY2ItNDdlYzkzNzA5OTBiIiBzdEV2dDp3aGVuPSIyMDE4LTA5LTEyVDIxOjUyOjM0LTA1OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoTWFjaW50b3NoKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MjZlZDljYjYtOGJlZi00NDllLWI2NzQtNzZiYzAzNDIxYjY0IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjFlNGU0ZGYyLTNiNjAtNDQ5ZC05ZjU5LWFkMGVmMTExY2UwMyIgc3RSZWY6b3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjFlNGU0ZGYyLTNiNjAtNDQ5ZC05ZjU5LWFkMGVmMTExY2UwMyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pu/x7K8AAAkXSURBVFiFvVhpkFxVFf7OuW/r6WV6m+7ZiBIlBAOCLGICkigVBUeBKiuSgCguP4JQSgGJCEFERYkkJD9iWSWLUJRYgiAoUQqK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\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAYAAAAe2bNZAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAJ/mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDAgNzkuMTYwNDUxLCAyMDE3LzA1LzA2LTAxOjA4OjIxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDE4LTA5LTEyVDIxOjI1OjE0LTA1OjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxOC0wOS0xMlQyMTo0ODoyNC0wNTowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAxOC0wOS0xMlQyMTo0ODoyNC0wNTowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDowZmU3NjVjNi01NjhmLTRhY2UtYTVlMi1kMjJmMDA5NDBiNmMiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDpiODQwOTQzYS1iNjliLTdhNDItODNiZS0zOTY2YWEwNmIxMDQiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDoxZTRlNGRmMi0zYjYwLTQ0OWQtOWY1OS1hZDBlZjExMWNlMDMiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjFlNGU0ZGYyLTNiNjAtNDQ5ZC05ZjU5LWFkMGVmMTExY2UwMyIgc3RFdnQ6d2hlbj0iMjAxOC0wOS0xMlQyMToyNToxNC0wNTowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggKE1hY2ludG9zaCkiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBpbWFnZS9wbmcgdG8gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6M2E4ZGZjNmQtZmVkNC00MzI4LTgzMjgtMzRmY2M2YjIyMzExIiBzdEV2dDp3aGVuPSIyMDE4LTA5LTEyVDIxOjM4OjQ1LTA1OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoTWFjaW50b3NoKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6NTdmMzAzOWEtODMwNC00MDhlLWI2ZDQtNjRhNTczZGZlNTNiIiBzdEV2dDp3aGVuPSIyMDE4LTA5LTEyVDIxOjQ4OjI0LTA1OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoTWFjaW50b3NoKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY29udmVydGVkIiBzdEV2dDpwYXJhbWV0ZXJzPSJmcm9tIGFwcGxpY2F0aW9uL3ZuZC5hZG9iZS5waG90b3Nob3AgdG8gaW1hZ2UvcG5nIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJkZXJpdmVkIiBzdEV2dDpwYXJhbWV0ZXJzPSJjb252ZXJ0ZWQgZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6MGZlNzY1YzYtNTY4Zi00YWNlLWE1ZTItZDIyZjAwOTQwYjZjIiBzdEV2dDp3aGVuPSIyMDE4LTA5LTEyVDIxOjQ4OjI0LTA1OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoTWFjaW50b3NoKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NTdmMzAzOWEtODMwNC00MDhlLWI2ZDQtNjRhNTczZGZlNTNiIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjFlNGU0ZGYyLTNiNjAtNDQ5ZC05ZjU5LWFkMGVmMTExY2UwMyIgc3RSZWY6b3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjFlNGU0ZGYyLTNiNjAtNDQ5ZC05ZjU5LWFkMGVmMTExY2UwMyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PotzvqwAAAlFSURBVFiFxVhpkF1FFf7O6b7v3vu2mSSTbTKTmYTJPkkGCISlCFjBsIiouEAoUNSSkooiGFNlJQiFSyRKAqXID1ZTilJlEbFY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\"","module.exports = \"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAArCAYAAADyijE0AAAACXBIWXMAAC4jAAAuIwF4pT92AAAKp2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDAgNzkuMTYwNDUxLCAyMDE3LzA1LzA2LTAxOjA4OjIxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIiB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoTWFjaW50b3NoKSIgeG1wOkNyZWF0ZURhdGU9IjIwMTgtMDYtMjFUMTE6Mjc6NDYtMDU6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDE4LTExLTE4VDE1OjQyOjQ3LTA2OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDE4LTExLTE4VDE1OjQyOjQ3LTA2OjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgcGhvdG9zaG9wOklDQ1Byb2ZpbGU9InNSR0IgSUVDNjE5NjYtMi4xIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOmJjZmIyYjEwLWEzZmEtNDEzNC04MTRlLWFkOTk1MzY0YWI2MSIgeG1wTU06RG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjE4MzhiYWEzLTQ0OTEtODU0MC1hZDBkLTZlNDYxYjg1Y2FmNyIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOmMyZmRkYmUwLTkxNTktNDUzZi1hNTc0LTQyYWJlMjJmM2ViOCIgdGlmZjpPcmllbnRhdGlvbj0iMSIgdGlmZjpYUmVzb2x1dGlvbj0iMzAwMDAwMC8xMDAwMCIgdGlmZjpZUmVzb2x1dGlvbj0iMzAwMDAwMC8xMDAwMCIgdGlmZjpSZXNvbHV0aW9uVW5pdD0iMiIgZXhpZjpDb2xvclNwYWNlPSIxIiBleGlmOlBpeGVsWERpbWVuc2lvbj0iMTg3MSIgZXhpZjpQaXhlbFlEaW1lbnNpb249IjE4NzEiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmMyZmRkYmUwLTkxNTktNDUzZi1hNTc0LTQyYWJlMjJmM2ViOCIgc3RFdnQ6d2hlbj0iMjAxOC0wNi0yMVQxMToyNzo0Ni0wNTowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggKE1hY2ludG9zaCkiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjRjNTVlYzUyLTNhMmItNDU4NC04ZWJmLThhNWQ5ODFmNGNhYiIgc3RFdnQ6d2hlbj0iMjAxOC0xMS0xOFQxNTozOTozOC0wNjowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjQzZjE3NmNiLWFhMGYtNDZkYS1iZTk1LTczZjUyNTI2MGZkOCIgc3RFdnQ6d2hlbj0iMjAxOC0xMS0xOFQxNTo0Mjo0Ny0wNjowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmJjZmIyYjEwLWEzZmEtNDEzNC04MTRlLWFkOTk1MzY0YWI2MSIgc3RFdnQ6d2hlbj0iMjAxOC0xMS0xOFQxNTo0Mjo0Ny0wNjowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjQzZjE3NmNiLWFhMGYtNDZkYS1iZTk1LTczZjUyNTI2MGZkOCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpjMmZkZGJlMC05MTU5LTQ1M2YtYTU3NC00MmFiZTIyZjNlYjgiIHN0UmVmOm9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpjMmZkZGJlMC05MTU5LTQ1M2YtYTU3NC00MmFiZTIyZjNlYjgiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7y32vAAAADuklEQVRYhe2YTWhjVRTHf/e+jzRtMglaW1tSptC0tpShC0EQKqUutG6qojgrF8Iwiu4GcSEuFXfqTgYd7FpBMLNxNkJFunDRLrIouugH/bax9pm2JO+93DuL5MUmmYQOzWu78L+5eSfn8n7v3nPOe/cIrTUAs7Oz1EkAt4BpQAIOcA/4vd4xUCaTafbXmWQ2sSeBB8BzdfbbwCfAZ+e662PAJIA/gaeAPeCryvgC8A7wKdAPfNBuGPkI290KyDzwLHAIjALfAS9XfN4HXgobpge4Wfn9IfAD8DXwEfArkALuACil3jVNk46ODrTWKKXaB1MoFJBSjmqtkVJmDMN4TWv9PDCvtb5VcfsmmBOJRJ45OjpiZWUF0zTp6upqH8zAwAD5fF7bto3jOEe7u7v9AK7rfuF53j2lVEZKKT3Pu1YoFDAMw8hms2xtbWHbNqVS6dwwYm5u7gngY63106urq/2Li4vTsVhs3TAMXSqVBoeGhuaHh4dXFhYWXtzY2Lg+MjKS3dzcvBGNRv+dmpr6CZCWZbnn5PgH+NwEXgfei0ajXd3d3eRyOfr6+q7PzMzgOA5CiKlEIjFlWRa5XI7p6ekbk5OT5PP5a7Ztv62Uake8nAB/mMC3AL7vo5RCCAGAYRhEIhG01ggh0FoTFEjLsrBtu8Z2TnUCd03ABWwhBL7vA6C1xvM8fN9Ha12NByEESil836/6tlGuBIrBValUqt78dEC6rovrukhZjnfP89oNAlCsZpPneViWhRACKWV1VQCKxSK2bSOlrFmpdqum6AUxUB8HpmkihKiuSAhb1AjTSgFgEOBXAiZMnRnmInS1YZRSmKaJZVn/OUmJZVkopULdroZsqrwoOT4+rtpd18VxHGzbDg2kASYej9Pb28vh4SHr6+tV+87ODnt7eySTSTo7O0PLqJrPzkgkQjqdJpvNsrS0xNraGkII9vf3UUoxMTFBMpkMbasavoHHxsYQQrC8vMzBwQFQjpl0Os34+DjRaJSTk5OLgQEYHR0lFouxvb0NQE9PD4ODg0A5fsJSs6MKqVSKVCrVYA/rVQBXvc5cpv6HaaarBBNvmk1t0s/Ab8BZqmQxTJgHwCuPMyFMmF8qowSepNzvaSUZJky8MiaAFcpno2YSgAgTRpwaY2fw//4isklTPr620o/AzauQ2hngDbj8OpMBXg0uLhOmBgQuD+Z+PQiUYVqlXLt0ugLfBxqazgHM+TuDj9bphwwafk1BoFyB3wS+pNyIbqf+rowS+ItyK/etVhMeAuZkZDAeOcH2AAAAAElFTkSuQmCC\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAYAAAAe2bNZAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAGAGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDAgNzkuMTYwNDUxLCAyMDE3LzA1LzA2LTAxOjA4OjIxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoTWFjaW50b3NoKSIgeG1wOkNyZWF0ZURhdGU9IjIwMTgtMDktMTJUMjI6MDk6NDctMDU6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDE4LTA5LTEyVDIyOjIxOjM5LTA1OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDE4LTA5LTEyVDIyOjIxOjM5LTA1OjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgcGhvdG9zaG9wOklDQ1Byb2ZpbGU9InNSR0IgSUVDNjE5NjYtMi4xIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjYxYmMzYjk1LWE4ZDItNDFjZC1iMTFhLTFjMzY3NWYxY2IyZiIgeG1wTU06RG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOmUxMGM5NWJkLWI1NmEtNzI0Zi1hMzJlLTJjZTk1NDRmMDljNCIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjhhZDQ5Y2Q5LWMyZGEtNGMxYi1iMmJhLTBiZDZiMjJmZmM5MyI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6OGFkNDljZDktYzJkYS00YzFiLWIyYmEtMGJkNmIyMmZmYzkzIiBzdEV2dDp3aGVuPSIyMDE4LTA5LTEyVDIyOjA5OjQ3LTA1OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoTWFjaW50b3NoKSIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6NjFiYzNiOTUtYThkMi00MWNkLWIxMWEtMWMzNjc1ZjFjYjJmIiBzdEV2dDp3aGVuPSIyMDE4LTA5LTEyVDIyOjIxOjM5LTA1OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoTWFjaW50b3NoKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6mqJQFAAADHklEQVRYhc2YTWhcVRSAv3Pfve/NNKbtdNKg0bQlFUOxakyVlnZR6EbQVTciFMSli26qBTei0B/cZO1OsHTjTkRcuZAKarASNG1J29CKEap2TJqQSTLv597r4iWDSnWmneFNDjzeD+ee93Huuefcc8V7z2YRKR85QbT/2Nuq8vgoNhY8RdIJJvJu6e7t5MqXE9qMHDird4+96xvL4KMCOZo4mOGn8Y3lIam+d8mLUvgsKR5kQwIDgALf8GncOxCALAFn1xTOpoj0FkYEvMtUbyn+Kbr5JAKioMilnnuk+U/d/GhTkAB0mCsUAWIzcFkewN6vwwSGiVf2Xnnj4K5nUmtrUEQMeUwQ7Pzkh1+nTn4xN04Wr8PYjKHtfXUAEwQ7CyBpyhPV/jo2BaAZwGmWhUVCbEiSZs1Mu6lWU9dgZq99ytLibx3Z6BrM4t3P+Xnmo45sdA1Gm3727fqO6W/eZKW+0FuYJDX8uZAwsPU2tZuvMjP92QPb0K0Urk5dRPvrxMm/M3P+LgJZllBWP1FfcaSZpxwpquUP+fHbSZ49dA6lgu7AlN3HlMKAsvrvrCwlYXXNkWUeJdCIHXGS8FhlitnLx4mq77DnySOdw6wlIWka41zrmrVR/DfutfmYvj5LOTnD5UvjvHj0g/8d3zpmfGelwTlPEICw2lK3pWe2lGKiUN/fMwLOepyHOHZY6/NCvK46sCOkvgL33Fu8cPSlzmEW0+Po+AaNv20GZX0enPOEYYCQoNwMoRGs9YShsH2r4c7CPkafP0up3N8SpC2Y8UMn2zI0+dUpqpWreJ975vfV13nu8Im2xrYN065EJp+W2V8GGBo9x3B1+IFtdA0mS+aZmRtj7PD5h7bRNZhtgy9TGTzQkY2uwTy1/7WObWzO/YzWOu0FgDG62cpqlNIozfzyagmqWOfuFQUSKFWpLa2UCAzYNJDq+1/nabNRx4sgOiqmdxLJ21rvINqCiBCEI+M7gsGRg3iHMmHeyKkCLlGINqA0UnqEbG76gk5vfX9a9VVqatuju12jIVDc+YwHxETYP27dSW5OTshmOrn6C2gfIpLerWS0AAAAAElFTkSuQmCC\"","module.exports = __webpack_public_path__ + \"static/media/sample_view.e92880b7.gif\";","import axios from 'axios';\r\n\r\n// export const url = 'https://kf6.ikit.org';\r\n// export const url = 'https://kf6-stage.ikit.org';\r\nexport let url = localStorage.getItem(\"server\");\r\nexport let apiUrl = `${url}/api`;\r\n\r\nexport function setServer(server) {\r\n    //SET SERVER ON SESSION STORAGE\r\n    if (server.endsWith(\"/\")){\r\n        server = server.substring(0, server.length -1);\r\n    }\r\n    localStorage.setItem(\"server\", server);\r\n    url = server;\r\n    apiUrl = `${url}/api`;\r\n    return url;\r\n}\r\n\r\nexport function setToken(token) {\r\n    axios.defaults.headers.common['Authorization'] =\r\n        `Bearer ${token}`;\r\n}\r\n\r\nexport const removeToken = () => {\r\n    delete axios.defaults.headers.common.Authorization\r\n}\r\n\r\n\r\nconst token = sessionStorage.getItem('token');\r\nif (token) {\r\n    setToken(token)\r\n}\r\n\r\n//USER\r\nexport const getUser = async () => {\r\n    return (await axios.get(`${apiUrl}/users/me`)).data\r\n}\r\n\r\n//Contribution\r\nexport const postContribution = (communityId, obj) => {\r\n    return axios.post(`${apiUrl}/contributions/${communityId}`, obj);//, {mode: 'cors'});\r\n}\r\n\r\n//Community\r\nexport const getCommunity = (communityId) => {\r\n    return axios.get(`${apiUrl}/communities/${communityId}`);//, {mode: 'cors'});\r\n}\r\n\r\nexport const putCommunity = async (object, communityId) => {\r\n    return (await axios.put(`${apiUrl}/communities/${communityId}`, object)).data\r\n}\r\n\r\nexport const getCommunities = async () => {\r\n    return (await axios.get(`${apiUrl}/communities/`)).data\r\n}\r\n\r\nexport const getUserCommunities = async () => {\r\n    return (await axios.get(`${apiUrl}/users/myRegistrations`)).data\r\n}\r\n\r\nexport const getGroups = async (communityId) => {\r\n    return (await axios.get(`${apiUrl}/communities/${communityId}/groups`)).data\r\n}\r\n\r\nexport const getCommunityViews = async (communityId) => {\r\n    return (await axios.get(`${apiUrl}/communities/${communityId}/views`)).data\r\n}\r\n\r\n//Links\r\nexport const getLinks = async (objectId, direction, type) => {\r\n    let links = await axios.get(`${apiUrl}/links/${direction}/${objectId}`);\r\n    links = links.data;\r\n    if (type) {\r\n        links = links.filter(function (each) {\r\n            return each.type === type;\r\n        });\r\n    }\r\n    return links\r\n}\r\n\r\nexport const putLink = async (linkId, link) => {\r\n    return (await axios.put(`${apiUrl}/links/${linkId}`, link)).data\r\n}\r\nexport const postLink = async (fromId, toId, type, data) => {\r\n    return (await axios.post(`${apiUrl}/links`, { from: fromId, to: toId, type: type, data: data })).data\r\n}\r\n\r\nexport const deleteLink = async (linkId) => {\r\n    return (await axios.delete(`${apiUrl}/links/${linkId}`)).data\r\n}\r\n\r\nexport const linksSearch = async (communityId, query) => {\r\n    return (await axios.post(`${apiUrl}/links/${communityId}/search`, { \"query\": query })).data\r\n}\r\n\r\n//Object\r\nexport const getObject = async (objectId) => {\r\n    return (await axios.get(`${apiUrl}/objects/${objectId}`)).data\r\n}\r\n\r\nexport const putObject = async (object, communityId, objectId) => {\r\n    return (await axios.put(`${apiUrl}/objects/${communityId}/${objectId}`, object)).data\r\n}\r\n\r\n//Record\r\nexport const read = (communityId, objectId) => {\r\n    return axios.post(`${apiUrl}/records/read/${communityId}/${objectId}`)\r\n}\r\n\r\nexport const postAttachment = (communityId, authorId) => {\r\n    var newobj = {\r\n        communityId: communityId,\r\n        type: 'Attachment',\r\n        title: 'an Attachment',\r\n        authors: [authorId],\r\n        status: 'unsaved',\r\n        permission: 'protected',\r\n        data: {\r\n            version: 0\r\n        }\r\n    };\r\n    return axios.post(`${apiUrl}/contributions/${communityId}`, newobj)\r\n}\r\n\r\nexport const postContribObject = async (communityId, obj) => {\r\n    return (await axios.post(`${apiUrl}/contributions/${communityId}`, obj)).data\r\n}\r\n\r\n//Author\r\nexport const getAuthor = (communityId) => {\r\n    return axios.get(`${apiUrl}/authors/${communityId}/me`)\r\n}\r\nexport const getCommunityAuthors = async (communityId) => {\r\n    return (await axios.get(`${apiUrl}/communities/${communityId}/authors`)).data\r\n}\r\n\r\n//Records\r\nexport const getRecords = async (contribId) => {\r\n    return (await axios.get(`${apiUrl}/records/object/${contribId}`)).data\r\n}\r\n\r\nexport const uploadFile = (file, onProgress) => {\r\n    var formData = new FormData();\r\n    formData.append(\"file\", file);\r\n    return axios.post(`${apiUrl}/upload`, formData, {\r\n        headers: {\r\n            'Content-Type': 'multipart/form-data',\r\n            // ...config.headers\r\n        },\r\n        onUploadProgress: onProgress,\r\n    })\r\n}\r\n\r\nexport const getLinkForObj = (objId) => {\r\n    return axios.get(`${apiUrl}/links/either/${objId}`)\r\n}\r\n\r\nexport const getViews = async (communityId) => {\r\n    return (await axios.get(`${apiUrl}/communities/${communityId}/views`)).data\r\n}\r\n\r\nexport const postView = (query,communityId) => {\r\n    return axios.post(`${apiUrl}/contributions/${communityId}`,query);\r\n}\r\n\r\n// returns a promise that on fullfillment returns an array of the read note ids only\r\nexport function getApiLinksReadStatus(communityId, viewId){\r\n    return axios.get(`${apiUrl}/records/myreadstatusview/${communityId}/${viewId}`).then(function(result) {\r\n        const body = result.data\r\n        var results = [];\r\n        for(var i in body){\r\n            if(body[i].type === \"read\"){ results.push(body[i].to); }\r\n        }\r\n        return (results);\r\n    }).catch(function(error) {\r\n        return (\"Error:\", error);\r\n    });\r\n}\r\n\r\n// used to mark notes as read according to the given parameters\r\nexport function postReadStatus(communityId, contributionId){\r\n    return axios.post(`${apiUrl}/records/read/${communityId}/${contributionId}`).then(function(body) {\r\n        return body\r\n    }).catch(function(error) {\r\n        return (\"Error:\", error);\r\n    });\r\n}\r\n","import { createAction, createReducer } from '@reduxjs/toolkit';\r\nimport * as api from './api.js'\r\n\r\nexport const addUser = createAction('ADD_USER')\r\nexport const addAuthors = createAction('ADD_AUTHORS')\r\nexport const resetAuthors = createAction('SET_AUTHORS')\r\nconst initState = {}\r\nexport const userReducer = createReducer(initState, {\r\n    [addUser]: (state, action) => {\r\n        state[action.payload._id] = action.payload\r\n    },\r\n    [addAuthors]: (state, action) => {\r\n        action.payload.forEach((author) => state[author._id] = author )\r\n    },\r\n    [resetAuthors]: (state, action) => {\r\n        return {}\r\n    }\r\n})\r\n\r\nexport const fetchAuthors = (communityId) => async (dispatch) => {\r\n    const authors = await api.getCommunityAuthors(communityId)\r\n    dispatch(addAuthors(authors))\r\n}\r\n\r\nexport const clearAuthors = () => (dispatch) => {\r\n    dispatch(resetAuthors([]))\r\n}\r\n","import { createAction, createReducer } from '@reduxjs/toolkit';\r\nimport * as api from './api.js'\r\n\r\nexport const requestScaffold = createAction('REQUEST_SCAFFOLD')\r\nexport const receiveScaffold= createAction('RECEIVE_SCAFFOLD')\r\n\r\nconst initState = {isFetching: false,\r\n                   items: [],\r\n                   fetched: false,\r\n                  }\r\n\r\nexport const scaffoldReducer = createReducer(initState, {\r\n    [receiveScaffold]: (state, action) => {\r\n        state.items = action.payload\r\n        state.isFetching = false\r\n        state.fetched = true\r\n    },\r\n    [requestScaffold]: (state, action) => {\r\n        state.isFetching = true\r\n    }\r\n});\r\n\r\nexport const fetchScaffolds = (communityId, contextId) => {\r\n    return dispatch => {\r\n        dispatch(requestScaffold)\r\n\r\n        let scaffold_promise = api.getCommunity(communityId).then( res => {\r\n            return Promise.all(res.data.scaffolds.map((scaffoldId) => {\r\n                return api.getObject(scaffoldId);\r\n            }));\r\n        });\r\n\r\n        return Promise.all([scaffold_promise, api.getLinks(contextId, 'from', 'uses')]).then(async res =>{\r\n            let links = res[1].map((link) => link.to);\r\n            let scaffolds = res[0].filter((el) => links.includes(el._id));\r\n            /* const scaffolds = this.state.scaffolds; */\r\n            let supports = await Promise.all(scaffolds.map((el) => api.getLinks(el._id, 'from')));\r\n            scaffolds = scaffolds.map((scaffold, i) => {\r\n                scaffold.supports = supports[i];\r\n                return scaffold;\r\n            })\r\n\r\n            dispatch(receiveScaffold(scaffolds))\r\n        });\r\n    }\r\n}\r\n","import { createAction, createReducer } from '@reduxjs/toolkit';\r\n\r\nexport const openDialog = createAction('OPEN_DIALOG');\r\nexport const closeDialog = createAction('CLOSE_DIALOG');\r\nexport const focusDialog = createAction('FOCUS_DIALOG')\r\nexport const openAttachPanel = createAction('OPEN_ATTACH_PANEL')\r\nexport const closeAttachPanel = createAction('CLOSE_ATTACH_PANEL')\r\n\r\nlet dialogCounter= 0\r\nconst defaultZIndex = 999\r\nconst focusedZindex = 1000\r\n//Dialog content\r\n// dialog = {id, noteId, title, content, confirmButton, zIndex}\r\nconst initState = { dialogs: [], drawTool: null, focused: null, attachPanel: {}};\r\nexport const dialogReducer = createReducer(initState, {\r\n    // actionCreator.toString() will automatically be called here\r\n    [openDialog] : (state, action) => {\r\n        //Unfocus previous focused dialog\r\n        const dlgs = state.dialogs.map(dlg => {\r\n            if (dlg.id === state.focused)\r\n                dlg.zIndex = defaultZIndex\r\n            return dlg\r\n        })\r\n        //Add new dialog\r\n        state.focused = dialogCounter\r\n        state.dialogs = [...dlgs, {id: dialogCounter++, zIndex: focusedZindex, ...action.payload}]\r\n        //Update index of focused\r\n        // state.dialogs.push({id: dialogCounter++, ...action.payload});\r\n    },\r\n\r\n    // Or, you can reference the .type field:\r\n    [closeDialog] : (state, action) => {\r\n        state.dialogs = state.dialogs.filter((dlg) => dlg.id !== action.payload)\r\n    },\r\n\r\n    [openAttachPanel]: (state, action) => {\r\n        state.attachPanel = action.payload;\r\n    },\r\n\r\n    [closeAttachPanel]: (state, action) => {\r\n        state.attachPanel = {};\r\n    },\r\n\r\n    [focusDialog]: (state, action) => {\r\n        if (state.focused !== action.payload) {\r\n            state.dialogs = state.dialogs.map( dlg => {\r\n                if (dlg.id === state.focused)\r\n                    dlg.zIndex = defaultZIndex\r\n                else if (dlg.id === action.payload)\r\n                    dlg.zIndex = focusedZindex\r\n                return dlg\r\n            })\r\n            state.focused = action.payload\r\n        }\r\n    }\r\n});\r\n\r\n","import $ from 'jquery'\r\nimport {postLink, deleteLink} from './api.js'\r\n\r\n//Count words inside scaffold labels\r\nexport const scaffoldWordCount = (text) => {\r\n    const doc = '<div>' + text + '</div>';\r\n    const jq = $(doc); //convert to jquery dom element\r\n    let labels = jq.find('.kfSupportStartLabel')\r\n    let numwords = 0;\r\n    for (let i = 0; i< labels.length; i++){\r\n        numwords += labels[i].innerHTML.split(' ').length\r\n    }\r\n    return numwords\r\n}\r\n\r\nconst createScaffoldStartTag = (title, isTemplate) => {\r\n    let tag = '';\r\n    tag = tag + ' '; //important for mce\r\n    if (!isTemplate) {\r\n        tag = tag + '<span class=\"kfSupportStartMark\"> &nbsp; </span>';\r\n    } else {\r\n        tag = tag + '<span class=\"kfSupportStartMark kfTemplateStartMark\"> &nbsp; </span>';\r\n    }\r\n    tag = tag + ' '; //important for mce\r\n    if (!isTemplate) {\r\n        tag = tag + '<span class=\"kfSupportStartLabel\">' + title + '</span>';\r\n    } else {\r\n        tag = tag + '<span class=\"kfSupportStartLabel kfTemplateStartLabel\">' + title + '</span>';\r\n    }\r\n    tag = tag + ' '; //important for mce\r\n    return tag;\r\n};\r\n\r\nconst createScaffoldEndTag = (isTemplate) => {\r\n    let tag = '';\r\n    tag = tag + ' '; //important for mce\r\n    if (!isTemplate) {\r\n        tag = tag + '<span class=\"kfSupportEndMark\"> &nbsp; </span>';\r\n    } else {\r\n        tag = tag + '<span class=\"kfSupportEndMark kfTemplateEndMark\"> &nbsp; </span>';\r\n    }\r\n    tag = tag + ' '; //important for mce\r\n    return tag;\r\n};\r\n\r\nconst createReferenceTag = (contId, title, authors, text) => {\r\n    const authorText = '(missing authors)'//TODO $community.makeAuthorStringByIds(authors);\r\n    let tag = '';\r\n    if (text && text.length > 0) {\r\n        tag = tag + '<span class=\"KFReferenceQuote\"><span>\"</span><span class=\"KFReferenceText\">' + text + '</span><span>\"</span></span>';\r\n    }\r\n    tag = tag + '<span> (<a href=\"contribution/' + contId + '\" target=\"' + contId + '\">';\r\n    tag = tag + '<img src=\"/manual_assets/kf4images/icon-note-unread-othr-.gif\">\"' + title + '\"</a>';\r\n    tag = tag + '<span class=\"KFReferenceAuthor\"> by ' + authorText + '</span>)</span>';\r\n    tag = tag + '</span>';\r\n    return tag;\r\n};\r\n\r\nexport const preProcess = (body, toConnections, fromConnections) => {\r\n    const doc = '<div>' + body + '</div>';\r\n    const jq = $(doc);\r\n\r\n    const supportStart = jq.find('.KFSupportStart')\r\n    supportStart.addClass('mceNonEditable');\r\n    for (let i = 0; i < supportStart.length; i++) {\r\n        const elem = supportStart[i]\r\n        if (!elem.id.startsWith('supportid_')) {\r\n            const isTemplate = $(elem).hasClass('KFTemplateStart');\r\n            const ref = toConnections.filter((conn) => conn._id === elem.id)\r\n            if (ref.length) {\r\n                elem.innerHTML =createScaffoldStartTag(ref[0]._from.title, isTemplate);\r\n            } else {\r\n                if(toConnections !== 'Annotation'){\r\n                    elem.innerHTML = createScaffoldStartTag('(missing link)', isTemplate);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    const supportEnd = jq.find('.KFSupportEnd')\r\n    supportEnd.addClass('mceNonEditable');\r\n    for (let i = 0; i < supportEnd.length; i++) {\r\n        const elem = supportEnd[i]\r\n        const isTemplate = $(elem).hasClass('KFTemplateEnd');\r\n        elem.innerHTML = createScaffoldEndTag(isTemplate);\r\n    }\r\n\r\n    const references = jq.find('.KFReference')\r\n    references.addClass('mceNonEditable');\r\n    for (let i = 0; i < references.length; i++) {\r\n        const elem = supportEnd[i]\r\n        let ref = fromConnections.filter((conn) => conn._id === elem.id)\r\n        if (ref.length) {\r\n            ref = ref[0]\r\n            let text = '';\r\n            if (ref.data) {\r\n                text = ref.data.text;\r\n            }\r\n            elem.innerHTML = createReferenceTag(ref.to, ref._to.title, ref._to.authors, text);\r\n        } else {\r\n            elem.innerHTML = createReferenceTag('', '(missing link)', '', '');\r\n        }\r\n    }\r\n    return jq.html();\r\n};\r\n\r\nexport const postProcess = async (text, contributionId, toConnections, fromConnections, handler) => {\r\n    const doc = '<div>' + text + '</div>';\r\n    const jq = $(doc); //convert to jquery dom element\r\n    const endtags = {};\r\n    const supportLinksIds = toConnections.filter((each) => each.type === 'supports')\r\n          .map((each) => each._id) //get only toConnections of type = supports\r\n    let supportStarts = jq.find('.KFSupportStart')\r\n    const supportEnds = jq.find('.KFSupportEnd')\r\n    const toCreate = []\r\n    const supportStartsIds = []\r\n\r\n    for (let i = 0; i < supportEnds.length; i++) {\r\n        const elem = supportEnds[i]\r\n        elem.innerHTML = '';\r\n        var id = elem.id;\r\n        endtags[id] = elem;\r\n    }\r\n    for (let i = 0; i < supportStarts.length; i++) {\r\n        const elem = supportStarts[i]\r\n        let supportId = elem.id;\r\n        elem.innerHTML = '';\r\n        if (supportId.startsWith('supportid_')) {\r\n            supportId = supportId.split('_')[1];\r\n        }\r\n        supportStartsIds.push(supportId)\r\n        if (!supportLinksIds.includes(supportId)) {//Is a new supportLink\r\n            //promise to create link\r\n            toCreate.push(postLink(supportId, contributionId, 'supports').then((link) => {\r\n                //Replace id with id of new created link\r\n                const oldId = elem.id;\r\n                const newId = link._id;\r\n                elem.id = newId;\r\n                if (endtags[oldId]) {\r\n                    endtags[oldId].id = newId;\r\n                }\r\n            }))\r\n        }\r\n    }\r\n    const toDeleteSupports = supportLinksIds.filter((each) => !supportStartsIds.includes(each))\r\n          .map((each) => deleteLink(each)) //Select toConnections that no longer appear in the tinymce text\r\n\r\n\r\n    const referenceLinksIds = fromConnections.filter((each) => each.type === 'references').map((each) => each._id) //get only ids of fromConnections of type=references\r\n    const kfReferences = jq.find('.KFReferenceText') //Get references dom elements\r\n    const kfreferenceIds = []\r\n\r\n    for (var i = 0; i < kfReferences.length; i++) {\r\n        const elem = kfReferences[i]\r\n        const data = {text:$(elem).find('.KFReferenceText').html()}\r\n        elem.innerHTML = '';\r\n        const referenceId = elem.id;\r\n        kfreferenceIds.push(referenceId)\r\n        if (!referenceLinksIds.includes(referenceId)) {//Is a new supportLink\r\n            //promise to create link\r\n            toCreate.push(postLink(contributionId, referenceId, 'references', data).then((link) => {\r\n                //Replace id with id of new created link\r\n                const oldId = elem.id;\r\n                const newId = link._id;\r\n                elem.id = newId;\r\n                if (endtags[oldId]) {\r\n                    endtags[oldId].id = newId;\r\n                }\r\n            }))\r\n        }\r\n    }\r\n\r\n    const toDeleteReferences = referenceLinksIds.filter((each) => !kfreferenceIds.includes(each)).map((each) => deleteLink(each)) //Select fromConnections that no longer appear in the tinymce text\r\n\r\n    await Promise.all(toDeleteSupports)\r\n    await Promise.all(toDeleteReferences)\r\n    await Promise.all(toCreate)\r\n    return jq\r\n}\r\n\r\n","import { store } from 'react-notifications-component';\r\n\r\nconst notifConfig = {\r\n    type: \"success\",\r\n    insert: \"top\",\r\n    container: \"top-right\",\r\n    animationIn: [\"animated\", \"fadeIn\"],\r\n    animationOut: [\"animated\", \"fadeOut\"],\r\n    dismiss: {\r\n        duration: 5000,\r\n        // onScreen: true\r\n    },\r\n}\r\nexport const addNotification = ( notif ) => {\r\n    return store.addNotification({...notifConfig, ...notif});\r\n}\r\n\r\nexport const removeNotification = (notifId) => {\r\n    store.removeNotification(notifId)\r\n}\r\n","import { createAction } from '@reduxjs/toolkit';\r\nexport const addRAView = createAction('ADD_RA_VIEW')\r\nexport const removeRAView = createAction('REMOVE_RA_VIEW')\r\nexport const addToRAView = createAction('ADD_TO_RA_VIEW')\r\n","import * as api from './api.js'\r\n\r\nimport { setView, setCommunitySettings } from './globalsReducer.js'\r\nimport { addViewLink, addViewNote, createNote } from './noteReducer.js'\r\nimport { addToRAView } from './noteActions.js'\r\n\r\n\r\nexport const updateViewLink = (link) => async (dispatch, getState) => {\r\n    await api.putLink(link._id, link);\r\n}\r\n\r\n//When new view link received, add/update to store, fetch\r\nexport const onViewLink = (link) => async (dispatch, getState) => {\r\n    const viewId = getState().globals.viewId;\r\n    if (viewId === link.from){\r\n        dispatch(addViewLink(link));\r\n        if (link._to.type === \"Note\"){\r\n            const note = await api.getObject(link.to)\r\n            dispatch(addViewNote(note))\r\n        }\r\n    }\r\n}\r\n\r\n\r\nexport const updateViewObject = (object) => async (dispatch, getState) => {\r\n    await api.putObject(object, object.communityId, object._id);\r\n    dispatch(setView(object));\r\n}\r\n\r\nexport const updateCommunityContextObject = (object) => async (dispatch, getState) => {\r\n    await api.putObject(object, object.communityId, object._id);\r\n    dispatch(setCommunitySettings(object));\r\n}\r\n\r\n\r\nexport const createView = async (title, authorId, communityId, options, registerToCommunity) => {\r\n    const newobj = {\r\n        communityId: communityId,\r\n        type: 'View',\r\n        title: title,\r\n        authors: [authorId],\r\n        status: 'active',\r\n        permission: 'public',\r\n        ...options\r\n    };\r\n\r\n    const newView = (await api.postView(newobj, communityId)).data\r\n\r\n    if (registerToCommunity){\r\n        const community = (await api.getCommunity(communityId)).data\r\n        community.views.push(newView)\r\n        api.putCommunity(community, communityId)\r\n    }\r\n    return newView\r\n}\r\n\r\nexport const makeRiseabove = async (note, viewId, communityId) => {\r\n    if (!note.data){ note.data = {}}\r\n    note.status = 'active'\r\n    note.data.riseabove = {viewId}\r\n\r\n    const noteModified = await api.putObject(note, communityId, note._id)\r\n    return noteModified\r\n}\r\n\r\nexport const newRiseAbove = (riseAboveTitle) => async (dispatch, getState) => {\r\n\r\n    const {author, communityId, view} = getState().globals\r\n    const mode = {\r\n        permission: view.permission,\r\n        group: view.group,\r\n        '_groupMembers':  view._groupMembers\r\n    };\r\n\r\n    const newView = await createView(riseAboveTitle, author._id, communityId, mode, false)\r\n\r\n    const newNote = createNote(communityId, author._id, mode)\r\n    //Create Note\r\n    let note = (await api.postContribution(communityId, newNote)).data\r\n    note.title = riseAboveTitle;\r\n\r\n    note = await makeRiseabove(note, newView._id, communityId)\r\n\r\n    api.postLink(view._id, note._id, 'contains', {x: 200, y: 200}) //TODO get element position\r\n\r\n    //$community.saveContainsLinktoITM(view._id, note._id);}\r\n}\r\n\r\nexport const loadRiseAboveData = async (viewId, communityId, dispatch) => {\r\n    const viewLinks = await api.getLinks(viewId, 'from')\r\n    const readLinks = await api.getApiLinksReadStatus(communityId, viewId)\r\n    dispatch(addToRAView({viewId, data: {viewLinks, readLinks}}))\r\n\r\n}\r\n","import { createAction, createReducer } from '@reduxjs/toolkit';\r\nimport { openDialog, closeDialog } from './dialogReducer.js'\r\nimport { preProcess, postProcess } from './kftag.service.js'\r\nimport * as api from './api.js'\r\nimport { addNotification } from './notifier.js'\r\nimport { dateFormatOptions } from './globalsReducer.js'\r\nimport {addRAView, removeRAView, addToRAView} from './noteActions.js'\r\nimport {loadRiseAboveData} from './async_actions.js'\r\nexport const addNote = createAction('ADD_NOTE')\r\nexport const removeNote = createAction('REMOVE_NOTE')\r\nexport const editNote = createAction('EDIT_NOTE')\r\nexport const addAttachment = createAction('ADD_ATTACHMENT')\r\nexport const removeAttachment = createAction('REMOVE_ATTACHMENT')\r\nexport const setAttachments = createAction('SET_ATTACHMENTS')\r\nexport const setWordCount = createAction('SET_WORDCOUNT')\r\nexport const setLinks = createAction('SET_CONNECTIONS')\r\nexport const setRecords = createAction('SET_RECORDS')\r\nexport const removeContribAuthor = createAction('REMOVE_CONTRIB_AUTHOR')\r\nexport const addContribAuthor = createAction('ADD_CONTRIB_AUTHOR')\r\nexport const setAnnotation = createAction('SET_ANNOTATION')\r\nexport const setAnnotationsLoaded = createAction('SET_ANNOTATIONS_LOADED')\r\nexport const removeAnnotation = createAction('REMOVE_ANNOTATION')\r\nexport const setViewNotes = createAction('SET_VIEW_NOTES')\r\nexport const addViewNote = createAction('ADD_VIEW_NOTE')\r\nexport const setCheckedNotes = createAction('SET_CHECKED_NOTES')\r\nexport const updateCheckedNotes = createAction('UPDATE_CHECKED_NOTES')\r\nexport const setViewLinks = createAction('SET_VIEW_LINKS')\r\nexport const addViewLink = createAction('ADD_VIEW_LINK')\r\nexport const setBuildsOn = createAction('SET_BUILDS_ON')\r\nexport const setReferences = createAction('SET_REFERENCES')\r\nexport const setSupports = createAction('SET_SUPPORTS')\r\nexport const setRiseAboveViewNotes = createAction('SET_RISEABOVE_VIEW_NOTES')\r\nexport const setRiseAboveNotes = createAction('SET_RISEABOVE_NOTES')\r\nexport const setReadLinks = createAction('SET_READ_LINKS')\r\nexport const removeViewLink = createAction('REMOVE_READ_LINKS')\r\nexport const removeViewNote = createAction('REMOVE_VIEW_NOTE')\r\nconst initState = {attachments: {}, viewNotes: {}, checkedNotes: [], viewLinks: {}, buildsOn: [], supports: [], riseAboveNotes: {}, riseAboveViewNotes: {}, readLinks: [], raViews: {}}\r\n\r\nexport const noteReducer = createReducer(initState, {\r\n    [addNote]: (notes, action) => {\r\n        notes[action.payload._id] = action.payload\r\n    },\r\n    [removeNote]: (notes, action) => {\r\n        const note = notes[action.payload]\r\n        delete notes[action.payload]\r\n        if (note?.data?.riseabove)//if ra delete fetched view data\r\n            delete notes.raViews[note.data.riseabove.viewId]\r\n    },\r\n    [editNote]: (notes, action) => {\r\n        let note = notes[action.payload._id];\r\n        notes[action.payload._id] = Object.assign({}, note, action.payload)\r\n    },\r\n    [addAttachment]: (state, action) => {\r\n        let note = state[action.payload.noteId]\r\n        note.attachments.push(action.payload.attachment._id)\r\n        state.attachments[action.payload.attachment._id] = action.payload.attachment\r\n    },\r\n    [removeAttachment]: (state, action) => {\r\n        let note = state[action.payload.noteId]\r\n        note.attachments = note.attachments.filter((att) => att !== action.payload.attId)\r\n        delete state.attachments[action.payload.attId]\r\n    },\r\n    [setAttachments]: (state, action) => {\r\n        let note = state[action.payload.contribId]\r\n        note.attachments = action.payload.attachments.map((att) => att._id)\r\n        action.payload.attachments.forEach((att) => {\r\n            state.attachments[att._id] = att\r\n        })\r\n    },\r\n    [setWordCount]: (state, action) => {\r\n        let note = state[action.payload.contribId]\r\n        note.wordCount = action.payload.wc\r\n    },\r\n    [setLinks]: (state, action) => {\r\n        let contrib = state[action.payload.contribId]\r\n        if (action.payload.direction === 'from') {\r\n            contrib.fromLinks = action.payload.links\r\n        } else {\r\n            contrib.toLinks = action.payload.links\r\n        }\r\n    },\r\n    [setRecords]: (state, action) => {\r\n        let note = state[action.payload.contribId]\r\n        note.records = action.payload.records\r\n    },\r\n    [addContribAuthor]: (state, action) => {\r\n        let contrib = state[action.payload.contribId]\r\n        contrib.authors = [...contrib.authors, action.payload.author]\r\n    },\r\n    [removeContribAuthor]: (state, action) => {\r\n        let contrib = state[action.payload.contribId]\r\n        contrib.authors = contrib.authors.filter((auth) => auth !== action.payload.author)\r\n    },\r\n    [setAnnotation]: (state, action) => {\r\n        let contrib = state[action.payload.contribId]\r\n        contrib.annos[action.payload.annotation._id] = action.payload.annotation\r\n    },\r\n    [setAnnotationsLoaded]: (state, action) => {\r\n        let contrib = state[action.payload.contribId]\r\n        contrib['annotsFetched'] = action.payload.value\r\n    },\r\n    [removeAnnotation]: (state, action) => {\r\n        let contrib = state[action.payload.contribId]\r\n        delete contrib.annos[action.payload.annoId]\r\n    },\r\n    [setViewNotes]: (state, action) => {\r\n        const viewNotes = {}\r\n        for (let i in action.payload)\r\n            viewNotes[action.payload[i]._id] = action.payload[i]\r\n        state.viewNotes = viewNotes\r\n    },\r\n    [setCheckedNotes]: (state, action) => {\r\n        state.checkedNotes = action.payload\r\n    },\r\n    [updateCheckedNotes]: (state, action) => {\r\n        if (action.payload.checked) {\r\n            state.checkedNotes.push(action.payload.noteId)\r\n        } else {\r\n            state.checkedNotes = state.checkedNotes.filter(id => id !== action.payload.noteId)\r\n        }\r\n    },\r\n    [addViewNote]: (state, action) => {\r\n        state.viewNotes[action.payload._id] = action.payload\r\n    },\r\n    [removeViewNote]: (state, action) => {\r\n        delete state.viewNotes[action.payload._id]\r\n    },\r\n    [setViewLinks]: (state, action) => {\r\n        state.viewLinks = action.payload\r\n    },\r\n    [addViewLink]: (state, action) => {\r\n        delete state.viewLinks[action.payload._id]\r\n        state.viewLinks[action.payload._id] = action.payload\r\n    },\r\n    [removeViewLink]: (state, action) => {\r\n        delete state.viewLinks[action.payload._id]\r\n    },\r\n    [setBuildsOn]: (state, action) => {\r\n        state.buildsOn = action.payload\r\n    },\r\n    [setReferences]: (state, action) => {\r\n        state.references = action.payload\r\n    },\r\n    [setSupports]: (state, action) => {\r\n        state.supports = action.payload\r\n    },\r\n    [setRiseAboveViewNotes]: (state, action) => {\r\n        state.riseAboveViewNotes[action.payload.noteId] = [...action.payload.notes]\r\n    },\r\n    [setRiseAboveNotes]: (state, action) => {\r\n        action.payload.forEach(note => state.riseAboveNotes[note._id] = note)\r\n    },\r\n    [setReadLinks]: (state, action) =>{\r\n        state.readLinks = action.payload\r\n    },\r\n    [addRAView]: (state, action) => {\r\n        if (!state.raViews[action.payload])\r\n            state.raViews[action.payload] = {}\r\n    },\r\n    [removeRAView]: (state, action) => {\r\n        delete state.raViews[action.payload]\r\n    },\r\n    [addToRAView]: (state, action) => {\r\n        state.raViews[action.payload.viewId] = {...state.raViews[action.payload], ...action.payload.data}\r\n    }\r\n});\r\n\r\nexport const createNote = (communityId, authorId, contextMode, fromId, content) => {\r\n    if (!content) { content = '' }\r\n    if (contextMode && !contextMode.permission) {\r\n        window.alert('invalid mode object')\r\n        return\r\n    }\r\n    let mode = {}\r\n    if (contextMode && contextMode.permission === 'private') {\r\n        mode.permission = contextMode.permission;\r\n        mode.group = contextMode.group;\r\n        mode._groupMembers = contextMode._groupMembers;\r\n    } else {\r\n        mode.permission = 'protected';\r\n        mode.group = undefined;\r\n        mode._groupMembers = [];\r\n    }\r\n    let title = contextMode && contextMode.title ? contextMode.title : '';\r\n    let status = contextMode && contextMode.status ? contextMode.status : 'unsaved';\r\n\r\n    const newobj = {\r\n        communityId: communityId,\r\n        type: 'Note',\r\n        title: title,\r\n        /* 6.6 the default title was changed to blank by Christian */\r\n        authors: [authorId],\r\n        status: status,\r\n        permission: mode.permission,\r\n        group: mode.group,\r\n        _groupMembers: mode._groupMembers,\r\n        data: {\r\n            body: contextMode && contextMode.body ? contextMode.body : ''\r\n        },\r\n        buildson: fromId,\r\n        langInNote: []\r\n\r\n    }\r\n\r\n    //save google document id, createdBy and coauthors, current doc permission granted\r\n    if (contextMode && contextMode.docId) {\r\n        newobj.docId = contextMode.docId;\r\n        var myself = newobj.authors[0];\r\n        if (contextMode.coauthors) {\r\n            var ca = contextMode.coauthors.split(',');\r\n            for (var i = 0; i < ca.length; i++) {\r\n                if (ca[i] !== myself) {\r\n                    newobj.authors.push(ca[i]);\r\n                }\r\n            }\r\n        }\r\n        if (contextMode.createdBy) {\r\n            newobj.createdBy = contextMode.createdBy;\r\n        }\r\n        newobj.docShared = [myself];\r\n        newobj.text4search = contextMode.text4search;\r\n    }\r\n\r\n    return newobj\r\n}\r\n\r\nexport const newNote = (view, communityId, authorId, buildson) => dispatch => {\r\n    const mode = { permission: view.permission, group: view.group, _groupMembers: view._groupMembers }\r\n\r\n    const newN = createNote(communityId, authorId, mode, buildson)\r\n\r\n    return api.postContribution(communityId, newN).then((res) => {\r\n        const note = {\r\n            attachments: [],\r\n            fromLinks: [],\r\n            toLinks: [],\r\n            records: [],\r\n            annos: {},\r\n            group: null,\r\n            ...res.data\r\n        }\r\n        const pos = { x: 100, y: 100 }\r\n\r\n        if (!buildson) {\r\n            api.postLink(view._id, note._id, 'contains', pos)\r\n        }\r\n        //TODO saveContainsLinktoITM x2\r\n\r\n        dispatch(addNote(note))\r\n\r\n        dispatch(openDialog({\r\n            title: 'New Note',\r\n            confirmButton: 'create',\r\n            contribId: note._id,\r\n            type: 'Note',\r\n            editable: true, // new note should open in write tab\r\n        }))\r\n    })\r\n\r\n}\r\n\r\nexport const newDrawing = (viewId, communityId, authorId) => async dispatch => {\r\n\r\n    const newobj = {\r\n        communityId: communityId,\r\n        type: 'Drawing',\r\n        title: 'a Drawing',\r\n        authors: [authorId],\r\n        status: 'unsaved',\r\n        permission: 'protected',\r\n        data: {\r\n            // eslint-disable-next-line\r\n            svg: '<svg width=\"200\" height=\"200\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xmlns=\"http://www.w3.org/2000/svg\"><g><title>Layer 1<\\/title><\\/g><\\/svg>',\r\n        }\r\n    }\r\n\r\n    const drawing = (await api.postContribution(communityId, newobj)).data\r\n\r\n    api.postLink(viewId, drawing._id, 'contains', {x: 100, y:100, showInPlace: true})\r\n    //TODO save contains link to ITM\r\n    const contrib = {records: [], ...drawing}\r\n\r\n    dispatch(addNote(contrib))\r\n\r\n    dispatch(openDialog({\r\n        title: 'New Drawing',\r\n        confirmButton: 'create',\r\n        contribId: contrib._id,\r\n        type: 'Drawing',\r\n        editable: true, // new note should open in write tab\r\n    }))\r\n}\r\n\r\nexport const buildOnNote = (noteId) => (dispatch, getState )=> {\r\n    const state = getState()\r\n    dispatch(newNote(state.globals.view, state.globals.communityId, state.globals.author._id, noteId))\r\n}\r\n\r\n\r\nexport const attachmentUploaded = (noteId, attachment, inline, x, y) => dispatch => {\r\n    return api.postLink(noteId, attachment._id, 'attach').then((res) => {\r\n        dispatch(addAttachment({ noteId, attachment }))\r\n    });\r\n}\r\n\r\nexport const fetchAttachments = (contribId) => async dispatch => {\r\n    const link_atts = await api.getLinks(contribId, 'from', 'attach')\r\n    const attachments = await Promise.all(link_atts.map((attach) => api.getObject(attach.to)))\r\n    dispatch(setAttachments({ contribId, attachments }))\r\n}\r\n\r\nexport const postContribution = (contrib, dialogId) => async (dispatch, getState) => {\r\n    contrib = Object.assign({}, contrib)\r\n    contrib.data = Object.assign({}, contrib.data)\r\n    if (!contrib.title) {\r\n        addNotification({ title: 'Error Saving Note!', type: 'danger', message: 'Title is required' })\r\n        return\r\n    }\r\n    //TODO sync checking?\r\n    //TODO status.contribution = 'saving'\r\n    if (contrib.type === 'Note') {\r\n        // TODO if isGoogleDoc\r\n        // const isNewNote = contrib.status === 'unsaved'\r\n        const wasActive = contrib.status === 'active'\r\n        contrib.status = 'active'\r\n        const jq = await postProcess(contrib.data.body, contrib._id, contrib.toLinks, contrib.fromLinks)\r\n\r\n        const text = jq.html()\r\n        const prev_text = contrib.data.body\r\n        contrib.data.body = text\r\n        const newNote = await api.putObject(contrib, contrib.communityId, contrib._id)\r\n        newNote.data.body = prev_text\r\n        dispatch(addViewNote(newNote))\r\n\r\n        if (dialogId !== undefined)\r\n            dispatch(closeDialog(dialogId))\r\n        if (!wasActive) //To update builds on hierarchy\r\n            dispatch(fetchBuildsOn(newNote.communityId))\r\n\r\n        dispatch(removeNote(contrib._id))//Remove from redux when dialog is closed\r\n    } else {\r\n        contrib.status = 'active'\r\n         await api.putObject(contrib, contrib.communityId, contrib._id)\r\n        if (dialogId !== undefined){\r\n            dispatch(closeDialog(dialogId))\r\n            dispatch(removeNote(contrib._id))\r\n        }\r\n    }\r\n\r\n    addNotification({ title: 'Saved!', type: 'success', message: 'Contribution updated!' })\r\n}\r\n\r\nexport const fetchLinks = (contribId, direction) => async (dispatch) => {\r\n    const links = await api.getLinks(contribId, direction)\r\n    dispatch(setLinks({ contribId, direction, links }))\r\n\r\n    if (direction === \"to\"){\r\n        const viewLink = links.filter((link) => link.type === \"contains\")[0];\r\n        dispatch(addViewLink(viewLink));\r\n    }\r\n}\r\n\r\nexport const fetchRecords = (contribId) => async (dispatch, getState) => {\r\n    const authors = getState().users\r\n    const records = await api.getRecords(contribId)\r\n    const formatter = new Intl.DateTimeFormat('default', dateFormatOptions)\r\n    records.forEach((record) => {\r\n        if (authors[record.authorId]) {\r\n            const author = authors[record.authorId]\r\n            record['author'] = `${author.firstName} ${author.lastName}`\r\n        } else {\r\n            record['author'] = 'NA'\r\n        }\r\n        record['date'] = formatter.format(new Date(record.timestamp))\r\n    })\r\n    dispatch(setRecords({ contribId, records }))\r\n}\r\n\r\nexport const openContribution = (contribId) => async (dispatch, getState) => {\r\n\r\n    const contrib = await api.getObject(contribId)\r\n    const author = getState().globals.author;\r\n    const isDemo = getState().globals.isDemo;\r\n    if (contrib.type === 'Note'){\r\n        const [fromLinks, toLinks] = await Promise.all([\r\n            api.getLinks(contribId, 'from'),\r\n            api.getLinks(contribId, 'to')])\r\n        const note = { attachments: [], fromLinks, toLinks, records: [], annos: {}, ...contrib }\r\n        const noteBody = preProcess(note.data.body, toLinks, fromLinks)\r\n        note.data.body = noteBody\r\n        dispatch(addNote(note))\r\n\r\n        if (note.data.riseabove){\r\n            dispatch(addRAView(note.data.riseabove.viewId))\r\n            loadRiseAboveData(note.data.riseabove.viewId, note.communityId, dispatch)\r\n        }\r\n        dispatch(fetchAttachments(contribId))\r\n        dispatch(openDialog({\r\n            title: 'Edit Note',\r\n            confirmButton: 'edit',\r\n            contribId: note._id,\r\n            type: 'Note',\r\n            editable: author && (note.authors.includes(author._id) || author.role === \"manager\"), // read or write tab\r\n            buildOn: !isDemo\r\n        }))\r\n        //annotations\r\n        const annoLinks = toLinks.filter((link) => link.type === 'annotates')\r\n\r\n        const annotations = await Promise.all(\r\n            annoLinks.map((annLink) =>\r\n                api.getObject(annLink.from).then(anno => {\r\n                    anno.data.linkId = annLink._id\r\n                    anno.data.modelId = anno._id\r\n                    return anno\r\n                })\r\n            )\r\n        )\r\n\r\n        annotations.forEach((annot) => dispatch(setAnnotation({ annotation: annot, contribId })))\r\n        dispatch(setAnnotationsLoaded({ contribId, value: 1 }))\r\n    }else {\r\n        const attachment = { records: [],  ...contrib }\r\n        dispatch(addNote(attachment))\r\n\r\n        dispatch(openDialog({\r\n            title: `Edit ${contrib.type}`,\r\n            confirmButton: 'edit',\r\n            contribId: contrib._id,\r\n            type: contrib.type,\r\n            editable: author && (contrib.authors.includes(author._id) || author.role === \"manager\"), // read or write tab\r\n            buildOn: true\r\n        }))\r\n    }\r\n\r\n    if (contrib.status === 'active') {\r\n        api.read(contrib.communityId, contrib._id)\r\n    }\r\n    return;\r\n}\r\n\r\nexport const createAnnotation = (communityId, contribId, authorId, annotation) => async (dispatch) => {\r\n    const newobj = {\r\n        communityId: communityId,\r\n        type: 'Annotation',\r\n        title: 'an Annotation',\r\n        authors: [authorId],\r\n        status: 'active',\r\n        permission: 'private',\r\n        data: annotation\r\n    };\r\n    const ann = await api.postContribObject(communityId, newobj)\r\n\r\n    const link = await api.postLink(ann._id, contribId, 'annotates')\r\n\r\n    annotation.linkId = link._id;\r\n    annotation.modelId = ann._id;\r\n    dispatch(setAnnotation({ contribId, annotation: ann }))\r\n    // TODO save in store link\r\n    // $scope.annoLinks[link._id] = link;\r\n}\r\n\r\nexport const deleteAnnotation = (linkId, contribId, annoId) => async (dispatch) => {\r\n    await api.deleteLink(linkId)\r\n    return dispatch(removeAnnotation({ contribId, annoId }))\r\n}\r\n\r\nexport const modifyAnnotation = (annotation, communityId, contribId) => async (dispatch) => {\r\n    const anno_updated = await api.putObject(annotation, communityId, annotation._id)\r\n    return dispatch(setAnnotation({ contribId, annotation: anno_updated }))\r\n}\r\n\r\nexport const fetchViewNotes = (viewId) => async (dispatch) => {\r\n    const links = (await api.getLinks(viewId, 'from'))\r\n    const noteLinks = links\r\n        .filter(obj => (obj._to.type === \"Note\" && obj._to.title !== \"\" && obj._to.status === \"active\"))\r\n\r\n    const linksMap = links.reduce(function(map, obj){\r\n      map[obj._id] = obj;\r\n      return map\r\n    }, {});\r\n\r\n    dispatch(setViewLinks(linksMap))\r\n    const notes = await Promise.all(noteLinks.map((filteredObj) => api.getObject(filteredObj.to)))\r\n\r\n    dispatch(setViewNotes(notes))\r\n\r\n    //RISEABOVE\r\n    notes.forEach(async note => {\r\n        if (note.data && note.data.riseabove) {\r\n            //SET NOTES INTO RISEABOVE LIST\r\n            let viewId = note.data.riseabove.viewId\r\n            const riseAboveNoteIds = (await api.getLinks(viewId, 'from'))\r\n                  .filter(obj => (obj._to.type === \"Note\" && obj._to.title !== \"\" && obj._to.status === \"active\")).map(lnk => lnk.to)\r\n            const riseAboveNotes = await Promise.all(riseAboveNoteIds.map((noteId) => api.getObject(noteId)))\r\n            // let data = {\r\n            //     viewId: viewId,\r\n            //     notes: riseAboveNotes,\r\n            // }\r\n\r\n            dispatch(setRiseAboveNotes(riseAboveNotes))\r\n            dispatch(setRiseAboveViewNotes({noteId: note._id, notes: riseAboveNoteIds}))\r\n            // riseAboveNotes.forEach(note => dispatch(setRiseAboveViewNotes(note)))\r\n        }\r\n    })\r\n}\r\n\r\nexport const fetchBuildsOn = (communityId) => async (dispatch) => {\r\n    let buildOnResult = await api.linksSearch(communityId, { \"type\": \"buildson\" })\r\n    buildOnResult = buildOnResult.reverse();\r\n    const filteredBuildOn = buildOnResult.filter(\r\n        (obj) =>\r\n            (obj._to.type === \"Note\" && obj._to.status === \"active\" && obj._from.type === \"Note\" && obj._from.status === \"active\")\r\n    )\r\n    dispatch(setBuildsOn(filteredBuildOn))\r\n}\r\n\r\nexport const fetchReferences = (communityId) => async (dispatch) => {\r\n   let references = await api.linksSearch(communityId, {\"type\": \"references\"});\r\n   const filteredReferences = references.filter((obj) => (obj._to.status === \"active\" && obj._to.title !== \"\" && obj._from.status === \"active\" && obj._from.title !== \"\"));\r\n   dispatch(setReferences(filteredReferences));\r\n}\r\n\r\nexport const fetchSupports = (communityId) => async (dispatch) => {\r\n    let supports = await api.linksSearch(communityId, { \"type\": \"supports\" })\r\n    dispatch(setSupports(supports))\r\n}\r\n\r\nexport const deleteAttachment = (contribId, attId) => async (dispatch, getState) => {\r\n    const state = getState()\r\n    let contrib = state.notes[contribId]\r\n    const att_link = contrib.fromLinks.filter((lnk) => lnk.to === attId)[0]\r\n    await api.deleteLink(att_link._id)\r\n    dispatch(removeAttachment({ attId, noteId: contribId }))\r\n    dispatch(fetchLinks(contribId, 'from'))\r\n}\r\n\r\nexport const fetchReadLinks = (communityId, viewId) => async (dispatch) =>{\r\n    const readLinks = await api.getApiLinksReadStatus(communityId, viewId)\r\n    dispatch(setReadLinks(readLinks))\r\n}\r\n","import { createAction, createReducer } from '@reduxjs/toolkit'\r\nimport { getObject, getCommunity, getGroups, getUser, getAuthor, getCommunityViews, getCommunities, getUserCommunities } from './api.js'\r\nimport { fetchAuthors } from './userReducer.js';\r\nimport { fetchScaffolds } from './scaffoldReducer.js'\r\nimport { fetchViewNotes, fetchBuildsOn, fetchReferences, setCheckedNotes, fetchSupports, fetchReadLinks } from './noteReducer.js'\r\nexport const setDemoStatus = createAction('SET_DEMO_STATUS')\r\nexport const setGlobalToken = createAction('SET_TOKEN')\r\nexport const setCurrentLoginForm = createAction('SET_CURRENT_LOGIN_FORM')\r\nexport const setCommunity = createAction('SET_COMMUNITY')\r\nexport const setCommunitySettings = createAction('SET_COMMUNITY_SETTING')\r\nexport const setCommunityId = createAction('SET_COMMUNITY_ID')\r\nexport const setCurrentServer = createAction('SET_CURRENT_SERVER')\r\nexport const setViewId = createAction('SET_VIEW_ID')\r\nexport const setLoggedUser = createAction('SET_AUTHOR')\r\nexport const setView = createAction('SET_VIEW')\r\nexport const setCurrViewSettingsObj = createAction('SET_CURRENT_VIEW_SETTINGS_OBJ');\r\nexport const setAuthor = createAction('SET_AUTHOR')\r\nexport const setViews = createAction('SET_VIEWS')\r\nexport const editCommunity = createAction('EDIT_COMMUNITY')\r\nexport const setUserId = createAction('SET_USERID')\r\nexport const setIsAuthenticated = createAction('SET_ISAUTHENTICATED')\r\nexport const setCommunities = createAction('SET_COMMUNITIES')\r\nexport const setUserCommunities = createAction('SET_USER_COMMUNITIES')\r\nexport const setSearchQuery = createAction('SET_SEARCH_QUERY')\r\nexport const setSearchFilter = createAction('SET_SEARCH_FILTER')\r\nexport const setSocketStatus = createAction('SET_SOCKET_STATUS')\r\nexport const dateFormatOptions = {\r\n    year: 'numeric', month: 'numeric', day: 'numeric',\r\n    hour: 'numeric', minute: 'numeric', second: 'numeric',\r\n    hour12: true\r\n};\r\n\r\nconst initState = {\r\n    isDemo: false,\r\n    token: sessionStorage.getItem(\"token\"),\r\n    currentLoginForm: \"Login\",\r\n    communityId: null,\r\n    currentServer: null,\r\n    viewId: null,\r\n    contextId: '',\r\n    user: null,\r\n    view: null,\r\n    views: [],\r\n    currViewSettingsObj: {buildson: true, language: false, references: false, showAuthor: true, showGroup: false, showTime: true},\r\n    thisViewsViewSettingsObj: null,\r\n    communityViewSettingsObj: null,\r\n    community: null,\r\n    communitySettings: null,\r\n    userId: '',\r\n    isAuthenticated: sessionStorage.getItem(\"token\") ? true : false,\r\n    communities: [],\r\n    userCommunities: [],\r\n    searchQuery: '',\r\n    searchFilter: 'title',\r\n    servers: [\r\n        {\r\n            id: 0,\r\n            key: \"kf6.ikit.org\",\r\n            value: \"https://kf6.ikit.org\"\r\n\r\n        },\r\n        {\r\n            id: 1,\r\n            key: \"kf6-stage.ikit.org\",\r\n            value: \"https://kf6-stage.ikit.org\"\r\n\r\n        },\r\n        {\r\n            id: 2,\r\n            key: \"kf6-stage.rit.albany.edu\",\r\n            value: \"https://kf6-stage.rit.albany.edu\"\r\n\r\n        },\r\n        {\r\n            id: 3,\r\n            key: \"kf.rdc.nie.edu.sg\",\r\n            value: \"https://kf.rdc.nie.edu.sg\"\r\n\r\n        },\r\n        {\r\n            id: 4,\r\n            key: \"kf.rit.albany.edu\",\r\n            value: \"https://kf6.rit.albany.edu\"\r\n\r\n        },\r\n        // {\r\n        //     id: 5,\r\n        //     key: \"localhost 9000\",\r\n        //     value: \"http://localhost:9000\"\r\n\r\n        // },\r\n    ],\r\n    socketStatus: false\r\n}\r\n\r\nexport const globalsReducer = createReducer(initState, {\r\n    [setDemoStatus]: (state, action) => {\r\n        state.isDemo = action.payload\r\n    },\r\n    [setGlobalToken]: (state, action) => {\r\n        state.token = action.payload\r\n        state.isAuthenticated = state.token ? true : false\r\n    },\r\n    [setIsAuthenticated]: (state, action) => {\r\n        state.isAuthenticated = state.token ? true : false\r\n    },\r\n    [setCurrentLoginForm]: (state, action) => {\r\n        state.currentLoginForm = action.payload\r\n    },\r\n    [setCommunityId]: (state, action) => {\r\n        state.communityId = action.payload\r\n    },\r\n    [setCurrentServer]: (state, action) => {\r\n        state.currentServer = action.payload\r\n    },\r\n    [setViewId]: (state, action) => {\r\n        state.viewId = action.payload\r\n    },\r\n    [setUserId]: (state, action) => {\r\n        state.userId = action.payload\r\n    },\r\n    [setLoggedUser]: (state, action) => {\r\n        state.user = action.payload\r\n    },\r\n    [setView]: (state, action) => {\r\n        state.view = action.payload\r\n        if(action.payload.data && action.payload.data.viewSetting){\r\n          state.thisViewsViewSettingsObj = action.payload.data.viewSetting\r\n        } else {\r\n          state.thisViewsViewSettingsObj = null\r\n        }\r\n    },\r\n    [setCurrViewSettingsObj]: (state, action) => {\r\n        state.currViewSettingsObj = action.payload\r\n    },\r\n    [setViews]: (state, action) => {\r\n        state.views = action.payload\r\n    },\r\n    [setCommunity]: (state, action) => {\r\n        state.community = action.payload\r\n        state.communityId = action.payload._id\r\n        state.contextId = action.payload.rootContextId\r\n    },\r\n    [setCommunitySettings]: (state, action) => {\r\n        state.communitySettings = action.payload\r\n        if(action.payload.data && action.payload.data.viewSetting){\r\n          state.communityViewSettingsObj = action.payload.data.viewSetting\r\n        } else {\r\n          state.communityViewSettingsObj = null\r\n        }\r\n    },\r\n    [editCommunity]: (state, action) => {\r\n        state.community = { ...state.community, ...action.payload }\r\n    },\r\n    [setCommunities]: (state, action) => {\r\n        state.communities = action.payload\r\n    },\r\n    [setUserCommunities]: (state, action) => {\r\n        state.userCommunities = action.payload\r\n    },\r\n    [setSearchQuery]: (state, action) => {\r\n        state.searchQuery = action.payload\r\n    },\r\n    [setSearchFilter]: (state, action) => {\r\n        state.searchFilter = action.payload\r\n    },\r\n    [setAuthor]: (state, action) => {\r\n        state.author = action.payload\r\n    },\r\n    [setSocketStatus]: (state, action) => {\r\n        state.socketStatus = action.payload\r\n    }\r\n});\r\n\r\nexport const fetchAuthor = (communityId) => {\r\n    return dispatch => {\r\n        return getAuthor(communityId).then(res => {\r\n            dispatch(setAuthor(res.data));\r\n        })\r\n    }\r\n}\r\nexport const fetchCommunities = () => {\r\n    return async dispatch => {\r\n        const communities = await getCommunities()\r\n        dispatch(setCommunities(communities))\r\n    }\r\n}\r\n\r\nexport const fetchUserCommunities = () => {\r\n    return async dispatch => {\r\n        const communities = await getUserCommunities()\r\n        dispatch(setUserCommunities(communities))\r\n    }\r\n}\r\n\r\nexport const fetchView = (viewId) => {\r\n    return dispatch => {\r\n        return getObject(viewId).then(res => {\r\n            dispatch(setView(res))\r\n        })\r\n    }\r\n}\r\n\r\nexport const fetchCommunity = (communityId) => {\r\n    return dispatch => {\r\n        return getCommunity(communityId).then(res => {\r\n            dispatch(setCommunity(\r\n                { groups: [], ...res.data }\r\n            ))\r\n        })\r\n    }\r\n}\r\n\r\nexport const fetchCommunitySettings = (contextId) => {\r\n    return dispatch => {\r\n        return getObject(contextId).then(res => {\r\n            dispatch(setCommunitySettings(res))\r\n        })\r\n    }\r\n}\r\n\r\nexport const fetchCommGroups = (communityId) => async (dispatch) => {\r\n    const groups = await getGroups(communityId)\r\n    dispatch(editCommunity({ groups }))\r\n}\r\n\r\nexport const fetchLoggedUser = () => async (dispatch) => {\r\n    try {\r\n        const user = await getUser()\r\n        dispatch(setUserId(user._id))\r\n        dispatch(setLoggedUser(user))\r\n    }catch (e){//Error with token, logout\r\n        sessionStorage.clear();\r\n        localStorage.clear();\r\n        window.location.replace('/')\r\n    }\r\n}\r\n\r\nexport const fetchCommunityViews = (communityId) => async (dispatch) => {\r\n    const views = await getCommunityViews(communityId)\r\n    dispatch(setViews(views))\r\n}\r\n\r\nexport const fetchViewCommunityData = (viewId) => async (dispatch) => {\r\n    dispatch(setCheckedNotes([]))\r\n    dispatch(setViewId(viewId))\r\n    const view = await getObject(viewId)\r\n    const commId = view.communityId\r\n    dispatch(setView(view))\r\n    dispatch(fetchViewNotes(view._id))\r\n    const community = (await getCommunity(commId)).data\r\n    dispatch(fetchCommunitySettings(community.rootContextId))\r\n    dispatch(setCommunity(\r\n        { groups: [], ...community }\r\n    ))\r\n    dispatch(fetchBuildsOn(commId))\r\n    dispatch(fetchReferences(commId))\r\n    dispatch(fetchAuthor(commId))\r\n    dispatch(fetchCommGroups(commId))\r\n    dispatch(fetchCommunityViews(commId))\r\n    dispatch(fetchAuthors(commId))\r\n    dispatch(fetchReadLinks(commId, view._id))\r\n    dispatch(fetchScaffolds(commId, community.rootContextId))\r\n    dispatch(fetchSupports(commId))\r\n}\r\n\r\n// A COMPACT VERSION OF fetchViewCommunityData - only retrieves what will be different between views within a community\r\nexport const fetchNewViewDifference = (viewId) => async (dispatch) => {\r\n  dispatch(setCheckedNotes([]))\r\n  const view = await getObject(viewId)\r\n  const commId = view.communityId\r\n  dispatch(setView(view))\r\n  dispatch(fetchViewNotes(view._id))\r\n  dispatch(fetchReadLinks(commId, view._id))\r\n}\r\n","// returns a promise that on fullfillment returns the users token\r\nexport function getUserToken(username, password, server){\r\n  var body = {\r\n    'userName': username,\r\n    'password': password\r\n  };\r\n\r\n  return fetch(server + 'auth/local', {\r\n    method: \"POST\",\r\n    headers: {'Content-Type': 'application/json'},\r\n    body: JSON.stringify(body),\r\n  }).then(function(response) {\r\n      if(response.status !== 200){\r\n        console.log(\"Error: \" + server + 'auth/local');\r\n        console.log(response);\r\n      }\r\n      return response.json();\r\n  }).then(function(body) {\r\n      return body;\r\n  }).catch(function(error) {\r\n      return (\"Error:\", error);\r\n  });\r\n\r\n}\r\n\r\n\r\n// returns a promise that on fulfillment returns an [user token, server] object pair\r\nexport function getUserTokenServerPair(username, password, server){\r\n  var body = {\r\n    'userName': username,\r\n    'password': password\r\n  };\r\n\r\n  return fetch(server + 'auth/local', {\r\n    method: \"POST\",\r\n    headers: {'Content-Type': 'application/json'},\r\n    body: JSON.stringify(body),\r\n  }).then(function(response) {\r\n      if(response.status !== 200){\r\n        console.log(\"Error: \" + server + 'auth/local');\r\n        console.log(response);\r\n      }\r\n      return response.json();\r\n  }).then(function(body) {\r\n      return [body, server];\r\n  }).catch(function(error) {\r\n      console.log(\"Error: \" + server + 'auth/local');\r\n      console.log(error);\r\n      return [{error: \"Error: server unavailable\"}, server];\r\n  });\r\n}\r\n\r\n\r\n// returns a promise that on fullfillment returns the user information corresponding to the given token and server\r\nexport function getUserInfo(token, server){\r\n\r\n  return fetch(server + 'api/users/me', {\r\n    method: \"GET\",\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': 'Bearer ' + token\r\n    },\r\n  }).then(function(response) {\r\n      if(response.status !== 200 && response.status !== 304){\r\n        console.log(\"Error: \" + server + \"api/users/me\");\r\n        console.log(response);\r\n        return {error: true};\r\n      }\r\n      return response.json();\r\n  }).then(function(body) {\r\n      return (body);\r\n  }).catch(function(error) {\r\n      return (\"Error:\", error);\r\n  });\r\n\r\n}\r\n\r\n\r\n// returns a promse that on fulfillment returns the communities a user is registered to in a given server from their token\r\nexport function getUserCommunities(token, server){\r\n  return fetch(server + 'api/users/myRegistrations', {\r\n    method: \"GET\",\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': 'Bearer ' + token\r\n    },\r\n  }).then(function(response) {\r\n    if(response.status !== 200){\r\n      console.log(\"Error: \" + server + 'api/users/myRegistrations');\r\n      console.log(response);\r\n    }\r\n    return response.json();\r\n  }).then(function(body) {\r\n      return (body);\r\n  }).catch(function(error) {\r\n      return (\"Error:\", error);\r\n  });\r\n}\r\n\r\nexport function postNewUser(server, firstname, lastname, email, username, password, registrationKey){\r\n  var body;\r\n  if(registrationKey === null){\r\n    body = {\r\n      'email': email,\r\n      'firstName': firstname,\r\n      'lastName': lastname,\r\n      'password': password,\r\n      'userName': username\r\n    }\r\n  } else {\r\n    body = {\r\n      'email': email,\r\n      'firstName': firstname,\r\n      'lastName': lastname,\r\n      'password': password,\r\n      'registrationKey': registrationKey,\r\n      'userName': username\r\n    };\r\n  }\r\n\r\n\r\n  return fetch(server + 'api/users', {\r\n    method: \"POST\",\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n    },\r\n    body: JSON.stringify(body),\r\n  }).then(function(response) {\r\n    if(response.status !== 200){\r\n      console.log(\"Error: \" + server + 'api/users');\r\n      console.log(response);\r\n    }\r\n    return response.json();\r\n  }).then(function(body) {\r\n    return [body, server];\r\n  }).catch(function(error) {\r\n    return [{error: \"Error: server unavailable\"}, server];\r\n  });\r\n}\r\n","/*\r\n* EDIT AVAILABLE SERVERS HERE\r\n* {name:\"SERVER NAME\", url:\"SERVER URL\"}\r\n*/\r\nexport const SERVERS = [\r\n  {name:\"IKIT Stage\", url:\"https://kf6-stage.ikit.org/\"},\r\n  {name:\"Albany Stage\", url:\"https://kf6-stage.rit.albany.edu/\"},\r\n  {name:\"IKIT\", url:\"https://kf6.ikit.org/\"},\r\n  {name:\"Albany\", url:\"https://kf6.rit.albany.edu/\"},\r\n  {name:\"Singapore\", url:\"https://kf.rdc.nie.edu.sg/\"},\r\n  // {name:\"Local\", url:\"http://localhost:9000/\"}\r\n];\r\n\r\n// ZOOM VALUES FOR CYTOSCAPE GRAPH\r\nexport const MIN_ZOOMED_FONT_SIZE = '6px';\r\nexport const MINZOOM = 0.25;\r\nexport const MAXZOOM = 10;\r\n\r\n// DEMO VALUES FOR LOGIN PAGE\r\nexport const DEMOUSERNAME = \"kfhowdemouser\";\r\nexport const DEMOUSERPASSWORD = \"demouser123\";\r\nexport const DEMOSERVER = \"https://kf6-stage.ikit.org/\";\r\nexport const DEMOCOMMUNITYID = \"5ea995a6cbdc04a6f53a1b5c\";\r\nexport const DEMOCOMMUNITYTITLE = \"KF How To - KB Resources\";\r\nexport const DEMOVIEWID = \"5ea995a7cbdc04a6f53a1b5f\";\r\n\r\n// GOOGLE RECAPTCHA SITE KEY FOR SIGN UP PAGE\r\nexport const siteKey = \"6LdTo2oaAAAAALKB-WW7km7SabLVsBXSg4NAaX_K\";\r\n\r\n// Helper function to retrieve a servers name from its URL\r\nexport function getServerName(url){\r\n  for(var i in SERVERS){\r\n    if(SERVERS[i].url === url){ return SERVERS[i].name; }\r\n  }\r\n\r\n  return \"Error: server \" + url + \" does not exist\";\r\n}\r\n\r\n\r\n// Helper function to retrieve a servers URL from its name\r\nexport function getServerURL(name){\r\n  for(var i in SERVERS){\r\n    if(SERVERS[i].name === name){ return SERVERS[i].url; }\r\n  }\r\n\r\n  return \"Error: server \" + name + \" does not exist\";\r\n}\r\n\r\n\r\n// Helper function to retrieve the current users token for a specified server\r\nexport function extractTokenFromStorage(server) {\r\n  var uname = localStorage.getItem(\"Username\");\r\n  var data = JSON.parse(localStorage.getItem(uname));\r\n\r\n  for (var i in data) {\r\n    if (data[i][0] === server) {\r\n      return data[i][1];\r\n    }\r\n  }\r\n}\r\n\r\nexport const WS_BASE = '/socket.io-client';\r\n","/*\r\n* THIS FILE PROVIDES HELPER FUNCTIONS FOR LOGIN COMPONENT\r\n*/\r\nimport {getUserTokenServerPair} from '../../legacy_api/user.js';\r\nimport {SERVERS} from '../../config.js';\r\n\r\n\r\n// Executes all promises to get user token for each server at once\r\nexport function executePromises(uname, pwd, login_form_component){\r\n  const promises = [];\r\n\r\n  // if the checkbox on login page is checked clear the local storage\r\n  var firstLogin = document.getElementById(\"refreshCheckbox\").checked;\r\n  if(firstLogin){ localStorage.clear(); }\r\n\r\n  var userStorage = JSON.parse(localStorage.getItem(uname));\r\n\r\n  // If it is the first time logging in we test all servers (userStorage == null)\r\n  // else we only call the servers stored in users local storage list\r\n  if(userStorage == null){\r\n    for(let i in SERVERS){\r\n      promises.push(getUserTokenServerPair(uname, pwd, SERVERS[i].url));\r\n    }\r\n  } else {\r\n    for(let i in userStorage){\r\n      promises.push(getUserTokenServerPair(uname, pwd, userStorage[i][0]));\r\n    }\r\n  }\r\n\r\n  // execute all the login promises\r\n  return Promise.all(promises).then(function(data){\r\n    return responseHandler(uname, data, login_form_component);\r\n  }).catch(function(error){\r\n    console.log(error);\r\n  });\r\n}\r\n\r\n\r\n// Handles each servers response to the users credentials\r\n// If no succesful logins then displays error message to user\r\n// Otherwise redirects to next page\r\n// each item in data is [response body, server]\r\nexport function responseHandler(uname, data, login_form_component){\r\n  var successfulLogin = false;\r\n  var errorMessage = \"\";\r\n  var serverTokenPair = [];\r\n\r\n  // retrieve users server information from local storage in order to find last active server\r\n  // value will be null if its first login\r\n  var userStorage = JSON.parse(localStorage.getItem(uname));\r\n\r\n  for(var i in data){\r\n    if(data[i][0].token !== undefined) {\r\n      var token = data[i][0].token;\r\n      var server = data[i][1];\r\n\r\n      var viewPreference = userStorage !== null && userStorage[i][3] ? userStorage[i][3] : {value: 'Classic', label: 'Classic'};\r\n\r\n      if((userStorage === null && successfulLogin === false) || (userStorage !== null && userStorage[i][2] === \"active\")){\r\n        serverTokenPair.push([server, token, \"active\", viewPreference]);\r\n      } else {\r\n        serverTokenPair.push([server, token, \"inactive\", viewPreference]);\r\n      }\r\n\r\n      successfulLogin = true;\r\n\r\n      // this else if case handles a user having the same username on multiple servers but with different passwords\r\n    } else if(data[i][0].message !== undefined && userStorage !== null){\r\n      var username = document.getElementById(\"uname\").value;\r\n      var password = document.getElementById(\"pwd\").value;\r\n      localStorage.removeItem(username);\r\n      return executePromises(username, password, login_form_component);\r\n    } else if(data[i][0].message !== undefined && errorMessage === \"\") {\r\n      errorMessage = data[i][0].message;\r\n    } else if(errorMessage === \"This userName is not registered.\" && data[i][0].message === \"This password is not correct.\") {\r\n      errorMessage = data[i][0].message;\r\n    } else if(data[i][0].error !== undefined && errorMessage === \"\") {\r\n      errorMessage = data[i][0].error;\r\n    }\r\n  }\r\n\r\n  if(!successfulLogin){\r\n    document.getElementById(\"errorMessage\").style.display = \"visible\";\r\n    login_form_component.setState({errorMessage: errorMessage});\r\n    return 0;\r\n  } else {\r\n    localStorage.setItem(\"Username\", uname);\r\n    localStorage.setItem(uname, JSON.stringify(serverTokenPair));\r\n    return 1;\r\n  }\r\n}\r\n\r\nexport function getLoginData(){\r\n    const uname = localStorage.getItem(\"Username\");\r\n    if (uname){\r\n        const servers = JSON.parse(localStorage.getItem(uname));\r\n        for(let server_data of servers){\r\n            if (server_data[2] === 'active' && server_data[1] !== \"\"){\r\n                return server_data;\r\n            }\r\n        }\r\n    }\r\n    return [null,null,null,null]\r\n}\r\n","import React, {Component} from 'react';\r\nimport {withRouter} from 'react-router';\r\nimport { connect } from 'react-redux';\r\nimport { compose } from 'redux';\r\nimport { setCurrentLoginForm, setGlobalToken } from '../../store/globalsReducer.js'\r\nimport $ from 'jquery';\r\nimport '../../../node_modules/bootstrap/dist/js/bootstrap.bundle.min.js';\r\nimport {executePromises, getLoginData} from './Login_helper.js';\r\nimport app_store from './../../assets/appstore.svg';\r\nimport googleplay_store from './../../assets/googleplaystore.png';\r\n\r\nimport './Login.css';\r\n\r\nclass LoginForm extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      uname: null,\r\n      pwd: null,\r\n      errorMessage: null,\r\n    }\r\n  }\r\n\r\n  inputChangeHandler = (event) => {\r\n    let name = event.target.name;\r\n    let val = event.target.value;\r\n\r\n    this.setState({[name] : val});\r\n  }\r\n\r\n  formSubmitHandler = (event) => {\r\n    event.preventDefault();\r\n    var uname = this.state.uname;\r\n    var pwd = this.state.pwd;\r\n    document.getElementById(\"errorMessage\").style.display = \"hidden\";\r\n    executePromises(uname, pwd, this).then((result) => {\r\n      if(result === 1){\r\n        this.props.setGlobalToken(getLoginData()[1]);\r\n        this.props.history.push(\"/dashboard\");\r\n      }\r\n    });\r\n    return false;\r\n  }\r\n\r\n  openSignUpForm = (event) => {\r\n    this.props.setCurrentLoginForm(\"SignUp\");\r\n  }\r\n\r\n  componentDidMount(){\r\n    // enables the popover for refreshing servers on login tool tip\r\n    $('[data-toggle=\"tooltip\"]').tooltip()\r\n    $('[data-toggle=\"popover\"]').popover()\r\n    if($(window).width() <= 768) {\r\n      document.getElementById(\"popover\").setAttribute(\"data-trigger\", \"focus\");\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return(\r\n      <div className = \"row login-form-row\">\r\n        <div className = {\"col-lg-8 col-md-10 col-sm-12 login-form-wrapper\"}>\r\n          <h1>knowledgeforum.org</h1>\r\n          <form onSubmit={this.formSubmitHandler} className = \"loginForm\" id = \"loginForm\" autoComplete=\"on\">\r\n\r\n            <div className = \"login-input-wrapper\">\r\n              <i className=\"fas fa-user\"></i>\r\n              <input type=\"text\" id=\"uname\" name=\"uname\" placeholder=\"Username\" required onChange={this.inputChangeHandler}></input>\r\n            </div>\r\n\r\n            <div className = \"login-input-wrapper\">\r\n              <i className=\"fas fa-lock\"></i>\r\n              <input type=\"password\" id=\"pwd\" name=\"pwd\" placeholder=\"Password\" required onChange={this.inputChangeHandler}></input>\r\n            </div>\r\n\r\n            <div className = \"login-checkbox-wrapper\">\r\n              <input type=\"checkbox\" id=\"refreshCheckbox\" name=\"refreshCheckbox\"></input>\r\n              <label htmlFor=\"refreshCheckbox\">Refresh my servers on login?</label>\r\n              <span id=\"popover\" tabIndex=\"0\" role=\"button\" data-toggle=\"popover\"\r\n                data-trigger=\"hover\" data-content=\"Check this box if you have registered to any new knowledge forums servers since your last login.\">\r\n              <i className=\"far fa-question-circle\"></i></span>\r\n            </div>\r\n\r\n            <div>\r\n              <p style={{display:'hidden',color:'red'}} id = \"errorMessage\" name=\"errorMessage\">{this.state.errorMessage}</p>\r\n            </div>\r\n\r\n            <input className = \"login-button\" type=\"submit\" value=\"Login\"></input>\r\n\r\n          </form>\r\n\r\n          <p className=\"login-create-account-p\" onClick={this.openSignUpForm}>Don't have an account? Sign up <i className=\"far fa-arrow-alt-circle-right\"></i></p>\r\n          <div className=\"login-apps-div\">\r\n            <a href=\"itms-apps://apps.apple.com/us/app/id1554705711\"><img className=\"login-appstore-img\" src={app_store} alt={\"Apple App Store\"}/></a>\r\n            <a style={{marginLeft: \"10px\"}} href=\"https://play.google.com/store/apps/details?id=com.kf6mobile&hl=en_US&gl=US\"><img className=\"login-appstore-img\" src={googleplay_store} alt={\"Google Play Store\"}/></a>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\n\r\nconst mapDispatchToProps = {\r\n    setGlobalToken,\r\n    setCurrentLoginForm\r\n};\r\n\r\nexport default compose(\r\n    withRouter,\r\n    connect(null, mapDispatchToProps)\r\n)(LoginForm)\r\n","import React, {Component} from 'react';\r\nimport Select from 'react-select';\r\nimport { withRouter } from 'react-router';\r\nimport { connect } from 'react-redux';\r\nimport { compose } from 'redux';\r\nimport ReCAPTCHA from 'react-google-recaptcha';\r\nimport { setCurrentLoginForm, setGlobalToken } from '../../store/globalsReducer.js'\r\nimport '../../../node_modules/bootstrap/dist/js/bootstrap.bundle.min.js';\r\nimport {SERVERS, getServerURL, siteKey} from '../../config.js';\r\nimport {postNewUser} from '../../legacy_api/user.js';\r\n\r\nimport './Login.css';\r\nimport './SignUpForm.css';\r\n\r\nclass SignUpForm extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      server: null,\r\n      firstname: null,\r\n      lastname: null,\r\n      email: null,\r\n      username: null,\r\n      password: null,\r\n      confirmPassword: null,\r\n      registrationKey: null,\r\n      errorMessage: null,\r\n      singaporeSelected: false,\r\n      recaptchaVerified: false,\r\n    }\r\n\r\n  }\r\n\r\n  inputChangeHandler = (event) => {\r\n    let name = event.target.name;\r\n    let val = event.target.value;\r\n\r\n    this.setState({[name] : val});\r\n  }\r\n\r\n  serverSelectHandler = (event) => {\r\n    event.value === getServerURL(\"Singapore\") ? this.setState({singaporeSelected: true}) : this.setState({singaporeSelected: false});\r\n    this.setState({server: event.value});\r\n  }\r\n\r\n  formSubmitHandler = (event) => {\r\n    event.preventDefault();\r\n    if(this.state.server === null) {\r\n      this.setState({errorMessage: \"Please select a server.\"});\r\n    } else if(/^[a-zA-Z][.0-9a-zA-Z@_-]{1,100}$/.test(this.state.username) === false) {\r\n      this.setState({errorMessage: [\"Username must meet the following requirements:\", <br />, \"1. Start with a letter\", <br />,\r\n      \"2. Not contain any white spaces\", <br />, \"3. Can only contain the special characters @._-\"]});\r\n    } else if(this.state.password !== this.state.confirmPassword){\r\n      this.setState({errorMessage: \"Passwords do not match.\"});\r\n    } else {\r\n      postNewUser(this.state.server, this.state.firstname, this.state.lastname, this.state.email, this.state.username, this.state.password, this.state.registrationKey).then((result) => {\r\n        if(result[0] && result[0].token !== undefined) {\r\n          localStorage.setItem(\"Username\", this.state.username);\r\n          localStorage.setItem(this.state.username, JSON.stringify([[result[1], result[0].token, \"active\"]]));\r\n          this.props.setGlobalToken(result[0].token);\r\n          this.props.history.push('/dashboard');\r\n        } else {\r\n          var resultErrorMessage = result[0].message || result[0].error || result[0].errorCode || result[0];\r\n          this.setState({errorMessage: resultErrorMessage});\r\n        }\r\n      });\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  openLoginForm = (event) => {\r\n    this.props.setCurrentLoginForm(\"Login\");\r\n  }\r\n\r\n  verifyRecaptcha = (event) => {\r\n    event === null ? this.setState({recaptchaVerified: false}) : this.setState({recaptchaVerified: true})\r\n  }\r\n\r\n  render() {\r\n    let userAuthenticationMethod;\r\n    if(this.state.singaporeSelected){\r\n      userAuthenticationMethod = <div className = \"login-input-wrapper\"><i className=\"fas fa-lock\"></i><input type=\"text\" id=\"registrationKey\" name=\"registrationKey\" placeholder=\"Singapore Account Creation Key\" required onChange={this.inputChangeHandler}></input></div>;\r\n    } else {\r\n      userAuthenticationMethod = <ReCAPTCHA sitekey={siteKey} onChange={this.verifyRecaptcha}/>;\r\n    }\r\n\r\n    let signUpButton;\r\n    if((this.state.recaptchaVerified === true && !this.state.singaporeSelected) || (this.state.singaporeSelected && this.state.registrationKey !== null)){\r\n      signUpButton = <input className = \"login-button\" type=\"submit\" value=\"Create Account\"></input>;\r\n    } else {\r\n      signUpButton = <input className = \"login-button login-disabled\" type=\"submit\" value=\"Create Account\" disabled></input>;\r\n    }\r\n\r\n    return(\r\n      <div className = \"row login-form-row\">\r\n        <div className = {\"col-lg-8 col-md-10 col-sm-12 login-form-wrapper\"}>\r\n          <h1>knowledgeforum.org</h1>\r\n          <form onSubmit={this.formSubmitHandler} className = \"loginForm\" id = \"loginForm\" autoComplete=\"on\">\r\n\r\n            <div className=\"login-input-wrapper signup-select-server\">\r\n              <i className=\"fas fa-server\"></i>\r\n              <div className=\"select-container\">\r\n                <Select\r\n                  placeholder={\"Select a Server\"}\r\n                  options={SERVERS.map((s) => ({value: s.url, label: s.name}))}\r\n                  onChange = {this.serverSelectHandler}\r\n                  className=\"basic-multi-select\"\r\n                  classNamePrefix=\"select\"\r\n                />\r\n              </div>\r\n              <div className=\"clearFix\"></div>\r\n            </div>\r\n\r\n            <div className = \"login-input-wrapper\">\r\n              <i className=\"fas fa-user\"></i>\r\n              <input type=\"text\" id=\"firstname\" name=\"firstname\" placeholder=\"First Name\" required onChange={this.inputChangeHandler}></input>\r\n            </div>\r\n\r\n            <div className = \"login-input-wrapper\">\r\n              <i className=\"fas fa-user\"></i>\r\n              <input type=\"text\" id=\"lastname\" name=\"lastname\" placeholder=\"Last Name\" required onChange={this.inputChangeHandler}></input>\r\n            </div>\r\n\r\n            <div className = \"login-input-wrapper\">\r\n              <i className=\"fas fa-envelope\"></i>\r\n              <input type=\"email\" id=\"email\" name=\"email\" placeholder=\"Email\" required onChange={this.inputChangeHandler}></input>\r\n            </div>\r\n\r\n            <div className = \"login-input-wrapper\">\r\n              <i className=\"fas fa-user\"></i>\r\n              <input type=\"text\" id=\"username\" name=\"username\" placeholder=\"Username\" minLength=\"3\" maxLength=\"49\" required onChange={this.inputChangeHandler}></input>\r\n            </div>\r\n\r\n            <div className = \"login-input-wrapper\">\r\n              <i className=\"fas fa-lock\"></i>\r\n              <input type=\"password\" id=\"password\" name=\"password\" placeholder=\"Password\" minLength=\"4\" required onChange={this.inputChangeHandler}></input>\r\n            </div>\r\n\r\n            <div className = \"login-input-wrapper\">\r\n              <i className=\"fas fa-lock\"></i>\r\n              <input type=\"password\" id=\"confirmPassword\" name=\"confirmPassword\" placeholder=\"Confirm Password\" required onChange={this.inputChangeHandler}></input>\r\n            </div>\r\n\r\n            {userAuthenticationMethod}\r\n\r\n            <div>\r\n              <p style={{color:'red'}} id = \"errorMessage\" name=\"errorMessage\">{this.state.errorMessage}</p>\r\n            </div>\r\n\r\n            {signUpButton}\r\n\r\n          </form>\r\n\r\n          <p className=\"login-create-account-p\" onClick={this.openLoginForm}>Already have an account? Login <i className=\"far fa-arrow-alt-circle-right\"></i></p>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nconst mapDispatchToProps = {\r\n    setGlobalToken,\r\n    setCurrentLoginForm\r\n};\r\n\r\nexport default compose(\r\n    withRouter,\r\n    connect(null, mapDispatchToProps)\r\n)(SignUpForm)\r\n","import React, { Component } from 'react'\r\nimport { Navbar, Nav, Button } from 'react-bootstrap'\r\nimport { Row, Col, Form, FormGroup, Input, InputGroup, InputGroupAddon, InputGroupText } from 'reactstrap'\r\nimport { connect } from 'react-redux'\r\nimport { withRouter } from 'react-router'\r\n\r\nimport { removeToken } from '../../store/api.js'\r\nimport { setViewId, setGlobalToken, setSearchQuery, setSearchFilter } from '../../store/globalsReducer'\r\n\r\nclass TopNavbar extends Component {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      query: '',\r\n    }\r\n\r\n    this.handleChange = this.handleChange.bind(this);\r\n  }\r\n\r\n  handleFilter = (e) => {\r\n      let value = e.target.value;\r\n      var query;\r\n      // set defaults for scaffold, author, and time search\r\n      if(value === \"scaffold\"){\r\n        // default scaffold is the first scaffold and its first support\r\n        query = this.props.scaffolds[0].supports[0].to;\r\n      } else if(value === \"author\"){\r\n        // default author is the current user\r\n        query = this.props.user.firstName + \" \" + this.props.user.lastName;\r\n      } else if(value === \"time\"){\r\n        // default time is today\r\n        query = \"today\";\r\n      } else {\r\n        query = '';\r\n      }\r\n      this.setState({query: query});\r\n      this.props.setSearchQuery(query);\r\n      this.props.setSearchFilter(value);\r\n  }\r\n\r\n  handleInputChange = (event) => {\r\n      const query = event.target.value\r\n      this.setState({query: query});\r\n      if(query === '' || this.props.filter === 'scaffold' || this.props.filter === \"author\" || this.props.filter === \"time\") this.props.setSearchQuery(query);\r\n  }\r\n\r\n  handleSearchSubmit = (e) => {\r\n    this.props.setSearchQuery(this.state.query);\r\n    e.preventDefault();\r\n  }\r\n\r\n  logout() {\r\n    sessionStorage.clear();\r\n    removeToken()//remove token from api header\r\n    setGlobalToken(null)//Remove token from store\r\n  }\r\n\r\n  handleChange(e) {\r\n    const viewId = e.target.value;\r\n    this.props.onViewClick(viewId);\r\n  }\r\n\r\n  signUp = (e) => {\r\n    this.props.history.push(\"/\");\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState){\r\n    if(this.props.currentView !== prevProps.currentView || this.props.viewId !== prevProps.viewId){\r\n      this.setState({query: ''});\r\n      this.props.setSearchQuery('');\r\n      this.props.setSearchFilter('title');\r\n      document.getElementById('queryForm').reset();\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const userName = this.props.user ? `${this.props.user.firstName} ${this.props.user.lastName}` : null\r\n\r\n    var searchInput;\r\n    if(this.props.filter === \"scaffold\"){\r\n      searchInput = <Input type=\"select\" onChange={this.handleInputChange}>\r\n                        {this.props.scaffolds.map((scaffold, i) => {\r\n                          return <optgroup key={i} label={scaffold.title}>\r\n                              {scaffold.supports.map((support, j) => {\r\n                                  return <option key={j} value={support.to}>{support._to.title}</option>;\r\n                              })}\r\n                          </optgroup>;\r\n                        })}\r\n                    </Input>;\r\n    } else if(this.props.filter === \"author\"){\r\n      searchInput = <Input type=\"select\" onChange={this.handleInputChange} defaultValue={this.props.user.firstName + \" \" + this.props.user.lastName}>\r\n                        {Object.values(this.props.authors).sort((a, b) => {\r\n                          var aName = (a.firstName + \" \" + a.lastName).toLowerCase();\r\n                          var bName = (b.firstName + \" \" + b.lastName).toLowerCase();\r\n                          if(aName < bName) return -1;\r\n                          if(aName > bName) return 1;\r\n                          return 0;\r\n                         }).map((author, i) => {\r\n                          var name = author.firstName + \" \" + author.lastName;\r\n                          return <option key={i} value={name}>{name}</option>;\r\n                         })\r\n                        }\r\n                    </Input>;\r\n    } else if(this.props.filter === \"time\") {\r\n      searchInput = <Input type=\"select\" onChange={this.handleInputChange} defaultValue=\"today\">\r\n                        <option value=\"today\">Past 24 hours</option>\r\n                        <option value=\"week\">Past 7 days</option>\r\n                        <option value=\"month\">Past 30 days</option>\r\n                        <option value=\"year\">Past year</option>\r\n                    </Input>;\r\n    } else {\r\n      searchInput = <Input\r\n          className=\"form-control\"\r\n          value={this.state.query}\r\n          placeholder=\"Search\"\r\n          onChange={this.handleInputChange}\r\n      />;\r\n    }\r\n\r\n    return (\r\n      <Navbar className=\"viewNavBar\">\r\n        {this.props.isDemo === false ? (\r\n          <Button className='mr-2 viewNavBar-logout-btn' onClick={this.props.goToDashboard}><i className=\"fas fa-home\"></i></Button>\r\n        ) : null}\r\n        <Navbar.Brand className=\"viewNavBar-brand d-none d-sm-block\">{this.props.communityTitle}</Navbar.Brand>\r\n\r\n        <Navbar.Text className=\"viewNavBar-dropdown-title\">View:</Navbar.Text>\r\n        <Nav className=\"viewNavBar-dropdown\">\r\n          {this.props.view ?\r\n            <Form>\r\n                <FormGroup className=\"viewNavBar-dropdown-formgroup\">\r\n                  <Input type=\"select\" name=\"viewId\" value={this.props.view._id} onChange={this.handleChange}>\r\n                    {\r\n                      this.props.views.map((obj) => {\r\n                        return <option key={obj._id} value={obj._id}> {obj.title} </option>\r\n                      })\r\n                    }\r\n                  </Input>\r\n                </FormGroup>\r\n            </Form>\r\n            : null}\r\n        </Nav>\r\n\r\n          <Navbar.Text className=\"viewNavBar-dropdown-title\">Search:</Navbar.Text>\r\n          <Form id={\"queryForm\"} onSubmit={this.handleSearchSubmit}>\r\n              <Row>\r\n                  <Col>\r\n                      <InputGroup>\r\n                          <InputGroupAddon addonType=\"prepend\">\r\n                              <Input type=\"select\" name=\"filter\" id=\"filter\" onChange={this.handleFilter}>\r\n                                  <option key=\"title\" value=\"title\">Title</option>\r\n                                  <option key=\"scaffold\" value=\"scaffold\">Scaffold</option>\r\n                                  <option key=\"content\" value=\"content\">Content</option>\r\n                                  <option key=\"author\" value=\"author\">Author</option>\r\n                                  <option key=\"time\" value=\"time\">Date Created</option>\r\n                              </Input>\r\n                          </InputGroupAddon>\r\n                          {searchInput}\r\n\r\n                          {<InputGroupAddon addonType=\"append\">\r\n                              <InputGroupText style={{ cursor: \"pointer\" }} onClick={this.handleSearchSubmit}>\r\n                                  <i className=\"fa fa-search\"></i>\r\n                              </InputGroupText>\r\n                          </InputGroupAddon>}\r\n                      </InputGroup>\r\n                  </Col>\r\n              </Row>\r\n          </Form>\r\n\r\n          <Nav className=\"ml-auto\">\r\n            <Nav.Link className=\"white mr-auto d-none d-sm-block\"> {userName} </Nav.Link>\r\n            {this.props.isDemo === false ? (\r\n              <Button className='ml-2 viewNavBar-logout-btn' href=\"/\" onClick={this.logout}>Logout</Button>\r\n            ) : null}\r\n         </Nav>\r\n\r\n      </Navbar>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state, ownProps) => {\r\n  return {\r\n    isDemo: state.globals.isDemo,\r\n    communityId: state.globals.communityId,\r\n    viewId: state.globals.viewId,\r\n    user: state.globals.author,\r\n    views: state.globals.views,\r\n    view: state.globals.view,\r\n    scaffolds: state.scaffolds.items,\r\n    authors: state.users,\r\n    supports: state.notes.supports,\r\n    query: state.globals.searchQuery,\r\n    filter: state.globals.searchFilter\r\n  }\r\n}\r\n\r\nconst mapDispatchToProps = {\r\n  setViewId,\r\n  setGlobalToken,\r\n  setSearchQuery,\r\n  setSearchFilter\r\n}\r\n\r\nexport default withRouter(connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(TopNavbar));\r\n","import React, {useState} from 'react';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport { Modal, Button, Form, ProgressBar} from 'react-bootstrap'\r\nimport { addNotification } from '../../store/notifier.js'\r\nimport { fetchAttachments, fetchLinks } from '../../store/noteReducer.js'\r\nimport { FileDrop } from 'react-file-drop';\r\nimport {url as serverUrl} from '../../store/api.js'\r\nimport './AttachPanel.css'\r\n\r\nimport {postAttachment, uploadFile, putObject, postLink, putLink} from '../../store/api.js'\r\n\r\n//TODO if dropping files is not supported\r\nconst AttachPanel = props => {\r\n    const author = useSelector(state => state.globals.author);\r\n    const dispatch = useDispatch();\r\n    const [progress, setProgress] = useState(0);\r\n\r\n    const  handleClose= (e) => {\r\n        props.onClose();\r\n    }\r\n    const onFileChange = (e) => {\r\n        onFileSelect(e.target.files);\r\n        // TODO After upload, clear input\r\n        /* e.target.value = null; */\r\n\r\n    }\r\n    const onFileSelect = async (fileList) => {\r\n        const files = Array.from(fileList)\r\n        setProgress(0)\r\n        // TODO googleOauth, googledrive\r\n        const upload_promises = []\r\n        files.forEach(async (file) => {\r\n            if (file.type.indexOf(\"image/\") >= 0){\r\n                const _URL = window.URL || window.webkitURL;\r\n                const img = await addImageProcess(_URL.createObjectURL(file))\r\n                var width  = img.naturalWidth  || img.width;\r\n                var height = img.naturalHeight || img.height;\r\n                file.width = width;\r\n                file.height = height;\r\n                upload_promises.push(createAttachment(file, 'image'))\r\n            }else if (file.type.startsWith('video')){\r\n                upload_promises.push(createAttachment(file, 'video'))\r\n            }else{\r\n                upload_promises.push(createAttachment(file, 'link'))\r\n            }\r\n        });\r\n\r\n        await Promise.all(upload_promises)\r\n        handleClose()\r\n        addNotification({title: 'Uploaded!', type:'success', message:'Attachments uploaded!'})\r\n    }\r\n    const addImageProcess = (src) => {\r\n        return new Promise((resolve, reject) => {\r\n            let img = document.createElement(\"img\")\r\n            img.onload = () => resolve(img)\r\n            img.onerror = reject\r\n            img.src = src\r\n        })\r\n    }\r\n    const createAttachment = async (file, type, x, y) => {\r\n        try {\r\n            const attachRes = await postAttachment(author.communityId, author._id)\r\n            const uploadRes = await uploadFile(file, onUploadProgress)\r\n            const attachment = attachRes.data\r\n            const data = uploadRes.data\r\n            attachment.title = data.filename;\r\n            attachment.status = 'active';\r\n            data.version = attachment.data.version + 1;\r\n            attachment.data = data;\r\n            attachment.tmpFilename = data.tmpFilename;\r\n            const newAttachment = await putObject(attachment, author.communityId, attachment._id)\r\n\r\n            newAttachment.data.width = file.width;\r\n            newAttachment.data.height = file.height;\r\n\r\n            if (props.noteId){\r\n                linkToNote(newAttachment, type);\r\n            }else if (props.viewId){\r\n                linkToView(newAttachment, x, y, type);\r\n            }\r\n        } catch (err) {\r\n            console.log(err)\r\n        } finally {\r\n\r\n        }\r\n\r\n    }\r\n\r\n    const linkToNote = async (attachment, type) => {\r\n            await postLink(props.noteId, attachment._id, 'attach')\r\n            //TODO updateFromConnections\r\n            dispatch(fetchLinks(props.noteId, 'from'))\r\n            if (props.inlineAttach){\r\n                const data_mce_src = `${serverUrl}${attachment.data.url}`;\r\n                const title = attachment.title;\r\n                let html = '';\r\n                if (type==='image') {\r\n                    html = '<img class=\"inline-attachment ' + attachment._id + '\" src=\"' + data_mce_src +'\" width=\"100px\" alt=\"' + title + '\" data-mce-src=\"' + data_mce_src + '\">';\r\n                } else if (type==='video') {\r\n                    html = `<video controls=\"controls\" width=\"300\" height=\"150\"> <source src=\"${data_mce_src}\" type=\"video/mp4\" /></video>`\r\n                } else {\r\n                    html ='<a class=\"inline-attachment ' + attachment._id + '\" href=\"' + data_mce_src + '\" target=\"_blank\" download>';\r\n                    html += `<img src=\"${serverUrl}/manual_assets/kf6images/03-toolbar-attachment.png\" alt=\"` + title + '\">' + title + '</a>';\r\n                }\r\n                props.onNewInlineAttach(html)\r\n            }\r\n            dispatch(fetchAttachments(props.noteId))\r\n            //TODO googledrive\r\n            /* if(newAttachment.data.type.indexOf('video') === 0 && $community.isPluginEnabled('googledrive')){\r\n             *     $scope.save2GoogleDrive(userName, newAttachment);\r\n             * } */\r\n    }\r\n\r\n    const linkToView = async (attachment, x, y, attach_type) => {\r\n        const newX = x ? x: 200;\r\n        const newY = y ? y: 200;\r\n        let w = 200;\r\n        let h = 200;\r\n        let showInPlace = false;\r\n        if (attach_type ==='image'){\r\n            w = attachment.data.width;\r\n            h = attachment.data.height;\r\n            if (w > 200){ w = 200; }\r\n            h = (w*h) / attachment.data.width;\r\n            showInPlace = true;\r\n        }\r\n        const link = await postLink(\r\n            props.viewId,\r\n            attachment._id,\r\n            'contains',\r\n            {x: newX, y: newY, width: w, height: h}\r\n        )\r\n        if (showInPlace){\r\n            link.data.showInPlace = true\r\n            await putLink(link._id, link)\r\n        }\r\n\r\n    }\r\n    const onUploadProgress = (progressEvent) => {\r\n        const percentCompleted = Math.round((progressEvent.loaded * 100) / progressEvent.total)\r\n        setProgress(percentCompleted)\r\n    }\r\n\r\n    const styles = { width: '100%', color: 'black' };\r\n    return (\r\n        <Modal show={props.attachPanel} onHide={handleClose}>\r\n            <Modal.Header closeButton>\r\n                <Modal.Title>Insert Attachment File</Modal.Title>\r\n            </Modal.Header>\r\n            <Modal.Body>\r\n                <Form.File id=\"custom-file\">\r\n                    <Form.File.Input onChange={onFileChange}/>\r\n                </Form.File>\r\n                <div style={styles}>\r\n                    <FileDrop\r\n                        onFrameDragEnter={(event) => console.log('onFrameDragEnter', event)}\r\n                        onFrameDragLeave={(event) => console.log('onFrameDragLeave', event)}\r\n                        onFrameDrop={(event) => console.log('onFrameDrop', event)}\r\n                        onDragOver={(event) => console.log('onDragOver', event)}\r\n                        onDragLeave={(event) => console.log('onDragLeave', event)}\r\n                        onDrop={(files, event) => onFileSelect(files)}\r\n                    >\r\n                        or drop some files here!\r\n                    </FileDrop>\r\n                </div>\r\n                <ProgressBar now={progress} />\r\n            </Modal.Body>\r\n            <Modal.Footer>\r\n                <Button variant=\"primary\" onClick={handleClose}>\r\n                    Close\r\n                </Button>\r\n            </Modal.Footer>\r\n        </Modal>\r\n    )\r\n\r\n};\r\n\r\nexport default AttachPanel;\r\n","// returns a promise that on fullfillment returns the object given by objectId\r\nexport function getApiObjectsObjectId(token, server, objectId) {\r\n  return fetch(server + 'api/objects/' + objectId, {\r\n    method: \"GET\",\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': 'Bearer ' + token\r\n    },\r\n  }).then(function(response) {\r\n    if(response.status !== 200){\r\n      console.log(\"Error: \" + server + 'api/objects/' + objectId);\r\n      console.log(response);\r\n    }\r\n    return response.json();\r\n  }).then(function(body) {\r\n    return (body);\r\n  }).catch(function(error) {\r\n    return (\"Error:\", error);\r\n  });\r\n}\r\n","import {getApiObjectsObjectId} from '../../../legacy_api/object.js';\r\n\r\n// adds the notes to the cytoscape graph\r\nexport function addNodesToGraph(server, token, nodes, nodeData, authorData, viewSettings, groups){\r\n  var graph_nodes = [];\r\n  for(var i = 0; i < nodeData.length; i++){\r\n\r\n    if(nodeData[i]._to.type === \"Note\" && nodeData[i]._to.title !== \"\" && nodeData[i]._to.status === \"active\"){\r\n      var id = createCytoscapeId(nodes, nodeData[i].to);\r\n      graph_nodes.push(handleNote(server, token, id, nodeData[i], authorData, viewSettings, groups));\r\n    } else if(nodeData[i]._to.type === \"Attachment\" && nodeData[i]._to.title !== \"\" && nodeData[i]._to.status === \"active\"){\r\n      graph_nodes.push(handleAttachment(server, token, nodes, nodeData[i], authorData, viewSettings, groups));\r\n    } else if(nodeData[i]._to.type === \"Drawing\" && nodeData[i]._to.title !== \"\" && nodeData[i]._to.status === \"active\"){\r\n      graph_nodes.push(handleDrawing(server, token, nodes, nodeData[i], authorData, viewSettings, groups));\r\n    } else if(nodeData[i]._to.type === \"View\" && nodeData[i]._to.title !== \"\" && nodeData[i]._to.status === \"active\"){\r\n      graph_nodes.push(handleView(nodes, nodeData[i], authorData));\r\n    }\r\n  }\r\n\r\n  return graph_nodes;\r\n}\r\n\r\n\r\n// adds the edges to the cytoscape graph\r\nexport function addEdgesToGraph(nodes, buildson, references, viewSettings){\r\n  var graph_edges = [];\r\n  var edgeData = buildson.concat(references);\r\n  for(var i = 0; i < edgeData.length; i++){\r\n    var obj = edgeData[i];\r\n\r\n    if(obj._to.type === \"Note\" && obj._to.status === \"active\" && obj._to.title !== \"\" && obj._from.type === \"Note\" && obj._from.status === \"active\" && obj._from.title !== \"\"){\r\n        var fromCount = nodes.get(obj.from);\r\n        var toCount = nodes.get(obj.to);\r\n\r\n        if(fromCount !== 'undefined' && toCount !== 'undefined'){\r\n          for(var j = 0; j < fromCount; j++){\r\n            for(var k = 0; k < toCount; k++){\r\n              graph_edges.push({\r\n                group: 'edges',\r\n                data: {\r\n                  id: obj._id + '-' + (parseInt(j) + 1) + (parseInt(k) + 1),\r\n                  source: obj.from + '-' + (parseInt(j) + 1),\r\n                  target: obj.to + '-' + (parseInt(k) + 1)\r\n                },\r\n                classes: obj.type,\r\n                initialDisplay: viewSettings[obj.type],\r\n              });\r\n            }\r\n          }\r\n        } else {\r\n          console.log(obj.from + \" fromCount: \" + fromCount + \"\\n\" + obj.to + \" toCount: \" + toCount);\r\n        }\r\n    }\r\n  }\r\n  return graph_edges;\r\n}\r\n\r\n\r\n// handles adding notes to the cytoscape instance\r\nfunction handleNote(server, token, id, nodeData, authorData, viewSettings, groups){\r\n  var authorName = matchAuthorId(nodeData._to.authors[0], authorData);\r\n  var date = parseDate(nodeData.created);\r\n  var readStatus, type;\r\n  var groupName = nodeData._to.group ? groups.find(group => group._id === nodeData._to.group).title : null;\r\n  var isPositionLocked = nodeData.data.draggable !== undefined ? !nodeData.data.draggable : false;\r\n  var canOpen = nodeData.data.fixed !== undefined ? !nodeData.data.fixed : true;\r\n\r\n  // handles whether it is a note or a riseabove\r\n  if(nodeData._to.data === undefined){\r\n    readStatus = 'unread-note';\r\n    type = \"note\";\r\n  } else {\r\n    readStatus = 'unread-riseabove';\r\n    type = \"riseabove\";\r\n  }\r\n\r\n  return {\r\n      group: 'nodes',\r\n      data: {\r\n        id: id,\r\n        name: nodeData._to.title,\r\n        groupName: groupName,\r\n        author: authorName,\r\n        date: date,\r\n        kfId: nodeData.to,\r\n        linkId: nodeData._id,\r\n        type: type,\r\n        canOpen: canOpen,\r\n      },\r\n      locked: isPositionLocked,\r\n      classes: [readStatus, viewSettings.nodeClass],\r\n      position: {\r\n        x: nodeData.data.x,\r\n        y: nodeData.data.y\r\n      }\r\n  };\r\n}\r\n\r\n\r\n// handles adding attachments to the cytoscape instance\r\nfunction handleAttachment(server, token, nodes, nodeData, authorData, viewSettings, groups){\r\n  var authorName = matchAuthorId(nodeData._to.authors[0], authorData);\r\n  var date = parseDate(nodeData.created);\r\n  var groupName = nodeData._to.group ? groups.find(group => group._id === nodeData._to.group).title : null;\r\n  var isPositionLocked = nodeData.data.draggable !== undefined ? !nodeData.data.draggable : false;\r\n  var showInPlace = nodeData.data.showInPlace !== undefined ? nodeData.data.showInPlace : false;\r\n  var canOpen = nodeData.data.fixed !== undefined ? !nodeData.data.fixed : true;\r\n\r\n  return getApiObjectsObjectId(token, server, nodeData.to).then(function(result){\r\n\r\n    if(String(result.data.type).substring(0,5) === \"image\" && showInPlace){\r\n      var imageUrl =  (server + String(result.data.url).substring(1,)).replace(/\\s/g,\"%20\");\r\n\r\n      if(String(result.data.type).slice(-3) === \"gif\"){\r\n        imageUrl = imageUrl.substring(0, imageUrl.length - 3) + \"mp4\";\r\n      }\r\n\r\n      var bounds = {\r\n        x: nodeData.data ? nodeData.data.x : 0,\r\n        y: nodeData.data ? nodeData.data.y : 0,\r\n        width: nodeData.data ? nodeData.data.width : 0,\r\n        height: nodeData.data ? nodeData.data.height : 0,\r\n      };\r\n\r\n      return {\r\n        url: imageUrl,\r\n        name: nodeData._to.title,\r\n        bounds: bounds,\r\n        locked: isPositionLocked,\r\n        linkId: nodeData._id,\r\n        author: authorName,\r\n        kfId: nodeData.to,\r\n        type: nodeData._to.type,\r\n      };\r\n\r\n    } else {\r\n\r\n      var id = createCytoscapeId(nodes, nodeData.to);\r\n      return {\r\n        group: 'nodes',\r\n        data: {\r\n          id: id,\r\n          name: nodeData._to.title,\r\n          groupName: groupName,\r\n          author: authorName,\r\n          date: date,\r\n          kfId: nodeData.to,\r\n          linkId: nodeData._id,\r\n          type: nodeData._to.type,\r\n          download: server + result.data.url.substring(1,),\r\n          canOpen: canOpen,\r\n        },\r\n        locked: isPositionLocked,\r\n        classes: [\"attachment\", viewSettings.nodeClass],\r\n        position: {\r\n          x: nodeData.data.x,\r\n          y: nodeData.data.y\r\n        }\r\n      };\r\n\r\n    }\r\n  });\r\n}\r\n\r\n\r\n// handles adding drawings to the cytoscape instance\r\nfunction handleDrawing(server, token, nodes, nodeData, authorData, viewSettings, groups){\r\n  var authorName = matchAuthorId(nodeData._to.authors[0], authorData);\r\n  var date = parseDate(nodeData.created);\r\n  var groupName = nodeData._to.group ? groups.find(group => group._id === nodeData._to.group).title : null;\r\n  var isPositionLocked = nodeData.data.draggable !== undefined ? !nodeData.data.draggable : false;\r\n  var showInPlace = nodeData.data.showInPlace !== undefined ? nodeData.data.showInPlace : false;\r\n  var canOpen = nodeData.data.fixed !== undefined ? !nodeData.data.fixed : true;\r\n\r\n  return getApiObjectsObjectId(token, server, nodeData.to).then(function(result){\r\n    if(showInPlace){\r\n      var parser = new DOMParser();\r\n      var doc = parser.parseFromString(result.data.svg, \"image/svg+xml\");\r\n\r\n      // use width and height from svg tag to find the aspect ratio\r\n      var svg_width = doc.childNodes[0].attributes.width.value;\r\n      var svg_height = doc.childNodes[0].attributes.height.value;\r\n      var aspect_ratio = svg_width/svg_height;\r\n\r\n      // use the given width and known aspect ratio to calculate appropiate height for svg\r\n      var node_width = parseInt(nodeData.data.width);\r\n      var node_height = node_width/aspect_ratio;\r\n\r\n      var bounds = {\r\n        x: nodeData.data ? nodeData.data.x : 0,\r\n        y: nodeData.data ? nodeData.data.y : 0,\r\n        height: nodeData.data ? node_height : 0,\r\n        width: nodeData.data ? parseInt(nodeData.data.width) : 0,\r\n      };\r\n\r\n      return {\r\n        url: 'data:image/svg+xml;utf8,' + encodeURIComponent('<?xml version=\"1.0\" encoding=\"UTF-8\"?><!DOCTYPE svg>' + result.data.svg),\r\n        name: nodeData._to.title,\r\n        bounds: bounds,\r\n        locked: isPositionLocked,\r\n        author: authorName,\r\n        kfId: nodeData.to,\r\n        type: nodeData._to.type,\r\n        linkId: nodeData._id\r\n      };\r\n\r\n    } else {\r\n\r\n      var id = createCytoscapeId(nodes, nodeData.to);\r\n      return {\r\n        group: 'nodes',\r\n        data: {\r\n          id: id,\r\n          name: nodeData._to.title,\r\n          groupName: groupName,\r\n          author: authorName,\r\n          date: date,\r\n          kfId: nodeData.to,\r\n          linkId: nodeData._id,\r\n          type: nodeData._to.type,\r\n          download: 'data:image/svg+xml;utf8,' + encodeURIComponent('<?xml version=\"1.0\" encoding=\"UTF-8\"?><!DOCTYPE svg>' + result.data.svg),\r\n          canOpen: canOpen,\r\n        },\r\n        locked: isPositionLocked,\r\n        classes: [\"attachment\", viewSettings.nodeClass],\r\n        position: {\r\n          x: nodeData.data.x,\r\n          y: nodeData.data.y\r\n        }\r\n      }\r\n\r\n    }\r\n  });\r\n}\r\n\r\n\r\n// handles adding a link to another view\r\nfunction handleView(nodes, nodeData, authorData){\r\n  var id = createCytoscapeId(nodes, nodeData.to);\r\n  var authorName = matchAuthorId(nodeData._to.authors[0], authorData);\r\n  var isPositionLocked = nodeData.data.draggable !== undefined ? !nodeData.data.draggable : false;\r\n  var canOpen = nodeData.data.fixed !== undefined ? !nodeData.data.fixed : true;\r\n\r\n  return {\r\n    group: 'nodes',\r\n    data: {\r\n      id: id,\r\n      author: authorName,\r\n      name: nodeData._to.title,\r\n      kfId: nodeData.to,\r\n      linkId: nodeData._id,\r\n      type: nodeData._to.type,\r\n      communityId: nodeData.communityId,\r\n      canOpen: canOpen,\r\n    },\r\n    locked: isPositionLocked,\r\n    classes: \"view\",\r\n    position: {\r\n      x: nodeData.data.x,\r\n      y: nodeData.data.y\r\n    }\r\n  };\r\n}\r\n\r\n\r\n// helper function to find an authors name from their author id using the getCommunityAuthors data\r\nfunction matchAuthorId(authorId, authorsInfo){\r\n    for(let i in authorsInfo){\r\n      if(authorId === authorsInfo[i]._id){\r\n        return authorsInfo[i].firstName + \" \" + authorsInfo[i].lastName;\r\n      }\r\n    }\r\n    return \"Author not found\";\r\n}\r\n\r\n\r\n// helper function to return formatted creation date of a note\r\nfunction parseDate(date){\r\n  var year = date.substring(0, 4);\r\n  var month = date.substring(5, 7);\r\n  var day = date.substring(8, 10);\r\n  var hour = date.substring(11, 13);\r\n  var minute = date.substring(14, 16);\r\n  var second = date.substring(17, 19);\r\n  if(hour < 12){\r\n    return(month + \"/\" + day + \"/\" + year + \", \" + hour + \":\" + minute + \":\" + second + \" AM\");\r\n  } else {\r\n    return(month + \"/\" + day + \"/\" + year + \", \" + (hour - 12) + \":\" + minute + \":\" + second + \" PM\");\r\n  }\r\n}\r\n\r\n\r\n// returns a unique cytoscape id corresponding to the given kf id\r\nfunction createCytoscapeId(nodes, kfId){\r\n  // create the notes unique id\r\n  // example id would be \"5a0497f1ad39ced746109d6e-1\"\r\n  // the number fixed on the end is the count of that id on this view\r\n  if(nodes.has(kfId)){\r\n    nodes.set(kfId, nodes.get(kfId) + 1);\r\n    return kfId + '-' + nodes.get(kfId);\r\n  } else {\r\n    nodes.set(kfId, 1);\r\n    return kfId + '-1';\r\n  }\r\n}\r\n","import React, {Component} from 'react'\r\nimport { connect } from 'react-redux'\r\nimport Cytoscape from 'cytoscape';\r\nimport CytoscapeComponent from 'react-cytoscapejs';\r\nimport CytoscapePanZoom from 'cytoscape-panzoom';\r\nimport CytoscapeNodeHtmlLabel from 'cytoscape-node-html-label';\r\nimport CytoscapeSupportImages from 'cytoscape-supportimages';\r\nimport CytoscapeContextMenus from 'cytoscape-context-menus';\r\nimport CytoscapeSpread from 'cytoscape-spread';\r\n\r\nimport { updateViewLink } from '../../../store/async_actions.js'\r\nimport { addNotification } from '../../../store/notifier.js'\r\nimport {addNodesToGraph, addEdgesToGraph } from './GraphView_helper.js';\r\nimport './cytoscape.js-panzoom.css';\r\nimport 'cytoscape-context-menus/cytoscape-context-menus.css';\r\nimport './GraphView.css';\r\n\r\n\r\nimport unread_note_icon from '../../../assets/icon_note_blue.png';\r\nimport read_note_icon from '../../../assets/icon_note_red.png';\r\nimport unread_riseabove_icon from '../../../assets/icon_riseabove_blue.png';\r\nimport read_riseabove_icon from '../../../assets/icon_riseabove_red.png';\r\nimport attachment_icon from '../../../assets/icon_attachment.gif';\r\nimport view_icon from '../../../assets/icon_view.png';\r\nimport {MIN_ZOOMED_FONT_SIZE, MINZOOM, MAXZOOM} from '../../../config.js';\r\n\r\nCytoscape.use(CytoscapePanZoom);\r\nCytoscape.use(CytoscapeNodeHtmlLabel);\r\nCytoscape.use(CytoscapeSupportImages);\r\nCytoscape.use(CytoscapeContextMenus);\r\nCytoscape.use(CytoscapeSpread);\r\n\r\nclass GraphView extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      elements: {nodes: [], edges: []},\r\n      kfToCyMap: null,\r\n      removedSearchElements: null,\r\n      removedBoxSelectElements: null,\r\n      removedEdgeElements: null,\r\n      currViewLinksLength: 0,\r\n    };\r\n\r\n    this.loadElements = this.loadElements.bind(this);\r\n    this.supportImageIsDuplicate = this.supportImageIsDuplicate.bind(this);\r\n    this.compareSupportImages = this.compareSupportImages.bind(this);\r\n    this.findCyIdsFromKfId = this.findCyIdsFromKfId.bind(this);\r\n    this.updateReadLinks = this.updateReadLinks.bind(this);\r\n    this.focusRecentAddition = this.focusRecentAddition.bind(this);\r\n    this.filterNodes = this.filterNodes.bind(this);\r\n    this.handleNodeOpen = this.handleNodeOpen.bind(this);\r\n    this.getViewSettingsInfo = this.getViewSettingsInfo.bind(this);\r\n    this.updateViewSettings = this.updateViewSettings.bind(this);\r\n    this.runLayout = this.runLayout.bind(this);\r\n  };\r\n\r\n  loadElements(prevViewLinksLength, forceRender) {\r\n      // ensure we have all the informationn needed to render the graph\r\n      // if ((VIEWLINKS UPDATED OR FORCE RENDER FROM EDGE CASE) AND WE HAVE BUILDSON + AUTHORS INFO)\r\n      // only the viewlinks prop changes between views - buildson and author info stays the same\r\n      if ((Object.keys(this.props.viewLinks).length !== this.state.currViewLinksLength || forceRender) && this.props.buildsOn.length !== 0\r\n                                          && this.props.references !== undefined && Object.keys(this.props.authors).length !== 0){\r\n          this.setState({currViewLinksLength: Object.keys(this.props.viewLinks).length});\r\n          const cy = this.cy;\r\n          const si = cy.supportimages();\r\n\r\n          // we keep a map with (key, value) of (kfId, count) in order to create duplicate notes with unique ids\r\n          // append the count to the end of their note id\r\n          var nodes = new Map();\r\n\r\n          // clear the support images extension\r\n          si._private.supportImages = [];\r\n\r\n          var viewSettings = this.getViewSettingsInfo();\r\n          var groups = this.props.community ? this.props.community.groups : [];\r\n\r\n          var graph_nodes = addNodesToGraph(this.props.server, this.props.token, nodes, Object.values(this.props.viewLinks), this.props.authors, viewSettings, groups);\r\n          var graph_edges = addEdgesToGraph(nodes, this.props.buildsOn, this.props.references, viewSettings);\r\n          var self = this;\r\n\r\n          Promise.all(graph_nodes.concat(graph_edges)).then((graph_results) => {\r\n              var cy_elements = {nodes: [], edges: []};\r\n              var initialRemovedEdgeElements = {edges: []};\r\n              for(let i = 0; i < graph_results.length; i++){\r\n                  if(graph_results[i].group === \"nodes\"){\r\n                      cy_elements.nodes.push(graph_results[i]);\r\n                  } else if(graph_results[i].group === \"edges\" && graph_results[i].initialDisplay === true){\r\n                      cy_elements.edges.push(graph_results[i]);\r\n                  } else if(graph_results[i].group === \"edges\" && graph_results[i].initialDisplay === false){\r\n                      initialRemovedEdgeElements.edges.push(graph_results[i]);\r\n                  } else if(graph_results[i].url && !this.supportImageIsDuplicate(si.images(), graph_results[i])){\r\n                      si.addSupportImage(graph_results[i]);\r\n                  }\r\n              }\r\n\r\n              self.setState({\r\n                elements: cy_elements,\r\n                kfToCyMap: nodes,\r\n                removedEdgeElements: initialRemovedEdgeElements\r\n              });\r\n              // support-images extension will not trigger a redraw if there are no images in the view (images could be leftover from last view) - this line handles that\r\n              if(si.images().length === 0){ si._private.renderer.redraw(); }\r\n              // if a single new element was added to the graph - highlight it\r\n              if(Object.values(this.props.viewLinks).length === prevViewLinksLength + 1){ this.focusRecentAddition(Object.values(this.props.viewLinks)[Object.values(this.props.viewLinks).length - 1]); }\r\n          });\r\n      }\r\n  }\r\n\r\n  // checks if the given image a is already present in the list of support images\r\n  supportImageIsDuplicate(imgs, a){\r\n    for(var i in imgs){\r\n      if(this.compareSupportImages(imgs[i], a)) return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  // returns a deep comparison of two support images\r\n  compareSupportImages(a, b){\r\n    return a.bounds.height === b.bounds.height && a.bounds.width === b.bounds.width && a.bounds.x === b.bounds.x && a.bounds.y === b.bounds.y\r\n        && a.name === b.name && a.url === b.url;\r\n  }\r\n\r\n  // returns an array of cytoscapeIds corresponding to the given kfId\r\n  findCyIdsFromKfId(kfId){\r\n    var map = this.state.kfToCyMap;\r\n    if(map.has(kfId)){\r\n      var cytoscapeIds = [];\r\n      var countInstances = map.get(kfId);\r\n      for(let i = 1; i <= countInstances; i++){\r\n        cytoscapeIds.push(kfId+'-'+i);\r\n      }\r\n      return cytoscapeIds;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  // all links are initially marked as unread - this function updates the read links accordingly afterward\r\n  updateReadLinks(){\r\n    var cy = this.cy;\r\n    var readLinks = this.props.readLinks;\r\n    var self = this;\r\n\r\n    if(this.state.kfToCyMap !== null){\r\n      // cy.batch() updates all the elements one time instead of triggering multiple redraws\r\n      cy.batch(function(){\r\n        for(let i in readLinks){\r\n          var cy_elems = self.findCyIdsFromKfId(readLinks[i]); // the element will either be a riseabove or a regular note\r\n          if(cy_elems !== null && cy_elems.length !== 0){\r\n            var isRiseAbove = cy.$('#'+cy_elems[0]).hasClass('unread-riseabove') ? true : false;\r\n            var classToRemove = isRiseAbove ? 'unread-riseabove' : 'unread-note';\r\n            var classToAdd = isRiseAbove ? 'read-riseabove' : 'read-note';\r\n            for(let i in cy_elems){\r\n              cy.$('#'+cy_elems[i]).removeClass(classToRemove).addClass(classToAdd);\r\n            }\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  // handles highlighting the position of any new note added to the graph after its already been rendered\r\n  focusRecentAddition(note){\r\n    var cy = this.cy;\r\n    var kfId = note.to;\r\n    var cyIds = this.findCyIdsFromKfId(kfId);\r\n    if(cyIds !== null){\r\n      var newestCyElem = cy.$('#'+cyIds[cyIds.length - 1]);\r\n      newestCyElem.addClass('recentAddition');\r\n      newestCyElem.on(['select', 'grabon'], () => {\r\n        newestCyElem.removeClass('recentAddition');\r\n      });\r\n    }\r\n  }\r\n\r\n  // handles the search by the various queries\r\n  filterNodes(q){\r\n    var cy = this.cy;\r\n    const si = cy.supportimages();\r\n\r\n    if(this.state.removedSearchElements !== null) this.state.removedSearchElements.restore();\r\n    this.setState({removedSearchElements: null});\r\n    var imgs = si.images();\r\n    for(let i in imgs){\r\n      si.setImageVisible(imgs[i], true);\r\n    }\r\n\r\n    var nodesToHide = cy.collection();\r\n    const query = q || this.props.searchQuery;\r\n    const notes = Object.values(this.props.viewNotes);\r\n    var filter = this.props.searchFilter;\r\n    var self = this;\r\n    switch (filter) {\r\n        case \"title\":\r\n            nodesToHide = cy.filter(function(elem, i){\r\n               const elem_type = elem.data('type');\r\n               const elem_title = elem.data('name');\r\n               if((elem_type === \"note\" || elem_type === \"View\" || elem_type === \"riseabove\" || elem_type === \"Attachment\") && !elem_title.toLowerCase().includes(query.toLowerCase())){\r\n                 return elem;\r\n               }\r\n\r\n               return null;\r\n            });\r\n\r\n            // for(let i in imgs){\r\n            //   var supportImg = imgs[i];\r\n            //   if(!supportImg.name.toLowerCase().includes(query.toLowerCase())){\r\n            //     si.setImageVisible(supportImg, false);\r\n            //   }\r\n            // }\r\n\r\n            break;\r\n\r\n        case \"content\":\r\n            notes.filter(function (obj) {\r\n                if (obj.data && ( (obj.data.English && !obj.data.English.includes(query)) || (obj.data.body && !obj.data.body.includes(query)) ) ) {\r\n                  var cy_ids = self.findCyIdsFromKfId(obj._id);\r\n                  for(let j in cy_ids){ nodesToHide = nodesToHide.union(cy.$('#'+cy_ids[j])); }\r\n                }\r\n                return null;\r\n            });\r\n\r\n            break;\r\n\r\n        case \"author\":\r\n            nodesToHide = cy.filter(function(elem, i){\r\n               const elem_type = elem.data('type');\r\n               const elem_author = elem.data('author');\r\n               if((elem_type === \"note\" || elem_type === \"View\" || elem_type === \"riseabove\" || elem_type === \"Attachment\") && !elem_author.toLowerCase().includes(query.toLowerCase())){\r\n                 return elem;\r\n               }\r\n               return null;\r\n            });\r\n\r\n            // for(let i in imgs){\r\n            //   var supportImg = imgs[i];\r\n            //   if(!supportImg.author.toLowerCase().includes(query.toLowerCase())){\r\n            //     si.setImageVisible(supportImg, false);\r\n            //   }\r\n            // }\r\n\r\n            break;\r\n\r\n        case \"scaffold\":\r\n            const noteIds = this.props.supports.filter(support => support.from === query).map(support => support.to);\r\n            notes.filter(function(note){\r\n              if(!noteIds.includes(note._id)){\r\n                var cy_ids = self.findCyIdsFromKfId(note._id);\r\n                for(let j in cy_ids){ nodesToHide = nodesToHide.union(cy.$('#'+cy_ids[j])); }\r\n              }\r\n              return null;\r\n            });\r\n            break;\r\n\r\n        case \"time\":\r\n            var curr_date = new Date();\r\n            nodesToHide = cy.filter(function(elem, i){\r\n               const elem_date = new Date(elem.data('date'));\r\n               if(elem.data('date') !== undefined && elem_date !== \"Invalid Date\"){\r\n                 var diff = curr_date - elem_date;\r\n                 var secondsDiff = diff/1000;\r\n\r\n                 if((query === \"today\" && !(secondsDiff <= 86400)) ||\r\n                    (query === \"week\" && !(secondsDiff <= 604800)) ||\r\n                    (query === \"month\" && !(secondsDiff <= 2592000)) ||\r\n                    (query === \"year\" && !(secondsDiff <= 31556952))){ return elem; }\r\n               }\r\n               return null;\r\n            });\r\n            break;\r\n\r\n        default:\r\n            break;\r\n    }\r\n\r\n    if(nodesToHide.length !== 0){\r\n      var removedSearchElements = cy.remove(nodesToHide);\r\n      this.setState({removedSearchElements: removedSearchElements});\r\n    }\r\n  }\r\n\r\n  // handles the opening of different types of nodes on the graph\r\n  handleNodeOpen(evt){\r\n    var cy_node = evt.target;\r\n    var kfId = cy_node.data('kfId');\r\n    var type = cy_node.data('type');\r\n\r\n    if(!cy_node.data('canOpen')){\r\n      addNotification({ title: 'Cannot open contribution: \"' + cy_node.data('name') + '\"', type: 'default', message: '\"' + cy_node.data('name') + '\" is locked.' })\r\n    } else if(cy_node.hasClass(\"attachment\") || type === \"riseabove\" || type === \"note\") {\r\n      this.props.onNoteClick(kfId);\r\n      if(type === \"riseabove\"){ cy_node.addClass('read-riseabove').removeClass('unread-riseabove'); }\r\n      if(type === \"note\"){ cy_node.addClass('read-note').removeClass('unread-note'); }\r\n    } else if(cy_node.hasClass('view')) {\r\n      this.props.onViewClick(kfId);\r\n    }\r\n  }\r\n\r\n  // formats the view settings to be used in cytoscape\r\n  getViewSettingsInfo(){\r\n    var viewSettings = this.props.currViewSettingsObj;\r\n    var result = {};\r\n    if(viewSettings.showGroup && viewSettings.showAuthor && viewSettings.showTime){ result.nodeClass = 'nodehtmllabel-group-author-date'; }\r\n    else if(viewSettings.showGroup && viewSettings.showAuthor && !viewSettings.showTime){ result.nodeClass = 'nodehtmllabel-group-author-nodate'; }\r\n    else if(viewSettings.showGroup && !viewSettings.showAuthor && viewSettings.showTime){ result.nodeClass = 'nodehtmllabel-group-noauthor-date'; }\r\n    else if(viewSettings.showGroup && !viewSettings.showAuthor && !viewSettings.showTime) { result.nodeClass = 'nodehtmllabel-group-noauthor-nodate'; }\r\n    else if(!viewSettings.showGroup && viewSettings.showAuthor && viewSettings.showTime) { result.nodeClass = 'nodehtmllabel-nogroup-author-date'; }\r\n    else if(!viewSettings.showGroup && viewSettings.showAuthor && !viewSettings.showTime) { result.nodeClass = 'nodehtmllabel-nogroup-author-nodate'; }\r\n    else if(!viewSettings.showGroup && !viewSettings.showAuthor && viewSettings.showTime) { result.nodeClass = 'nodehtmllabel-nogroup-noauthor-date'; }\r\n    else if(!viewSettings.showGroup && !viewSettings.showAuthor && !viewSettings.showTime) { result.nodeClass = 'nodehtmllabel-nogroup-noauthor-nodate'; }\r\n\r\n    result.buildson = viewSettings.buildson;\r\n    result.references = viewSettings.references;\r\n    return result;\r\n  }\r\n\r\n  // batch updates the nodes and edges styling corresponding to the view settings\r\n  updateViewSettings(){\r\n    var cy = this.cy;\r\n\r\n    if(this.state.removedEdgeElements !== null && this.state.removedEdgeElements.edges) cy.add(this.state.removedEdgeElements);\r\n    else if(this.state.removedEdgeElements !== null) this.state.removedEdgeElements.restore();\r\n    this.setState({removedEdgeElements: null});\r\n\r\n    var nodes = cy.nodes();\r\n    var edges = cy.edges();\r\n    var newInfo = this.getViewSettingsInfo();\r\n    var self = this;\r\n    cy.batch(function(){\r\n\r\n      if(nodes.length !== 0){\r\n        // iterate cytoscape nodes\r\n        for(let i in nodes){\r\n          if(nodes[i][0] && nodes[i][0].classes()){\r\n\r\n            // iterate the nodes classes to see if it has a class with prefix 'nodehtmllabel'\r\n            // if it does replace it with the nodeClass in the newInfo object\r\n            var classes = nodes[i][0].classes();\r\n            for(let j in classes){\r\n              if(classes[j].substring(0,13) === 'nodehtmllabel' && classes[j] !== newInfo.nodeClass){\r\n                nodes[i].removeClass(classes[j]).addClass(newInfo.nodeClass);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      if(edges.length !== 0){\r\n        var edgesToHide = cy.collection();\r\n        // iterate cytoscape edges\r\n        for(let i in edges){\r\n          // if the edge is a buildson and buildson are hidden OR if the edge is a reference and references are hidden - add it to the collection of edges to be removed\r\n          if(edges[i][0] && ((edges[i][0].hasClass('buildson') && newInfo.buildson === false) || ((edges[i][0].hasClass('references') && newInfo.references === false)))){\r\n            edgesToHide = edgesToHide.union(edges[i][0]);\r\n          }\r\n        }\r\n\r\n        if(edgesToHide.length !== 0){\r\n          var removedEdgeElements = cy.remove(edgesToHide);\r\n          self.setState({removedEdgeElements: removedEdgeElements});\r\n        }\r\n      }\r\n    });\r\n\r\n  }\r\n\r\n  // helper function for handling running different types of layouts\r\n  runLayout(layoutType){\r\n    var cy = this.cy;\r\n    // for preset we dont actually run the cytoscape \"preset\" layout we just reset the state and rerender the entire graph\r\n    if(layoutType === \"preset\"){\r\n      this.setState({\r\n        elements: {nodes: [], edges: []},\r\n        removedSearchElements: null,\r\n        removedBoxSelectElements: null,\r\n        removedEdgeElements: null,\r\n      });\r\n      this.loadElements(Object.keys(this.props.viewLinks).length, true);\r\n      cy.reset();\r\n    } else {\r\n      // for spread layout we specify some parameters for running it, otherwise we run the layouts as default\r\n      var layout = (layoutType === \"spread\") ? ({\r\n        name: layoutType,\r\n        animate: false,\r\n        prelayout: false,\r\n      })\r\n      : {name: layoutType};\r\n      cy.layout(layout).run();\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    var cy = this.cy;\r\n    var ref = this;\r\n\r\n    // CYTOSCAPE-PANZOOM EXTENSION\r\n    // the default values of each option are outlined below:\r\n    var defaults = {\r\n      zoomFactor: 0.05, // zoom factor per zoom tick\r\n      zoomDelay: 45, // how many ms between zoom ticks\r\n      minZoom: MINZOOM, // min zoom level\r\n      maxZoom: MAXZOOM, // max zoom level\r\n      fitPadding: 50, // padding when fitting\r\n      panSpeed: 10, // how many ms in between pan ticks\r\n      panDistance: 10, // max pan distance per tick\r\n      panDragAreaSize: 75, // the length of the pan drag box in which the vector for panning is calculated (bigger = finer control of pan speed and direction)\r\n      panMinPercentSpeed: 0.25, // the slowest speed we can pan by (as a percent of panSpeed)\r\n      panInactiveArea: 8, // radius of inactive area in pan drag box\r\n      panIndicatorMinOpacity: 0.5, // min opacity of pan indicator (the draggable nib); scales from this to 1.0\r\n      zoomOnly: false, // a minimal version of the ui only with zooming (useful on systems with bad mousewheel resolution)\r\n      fitSelector: undefined, // selector of elements to fit\r\n      animateOnFit: function(){ // whether to animate on fit\r\n        return false;\r\n      },\r\n      fitAnimationDuration: 1000, // duration of animation on fit\r\n\r\n      // icon class names\r\n      sliderHandleIcon: 'fa fa-minus',\r\n      zoomInIcon: 'fa fa-plus',\r\n      zoomOutIcon: 'fa fa-minus',\r\n      resetIcon: 'fa fa-expand'\r\n    };\r\n\r\n    // add the panzoom control\r\n    cy.panzoom( defaults );\r\n\r\n    // CYTOSCAPE CONTEXT MENU EXTENSION (RIGHT CLICK MENU)\r\n    var options = {\r\n        evtType: ['cxttap', 'cysupportimages.imageselected'],\r\n        menuItems: [\r\n          {\r\n            id: 'open',\r\n            content: 'Open',\r\n            selector: 'node',\r\n            onClickFunction: function (evt) {\r\n              ref.handleNodeOpen(evt)\r\n            },\r\n            disabled: false,\r\n            coreAsWell: false,\r\n          },\r\n          {\r\n            id: 'new-note',\r\n            content: 'New Note Here',\r\n            selector: '',\r\n            coreAsWell: true,\r\n            onClickFunction: function (evt) {\r\n              console.log('new note');\r\n            }\r\n          }\r\n        ],\r\n    };\r\n\r\n    cy.contextMenus(options);\r\n\r\n    // CYTOSCAPE-NODE-HTML-LABEL EXTENSION\r\n    cy.nodeHtmlLabel([\r\n      {\r\n        query: '.nodehtmllabel-group-author-date',\r\n        halign: 'center', // title horizontal position. Can be 'left',''center, 'right'\r\n        valign: 'bottom', // title vertical position. Can be 'top',''center, 'bottom'\r\n        halignBox: 'right', // title relative box horizontal position. Can be 'left',''center, 'right'\r\n        valignBox: 'bottom', // title relative box vertical position. Can be 'top',''center, 'bottom'\r\n        cssClass: 'cytoscape-label', // any classes will be as attribute of <div> container for every title\r\n        tpl: function(data){\r\n          if(data.type === 'note' || data.type === 'riseabove' || data.type === 'Attachment' || data.type === 'Drawing'){\r\n            return '<div>' + (data.groupName !== null ? data.groupName : data.author) + '<br>' + data.date + '</div>';\r\n          }\r\n        }\r\n      },\r\n      {\r\n        query: '.nodehtmllabel-group-author-nodate',\r\n        halign: 'center',\r\n        valign: 'bottom',\r\n        halignBox: 'right',\r\n        valignBox: 'bottom',\r\n        cssClass: 'cytoscape-label',\r\n        tpl: function(data){\r\n          if(data.type === 'note' || data.type === 'riseabove' || data.type === 'Attachment' || data.type === 'Drawing'){\r\n            return '<div>' + (data.groupName !== null ? data.groupName : data.author) + '</div>';\r\n          }\r\n        }\r\n      },\r\n      {\r\n        query: '.nodehtmllabel-group-noauthor-date',\r\n        halign: 'center',\r\n        valign: 'bottom',\r\n        halignBox: 'right',\r\n        valignBox: 'bottom',\r\n        cssClass: 'cytoscape-label',\r\n        tpl: function(data){\r\n          if(data.type === 'note' || data.type === 'riseabove' || data.type === 'Attachment' || data.type === 'Drawing'){\r\n            return (data.groupName !== null) ? ('<div>' + data.groupName + '<br>' + data.date + '</div>') : ('<div>' + data.date + '</div>');\r\n          }\r\n        }\r\n      },\r\n      {\r\n        query: '.nodehtmllabel-group-noauthor-nodate',\r\n        halign: 'center',\r\n        valign: 'bottom',\r\n        halignBox: 'right',\r\n        valignBox: 'bottom',\r\n        cssClass: 'cytoscape-label',\r\n        tpl: function(data){\r\n          if(data.type === 'note' || data.type === 'riseabove' || data.type === 'Attachment' || data.type === 'Drawing'){\r\n            return '<div>' + (data.groupName !== null ? data.groupName : '') + '</div>';\r\n          }\r\n        }\r\n      },\r\n      {\r\n        query: '.nodehtmllabel-nogroup-author-date',\r\n        halign: 'center',\r\n        valign: 'bottom',\r\n        halignBox: 'right',\r\n        valignBox: 'bottom',\r\n        cssClass: 'cytoscape-label',\r\n        tpl: function(data){\r\n          if(data.type === 'note' || data.type === 'riseabove' || data.type === 'Attachment' || data.type === 'Drawing'){\r\n            return '<div>' + data.author + '<br>' + data.date + '</div>';\r\n          }\r\n        }\r\n      },\r\n      {\r\n        query: '.nodehtmllabel-nogroup-author-nodate',\r\n        halign: 'center',\r\n        valign: 'bottom',\r\n        halignBox: 'right',\r\n        valignBox: 'bottom',\r\n        cssClass: 'cytoscape-label',\r\n        tpl: function(data){\r\n          if(data.type === 'note' || data.type === 'riseabove' || data.type === 'Attachment' || data.type === 'Drawing'){\r\n            return '<div>' + data.author + '</div>';\r\n          }\r\n        }\r\n      },\r\n      {\r\n        query: '.nodehtmllabel-nogroup-noauthor-date',\r\n        halign: 'center',\r\n        valign: 'bottom',\r\n        halignBox: 'right',\r\n        valignBox: 'bottom',\r\n        cssClass: 'cytoscape-label',\r\n        tpl: function(data){\r\n          if(data.type === 'note' || data.type === 'riseabove' || data.type === 'Attachment' || data.type === 'Drawing'){\r\n            return '<div>' + data.date + '</div>';\r\n          }\r\n        }\r\n      },\r\n    ]);\r\n\r\n    this.loadElements();\r\n\r\n    // open contribution on tap of its node\r\n    cy.on('tap', 'node', function(evt){\r\n      ref.handleNodeOpen(evt);\r\n    });\r\n\r\n    // when a node is selected in a box select add styling to reflect that + remove the unselected nodes from the graph\r\n    cy.on('boxselect', 'node', (evt) => {\r\n      var cy_node = evt.target;\r\n      cy_node.addClass('selected')\r\n      var nodesToHide = cy.remove(cy.elements(\"node:unselected\"));\r\n      ref.setState({removedBoxSelectElements: nodesToHide});\r\n    });\r\n\r\n    // run the spread layout for visibility + notify user how to restore the graph when a box selection is finished\r\n    cy.on('boxend', (evt) => {\r\n      addNotification({\r\n        title: 'Layout Tooltip',\r\n        type: 'default',\r\n        message: 'Use the \"Original\" layout on the sidebar button to restore the graph to its initial state.',\r\n        dismiss: {duration: 5000}\r\n      })\r\n      if(ref.props.layout !== \"spread\") ref.props.updateParentLayoutProp({target: {value: \"spread\"}});\r\n      else{ ref.runLayout(\"spread\"); }\r\n    });\r\n\r\n    // remove styling from boxselect on unselect\r\n    cy.on('unselect', 'node', (evt) => {\r\n      var cy_node = evt.target;\r\n      cy_node.removeClass('selected');\r\n    });\r\n\r\n    // update view link position if node is moved\r\n    cy.on('dragfree', 'node', (evt) => {\r\n        const {x, y} = evt.target.position();\r\n\r\n        var kfId = evt.target.data().kfId;\r\n\r\n        let viewLink = Object.values(this.props.viewLinks).filter((link) => link.to === kfId)\r\n        if (viewLink !== undefined && viewLink.length) {\r\n            viewLink = viewLink[0];\r\n            const data = {x, y}\r\n            const newViewLink = { ...viewLink }\r\n            newViewLink.data = { ...newViewLink.data, ...data };\r\n            this.props.updateViewLink(newViewLink)\r\n        }\r\n    })\r\n\r\n    // open image contribution when it is selected\r\n    cy.on('cysupportimages.imageselected', (evt, img) => {\r\n      // wait 100ms to see if it is just being moved\r\n      // if it is we do not open the contribution\r\n      window.setTimeout(function(){\r\n        if(!img._private.dragging){ ref.props.onNoteClick(img.kfId); }\r\n      }, 100);\r\n    })\r\n\r\n    //Update view link position of image if moved\r\n    cy.on('cysupportimages.imagemoved', (evt, img) => {\r\n        let viewLink = this.props.viewLinks[img.linkId]\r\n        if (viewLink !== undefined) {\r\n            const data = {x: img.bounds.x, y: img.bounds.y}\r\n            const newViewLink = { ...viewLink }\r\n            newViewLink.data = { ...newViewLink.data, ...data };\r\n            this.props.updateViewLink(newViewLink)\r\n        }\r\n    })\r\n\r\n    //Update view link of image if resized\r\n    cy.on('cysupportimages.imageresized', (evt, img, b1, b2) => {\r\n        let viewLink = this.props.viewLinks[img.linkId]\r\n        if (viewLink !== undefined) {\r\n            const data = {width: img.bounds.width, height: img.bounds.height}\r\n            const newViewLink = { ...viewLink }\r\n            newViewLink.data = { ...newViewLink.data, ...data };\r\n            this.props.updateViewLink(newViewLink)\r\n        }\r\n    })\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n      // AN OBJECT MAPPING DIFFERENT CASES TO BOOLEAN VALUES\r\n      // this is an attempt to organize and account for all the edge cases when the component updates\r\n      let cases = {\r\n\r\n        anyPropUpdated: (this.props.viewId !== prevProps.viewId || this.props.buildsOn !== prevProps.buildsOn || this.props.references !== prevProps.references\r\n                            || this.props.authors !== prevProps.authors || this.props.viewLinks !== prevProps.viewLinks || this.props.community !== prevProps.community),\r\n\r\n        currViewLinkUpdated: (this.props.viewId === prevProps.viewId && this.props.buildsOn === prevProps.buildsOn && this.props.references === prevProps.references && this.props.authors === prevProps.authors\r\n                            && this.props.viewLinks !== prevProps.viewLinks && Object.keys(this.props.viewLinks).length === Object.keys(prevProps.viewLinks).length && this.props.readLinks === prevProps.readLinks),\r\n\r\n        switchedToEmptyView: (this.props.viewId !== prevProps.viewId && this.props.buildsOn === prevProps.buildsOn && this.props.references === prevProps.references && this.props.authors === prevProps.authors\r\n                            && this.props.viewLinks !== prevProps.viewLinks && Object.keys(this.props.viewLinks).length === 0 && Object.keys(prevProps.viewLinks).length !== undefined),\r\n\r\n        searchTriggered: (this.props.searchQuery !== prevProps.searchQuery || this.props.searchFilter !== prevProps.searchFilter),\r\n\r\n        updateReadLinks: (this.props.readLinks.length !== 0 && Object.keys(this.props.viewLinks) !== 0 && this.state.kfToCyMap !== prevState.kfToCyMap),\r\n\r\n        viewSettingsChanged: (this.props.currViewSettingsObj !== prevProps.currViewSettingsObj),\r\n\r\n        layoutChanged: (this.props.layout !== prevProps.layout),\r\n\r\n      }\r\n\r\n      var forceRender = (cases.switchedToEmptyView || cases.currViewLinkUpdated);\r\n\r\n      if(cases.layoutChanged){ this.runLayout(this.props.layout); }\r\n      if(cases.searchTriggered){ this.filterNodes(); }\r\n      if(cases.viewSettingsChanged){ this.updateViewSettings(); }\r\n      if(cases.updateReadLinks){ this.updateReadLinks(); }\r\n      if(cases.anyPropUpdated){ this.loadElements(Object.keys(prevProps.viewLinks).length, forceRender); }\r\n  }\r\n\r\n  render() {\r\n    return(\r\n          <CytoscapeComponent\r\n          cy={(cy) => { this.cy = cy }}\r\n          style={ { width: '100%', height: '100%' } }\r\n          elements={CytoscapeComponent.normalizeElements(this.state.elements)}\r\n          stylesheet={ [\r\n            {\r\n              selector: 'node',\r\n              style: {\r\n                'label': \"data(name)\",\r\n                'min-zoomed-font-size': MIN_ZOOMED_FONT_SIZE,\r\n                'font-size': '11px',\r\n                'text-halign': 'right',\r\n                'text-valign': 'center',\r\n                'text-margin-x': '-5',\r\n                'padding': '0',\r\n                'background-opacity': '0',\r\n                'background-clip': 'none',\r\n                'background-repeat': 'no-repeat',\r\n                'background-width': '15px',\r\n                'background-height': '15px',\r\n                'shape': 'round-rectangle',\r\n              }\r\n            },\r\n            {\r\n              selector: 'edge',\r\n              style: {\r\n                'width': 1,\r\n                'line-color': '#29648f',\r\n                'target-arrow-color': '#29648f',\r\n                'target-arrow-shape': 'triangle',\r\n                'curve-style': 'bezier'\r\n              }\r\n            },\r\n            {selector: '.buildson', style: {'line-color': '#29648f', 'target-arrow-color': '#29648f'}},\r\n            {selector: '.references', style: {'line-color': 'black', 'target-arrow-color': 'black'}},\r\n            {selector: '.unread-note', style: {'background-image': [unread_note_icon]}},\r\n            {selector: '.read-note', style: {'background-image': [read_note_icon]}},\r\n            {selector: '.unread-riseabove', style: {'background-image': [unread_riseabove_icon]}},\r\n            {selector: '.read-riseabove', style: {'background-image': [read_riseabove_icon]}},\r\n            {selector: '.attachment', style: {'background-image': [attachment_icon]}},\r\n            {selector: '.view', style: {'background-image': [view_icon]}},\r\n            {selector: '.image', style: {'label': ''}},\r\n            {selector: '.drawing', style: {'label': ''}},\r\n            {\r\n              selector: '.recentAddition',\r\n              style: {\r\n                'border-style': 'solid',\r\n                'border-width': '2',\r\n                'border-color': 'red',\r\n              }\r\n            },\r\n            {\r\n              selector: '.selected',\r\n              style: {\r\n                'background-opacity': '0.25',\r\n                'background-color': 'black'\r\n              }\r\n            }\r\n          ] }\r\n          layout={ {name: 'preset'} }\r\n          hideEdgesonViewport={ true }\r\n          textureOnViewPort={ true }\r\n          autolock={ false }\r\n          selectable={ true }\r\n          wheelSensitivity={ 0.15 }\r\n          minZoom={ MINZOOM }\r\n          maxZoom={ MAXZOOM }\r\n          />\r\n          );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state, ownProps) => {\r\n    return {\r\n        token: state.globals.token,\r\n        server: state.globals.currentServer,\r\n        community: state.globals.community,\r\n        author: state.globals.author,\r\n        authors: state.users,\r\n        viewNotes: state.notes.viewNotes,\r\n        buildsOn: state.notes.buildsOn,\r\n        references: state.notes.references,\r\n        supports: state.notes.supports,\r\n        searchQuery: state.globals.searchQuery,\r\n        searchFilter: state.globals.searchFilter,\r\n        currViewSettingsObj: state.globals.currViewSettingsObj,\r\n    }\r\n}\r\n\r\nconst mapDispatchToProps = {\r\n    updateViewLink\r\n}\r\n\r\nexport default connect(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(GraphView)\r\n","let authorRequirementTable = {\r\n    private: {\r\n        r: true,\r\n        w: true\r\n    },\r\n    protected: {\r\n        r: false,\r\n        w: true\r\n    },\r\n    public: {\r\n        r: false,\r\n        w: false\r\n    }\r\n};\r\n\r\nexport let fullfillRequirement = (object, author, requiredPermission) => {\r\n    if (!object || !author) {\r\n        return false;\r\n    }\r\n\r\n    if (author.role === 'manager') {\r\n        return true;\r\n    }\r\n\r\n    if (authorRequirementTable[object.permission][requiredPermission] === false) {\r\n        return true;\r\n    }\r\n\r\n    //author requirement\r\n    return isAuthorOrGroupMember(object, author);\r\n};\r\n\r\nexport let isAuthorOrGroupMember = (object, author) => {\r\n    return isAuthor(object, author) || isGroupMember(object, author);\r\n};\r\n\r\nexport let isAuthor = (object, author) => {\r\n    return object.authors.includes(author._id)\r\n};\r\n\r\nexport let isGroupMember = (object, author) => {\r\n    if (!object._groupMembers) {\r\n        return false;\r\n    }\r\n    return object._groupMembers.includes(author._id)    \r\n};\r\n\r\nexport let isManager = function(author) {\r\n    if (!author) {\r\n        return false;\r\n    }\r\n    return author.role === 'manager';\r\n};\r\n\r\nexport let isEditable = (object, author) => {\r\n    return fullfillRequirement(object, author, 'w')\r\n};","import React, { Component } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { Button, Row, Col, } from 'react-bootstrap';\r\nimport { Form, FormGroup, Input, Alert } from 'reactstrap';\r\nimport { dateFormatOptions } from '../../store/globalsReducer'\r\nimport Axios from 'axios';\r\n\r\nimport './NoteContent.css';\r\nimport { url, apiUrl } from '../../store/api.js'\r\nimport * as access from '../../store/access'\r\nimport { openContribution, updateCheckedNotes } from '../../store/noteReducer'\r\nimport { fetchViewCommunityData } from '../../store/globalsReducer'\r\nimport { createRiseAbove } from '../../store/riseAboveReducer'\r\n\r\nclass NoteContent extends Component {\r\n    noteList = [];\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            token: sessionStorage.getItem('token'),\r\n            addView: this.props.viewId,\r\n            communityId: sessionStorage.getItem('communityId'),\r\n            visible: false,\r\n            viewError: false,\r\n        };\r\n\r\n        this.handleChange = this.handleChange.bind(this);\r\n        this.handleSubmit = this.handleSubmit.bind(this);\r\n\r\n        this.handleRiseAbove = this.handleRiseAbove.bind(this);\r\n        this.getRiseAboveNotes = this.getRiseAboveNotes.bind(this);\r\n        this.openNote = this.openNote.bind(this);\r\n        this.editNote = this.editNote.bind(this);\r\n\r\n    }\r\n\r\n    componentDidMount() {\r\n    }\r\n\r\n    handleChange(e) {\r\n        e.persist();\r\n        let target = e.target;\r\n        let id = target.value;\r\n\r\n        this.setState({\r\n            addView: id,\r\n        });\r\n\r\n    }\r\n\r\n    // CREATE VIEW->NOTE LINK\r\n    handleSubmit = (e) => {\r\n        if (this.props.viewId === this.state.addView) {\r\n            this.setState({\r\n                viewError: true,\r\n            })\r\n            window.setTimeout(() => {\r\n                this.setState({ viewError: false })\r\n            }, 1500)\r\n        }\r\n        else {\r\n            const topleft = { x: 1000, y: 1000 };\r\n            let url = `${apiUrl}/links`;\r\n            let config = {\r\n                headers: { Authorization: `Bearer ${this.state.token}` }\r\n            };\r\n            this.props.checkedNotes.forEach(note => {\r\n                const ref = Object.values(this.props.viewLinks).filter((lnk) => lnk.to === note._id)[0]\r\n                topleft.x = Math.min(topleft.x, ref.data.x);\r\n                topleft.y = Math.min(topleft.y, ref.data.y);\r\n            })\r\n            this.props.checkedNotes.forEach(note => {\r\n                let noteId = note._id;\r\n                let query = {\r\n                    \"from\": this.state.addView,\r\n                    \"to\": noteId,\r\n                    \"type\": \"contains\",\r\n                    'data': topleft\r\n                };\r\n                Axios.post(url, query, config).then(\r\n                    res => {\r\n                        this.setState({ visible: true }, () => {\r\n                            window.setTimeout(() => {\r\n                                this.setState({ visible: false })\r\n                            }, 1000)\r\n                        });\r\n\r\n                    }\r\n                );\r\n            });\r\n        }\r\n        // TODO POST LINKS ALERT THEY'RE ADDED TO VIEW TITLE\r\n\r\n    }\r\n\r\n    handleRiseAbove = async (e) => {\r\n        let noOfNotes = this.props.checkedNotes.length;\r\n        //IF CHECKED NOTES\r\n        if (noOfNotes > 0) {\r\n            let confirmation = window.confirm(\"Are you sure to create riseabove using the selected \" + noOfNotes + \" object(s)?\");\r\n            if (!confirmation) {\r\n                return;\r\n            }\r\n            //CREATE RISEABOVE\r\n            let view = this.props.view;\r\n            let communityId = this.props.communityId;\r\n            let author = this.props.author._id;\r\n            let notes = this.props.checkedNotes;\r\n            await this.props.createRiseAbove(view, communityId, author, notes);\r\n            this.props.fetchViewCommunityData(this.props.viewId)\r\n\r\n\r\n        } else {\r\n            alert(\"Please select at least 1 note to create RiseAbove\");\r\n        }\r\n    }\r\n\r\n    editNote = (contribId, mode) => {\r\n        this.props.openContribution(contribId, mode);\r\n    }\r\n\r\n    getRiseAboveNotes = (riseAboveId) => {\r\n        if (this.props.riseAboveViewNotes[riseAboveId]) {\r\n            let riseAboveNotes = this.props.riseAboveViewNotes[riseAboveId].map((noteId) => this.props.riseAboveNotes[noteId])\r\n            return riseAboveNotes;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    openNote = (noteId) => {\r\n        this.props.openContribution(noteId, \"read\")\r\n    }\r\n\r\n    render() {\r\n        const formatter = new Intl.DateTimeFormat('default', dateFormatOptions)\r\n        return (\r\n            <>\r\n                <Form className=\"mrg-1-top\">\r\n                    <Row>\r\n                        <Col md=\"6\">\r\n                            <FormGroup>\r\n                                <Input type=\"select\" name=\"viewId\" onChange={this.handleChange}>{\r\n                                    this.props.views.map((obj, i) => {\r\n                                        return <option key={i} value={obj._id}> {obj.title} </option>\r\n                                    })\r\n                                }</Input>\r\n                            </FormGroup>\r\n                        </Col>\r\n\r\n                        {this.props.isDemo ? null : (\r\n                          <Col md=\"3\">\r\n                              <Button onClick={this.handleSubmit} >Add to View</Button>\r\n                          </Col>\r\n                        )}\r\n\r\n                        {this.props.isDemo ? null : (\r\n                          <Col md=\"3\">\r\n                              <Button onClick={this.handleRiseAbove} >create RiseAbove</Button>\r\n                          </Col>\r\n                        )}\r\n\r\n                    </Row>\r\n                    <Row>\r\n                        <Col>\r\n                            <Alert color=\"danger\" isOpen={this.state.viewError} >\r\n                                Please select a Different View.\r\n                            </Alert>\r\n                            <Alert color=\"info\" isOpen={this.state.visible} >\r\n                                Notes added to View!\r\n                            </Alert>\r\n                        </Col>\r\n                    </Row>\r\n                </Form>\r\n                {this.props.checkedNotes.map(\r\n                    (obj, i) => {\r\n                        let riseAboveNotes = this.getRiseAboveNotes(obj._id);\r\n                        let RiseAboveNotes;\r\n                        if (riseAboveNotes) {\r\n                            RiseAboveNotes = <Row>\r\n                                <Col className=\"pd-1-left\">\r\n                                    <Row className=\"sz-1 primary-800 font-weight-bold\" >RiseAbove Notes</Row>\r\n                                    {riseAboveNotes.map((note, i) => {\r\n                                        return <Row key={i}>\r\n                                            <Button variant=\"light\" className=\"min-width-10 rounded-pill pd-05\" onClick={() => this.openNote(note._id)}>{note.title}</Button>\r\n                                        </Row>\r\n                                    })}\r\n                                </Col>\r\n                            </Row>\r\n                        }\r\n                        let data;\r\n                        if (this.props.query && obj.data.English) {\r\n                            let innerHTML = obj.data.English;\r\n                            let index = innerHTML.indexOf(this.props.query);\r\n                            if (index >= 0) {\r\n                                data = innerHTML.substring(0, index) + \"<span class='highlight'>\" + innerHTML.substring(index, index + this.props.query.length) + \"</span>\" + innerHTML.substring(index + this.props.query.length);\r\n                            }\r\n                        } else if (this.props.query && obj.data.body) {\r\n                            let innerHTML = obj.data.body;\r\n                            let index = innerHTML.indexOf(this.props.query);\r\n                            if (index >= 0) {\r\n                                data = innerHTML.substring(0, index) + \"<span class='highlight'>\" + innerHTML.substring(index, index + this.props.query.length) + \"</span>\" + innerHTML.substring(index + this.props.query.length);\r\n                            }\r\n                        } else {\r\n                            data = obj.data.English ? obj.data.English : obj.data.body;\r\n                        }\r\n\r\n                        //eslint-disable-next-line\r\n                        while (data && data.includes(\"src=\\\"\\/attachments\")) {\r\n                            //eslint-disable-next-line\r\n                            data = data.replace(\"src=\\\"\\/attachments\", \"src=\\\"\" + url + \"\\/attachments\");\r\n                        }\r\n\r\n                        // EDIT BUTTON\r\n                        let EditNoteButton;\r\n                        if (access.isEditable(obj, this.props.author) === true) {\r\n                            EditNoteButton = <Button className=\"float-right\" variant=\"outline-info\" onClick={() => this.editNote(obj._id, \"write\")}>Edit Note</Button>\r\n                        } else {\r\n                            EditNoteButton = <Button className=\"float-right\" variant=\"outline-info\" onClick={() => this.editNote(obj._id, \"read\")}>Read Note</Button>\r\n                        }\r\n\r\n                        return (\r\n                            <Row className=\"min-height-2 mrg-05 border rounded mrg-1-bot pd-1\" key={i}>\r\n                                <Col>\r\n                                    <Row>\r\n                                        <Col md=\"10\" className=\"pd-1 primary-800 font-weight-bold\">{obj.title}</Col>\r\n                                        <Col md=\"2\">\r\n                                            <Button variant=\"outline-secondary\" className=\"circular-border float-right\"\r\n                                                onClick={() => this.props.updateCheckedNotes({ checked: false, noteId: obj._id })}>\r\n                                                <i className=\"fas fa-times\"></i>\r\n                                            </Button>\r\n                                        </Col>\r\n                                    </Row>\r\n                                    <Row>\r\n                                        <Col>\r\n                                            <span className=\"pd-1\" dangerouslySetInnerHTML={{ __html: data ? (data) : (obj.data.English ? obj.data.English : obj.data.body) }} />\r\n                                        </Col>\r\n                                    </Row>\r\n                                    {RiseAboveNotes}\r\n                                    <Row>\r\n                                        <Col>\r\n                                            <Col><div className=\"primary-600 sz-075 pd-05 float-left\">{this.props.users[obj.authors[0]].firstName + \" \"+ this.props.users[obj.authors[0]].lastName } &nbsp; {formatter.format(new Date(obj.created))}</div></Col>\r\n                                            {this.props.isDemo ? null : (<Col><Button className=\"float-right mrg-1-left\" variant=\"outline-info\" onClick={() => this.props.buildOn(obj._id)}>BuildOn</Button></Col>)}\r\n                                            <Col>{EditNoteButton}</Col>\r\n                                        </Col>\r\n                                    </Row>\r\n                                </Col>\r\n                            </Row>\r\n                        )\r\n                    }\r\n                )}\r\n            </>\r\n        )\r\n    }\r\n\r\n}\r\n\r\nconst mapStateToProps = (state, ownProps) => {\r\n    const viewNotes = state.notes.viewNotes\r\n    const users = state.users\r\n    return {\r\n        isDemo: state.globals.isDemo,\r\n        viewId: state.globals.viewId,\r\n        views: state.globals.views,\r\n        view: state.globals.view,\r\n        checkedNotes: state.notes.checkedNotes.map(\r\n            noteId => noteId in viewNotes ? //Find note in viewNotes or in riseAboveNotes\r\n                viewNotes[noteId] : state.notes.riseAboveNotes[noteId]\r\n        ),\r\n        viewLinks: state.notes.viewLinks,\r\n        author: state.globals.author,\r\n        communityId: state.globals.communityId,\r\n        riseAboveViewNotes: state.notes.riseAboveViewNotes,\r\n        riseAboveNotes: state.notes.riseAboveNotes,\r\n        users: users,\r\n    }\r\n}\r\n\r\nconst mapDispatchToProps = {\r\n    openContribution,\r\n    updateCheckedNotes,\r\n    createRiseAbove,\r\n    fetchViewCommunityData\r\n}\r\n\r\nexport default connect(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(NoteContent);\r\n","import { createAction, createReducer } from '@reduxjs/toolkit';\r\nimport * as api from './api.js'\r\n\r\nexport const addNote = createAction('ADD_NOTE')\r\nconst initState = {\r\n\r\n}\r\n\r\nexport const riseAboveReducer = createReducer(initState, {});\r\n\r\nexport const createRiseAbove = (view, communityId, author, notes) => dispatch => {\r\n    let object = {};\r\n    let riseAboveId;\r\n    let riseAboveNoteId;\r\n    let viewId = view._id;\r\n    object.authors = author.split(',')\r\n    object.communityId = communityId;\r\n    object.permission = view.permission ? view.permission : \"public\";\r\n    object.status = \"active\"\r\n    object.title = \"riseabove:\"\r\n    object.type = \"View\"\r\n    object._groupMembers = view._groupMembers;\r\n    console.log(\"OBJECT\", object);\r\n    //CONTRIBUTE RISEABOVE VIEW\r\n    api.postContribObject(communityId, object).then(response => {\r\n        riseAboveId = response._id;\r\n        console.log(\"Response\", response);\r\n        let note = {};\r\n        note.authors = object.authors;\r\n        note.buildson = null;\r\n        note.communityId = communityId;\r\n        note.data = { body: \"\" };\r\n        note.langInNote = [];\r\n        note.permission = \"protected\";\r\n        note.status = \"unsaved\";\r\n        note.title = \"\";\r\n        note.type = \"Note\";\r\n        note._groupMembers = view._groupMembers;\r\n        console.log(\"NOTE\", note);\r\n        //CONTRIBUTE RISEABOVE NOTE\r\n        api.postContribObject(communityId, note).then(noteResponse => {\r\n            console.log(\"noteResponse\", noteResponse);\r\n            riseAboveNoteId = noteResponse._id;\r\n            noteResponse.data = {\r\n                body: \"\",\r\n                riseabove: { viewId: `${riseAboveId}` }\r\n            }\r\n            noteResponse.status = \"active\";\r\n            noteResponse.title = \"Riseabove\"\r\n            console.log(\"noteResponse noteResponse\", noteResponse);\r\n            api.putObject(noteResponse, communityId, riseAboveNoteId).then(putResponse => {\r\n                //POST API LINKS\r\n                let pos = { x: 200, y: 200 }\r\n                api.postLink(viewId, riseAboveNoteId, 'contains', pos).then(res => {\r\n                    notes.forEach(note => {\r\n                        let pos = { x: 20, y: 20 }\r\n                        api.postLink(riseAboveId, note._id, 'contains', pos).then(res => {\r\n                            //EITHER AND THEN DELETE\r\n                            api.getLinkForObj(note._id).then(linkRes => {\r\n                                let links = linkRes.data;\r\n                                let link = links.filter(obj => {\r\n                                    return obj.from.includes(viewId)\r\n                                })\r\n                                api.deleteLink(link[0]._id);\r\n                            })\r\n                        })\r\n                    });\r\n                })\r\n            })\r\n        }).catch(error => {\r\n            console.log(\"error\", error);\r\n        })\r\n\r\n    }).catch(error => {\r\n        console.log(\"Error\", error);\r\n    });\r\n\r\n}\r\n","import React, { Component } from 'react';\r\nimport { Col, Row } from 'react-bootstrap';\r\nimport { connect } from 'react-redux'\r\nimport { Form, FormGroup, Input } from 'reactstrap';\r\nimport { Button, Collapse } from 'react-bootstrap';\r\nimport ListOfNotes from './ListOfNotes.js'\r\nimport { dateFormatOptions } from '../../../store/globalsReducer'\r\nimport { newNote, updateCheckedNotes, openContribution } from '../../../store/noteReducer'\r\nimport { Breakpoint } from 'react-socks';\r\nimport { url } from '../../../store/api'\r\nimport * as access from '../../../store/access'\r\n\r\nclass Notes extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            note: {},\r\n            showNote: false,\r\n            open: false,\r\n            riseAboveData: {},\r\n            isCheckedMobile: false,\r\n        };\r\n        this.checkNote = this.checkNote.bind(this)\r\n        this.editNote = this.editNote.bind(this);\r\n        this.buildOn = this.buildOn.bind(this);\r\n    }\r\n\r\n    componentDidMount() {\r\n    }\r\n\r\n    buildOn = (buildOn) => {\r\n        this.props.newNote(this.props.view, this.props.communityId, this.props.authorObj._id, buildOn);\r\n    }\r\n\r\n    editNote = (contribId, mode) => {\r\n        this.props.openContribution(contribId, mode);\r\n    }\r\n\r\n    setOpen = (value) => {\r\n        this.setState((prevState) => {\r\n            return { open: !prevState.open }\r\n        })\r\n    }\r\n\r\n    checkNote = (evt, noteId) => {\r\n        this.props.updateCheckedNotes({ noteId, checked: evt.target.checked })\r\n    }\r\n\r\n    updateNoteMobile = (e, note) => {\r\n        this.setState({\r\n            isCheckedMobile: e.target.checked\r\n        })\r\n    }\r\n\r\n    render() {\r\n        const hasChildren = this.props.children && Object.keys(this.props.children).length !== 0;;\r\n        const icon = this.state.open ? \"fa-chevron-down\" : \"fa-chevron-right\"\r\n        const formatter = new Intl.DateTimeFormat('default', dateFormatOptions)\r\n        let NoteMobile;\r\n        let data = this.props.note.data.body;\r\n        //eslint-disable-next-line\r\n        while (data.includes(\"src=\\\"\\/attachments\")) {\r\n            //eslint-disable-next-line\r\n            data = data.replace(\"src=\\\"\\/attachments\", \"src=\\\"\" + url + \"\\/attachments\");\r\n        }\r\n\r\n        let EditNoteButton;\r\n        if (access.isEditable(this.props.note, this.props.authorObj) === true) {\r\n            EditNoteButton = <Button className=\"float-right\" variant=\"outline-info\" onClick={() => this.editNote(this.props.note._id, \"write\")}>Edit Note</Button>\r\n        } else {\r\n            EditNoteButton = <Button className=\"float-right\" variant=\"outline-info\" onClick={() => this.editNote(this.props.note._id, \"read\")}>Read Note</Button>\r\n        }\r\n\r\n        if (this.state.isCheckedMobile) {\r\n            NoteMobile = <div>\r\n                <Row>\r\n                    <Col>\r\n                        <Row dangerouslySetInnerHTML={{ __html: data }}></Row>\r\n                        <Row>\r\n                            <Button className=\"float-right mrg-1-left mrg-1-right\" variant=\"outline-info\" onClick={() => this.buildOn(this.props.note._id)}>BuildOn</Button>\r\n                            {EditNoteButton}\r\n                        </Row>\r\n                    </Col>\r\n                </Row>\r\n            </div>\r\n        }\r\n\r\n        return (\r\n            <>\r\n                <Breakpoint medium up>\r\n                    <div>\r\n                        <Row>\r\n                            <Col className=\"mr-auto rounded\">\r\n                                <Row className=\"pd-05\">\r\n                                    <Col md=\"10\" className=\"primary-800 font-weight-bold\">\r\n                                        {hasChildren ?\r\n                                            <Button variant='link' onClick={() => this.setOpen(!this.open)} aria-controls=\"example-collapse-text\" aria-expanded={this.state.open}>\r\n                                                <i className={`fa ${icon}`}></i>\r\n                                            </Button>\r\n                                            : null}\r\n                                        {this.props.note.title}</Col>\r\n                                    <Col md=\"2\">\r\n                                        <Form className=\"mrg-1-min pd-2-right\">\r\n                                            <FormGroup>\r\n                                                <Input type=\"checkbox\" checked={this.props.isChecked} ref={this.props.note._id} onChange={e => this.checkNote(e, this.props.note._id)} />\r\n                                            </FormGroup>\r\n                                        </Form>\r\n                                    </Col>\r\n                                </Row>\r\n                                <Row className=\"primary-600 sz-075 pd-05\">\r\n                                    <Col><span> {this.props.author} </span>&nbsp; {formatter.format(new Date(this.props.note.created))}</Col>\r\n                                    <Col md=\"2\">\r\n                                        {/* <Button onClick={() => this.buildOn(this.props.oneHirarchy.to)}>BuildOn</Button> */}\r\n                                    </Col>\r\n                                </Row>\r\n                                {this.props.children ?\r\n                                    <Collapse in={this.state.open}>\r\n                                        <Row>\r\n                                            <Col md=\"1\"></Col>\r\n                                            <Col md=\"11\">\r\n                                                <ListOfNotes hierarchy={this.props.children}></ListOfNotes>\r\n                                            </Col>\r\n                                        </Row>\r\n                                    </Collapse>\r\n                                    : null}\r\n                            </Col>\r\n                        </Row>\r\n                    </div>\r\n                </Breakpoint>\r\n\r\n                {/* MOBILE SCREEN */}\r\n                <Breakpoint small down>\r\n                    <div>\r\n                        <Row>\r\n                            <Col className=\"mr-auto rounded\">\r\n                                <Row className=\"pd-05\">\r\n                                    <Col md=\"10\" className=\"primary-800 font-weight-bold\">\r\n                                        {hasChildren ?\r\n                                            <Button variant='link' onClick={() => this.setOpen(!this.open)} aria-controls=\"example-collapse-text\" aria-expanded={this.state.open}>\r\n                                                <i className={`fa ${icon}`}></i>\r\n                                            </Button>\r\n                                            : null}\r\n                                        {this.props.note.title}</Col>\r\n                                    <Col md=\"2\">\r\n                                        <Form className=\"mrg-1-min pd-2-right\">\r\n                                            <FormGroup>\r\n                                                <Input type=\"checkbox\" checked={this.state.isCheckedMobile} ref={this.props.note._id} onChange={e => this.updateNoteMobile(e, this.props.note)} />\r\n                                            </FormGroup>\r\n                                        </Form>\r\n                                    </Col>\r\n                                </Row>\r\n                                <Row className=\"primary-600 sz-075 pd-05\">\r\n                                    <Col><span> {this.props.author} </span>&nbsp; {formatter.format(new Date(this.props.note.created))}</Col>\r\n                                    <Col md=\"2\">\r\n                                        {/* <Button onClick={() => this.buildOn(this.props.oneHirarchy.to)}>BuildOn</Button> */}\r\n                                    </Col>\r\n                                </Row>\r\n                                {this.props.children ?\r\n                                    <Collapse in={this.state.open}>\r\n                                        <Row>\r\n                                            <Col md=\"1\"></Col>\r\n                                            <Col md=\"11\">\r\n                                                <ListOfNotes hierarchy={this.props.children}></ListOfNotes>\r\n                                            </Col>\r\n                                        </Row>\r\n                                    </Collapse>\r\n                                    : null}\r\n                            </Col>\r\n                        </Row>\r\n                        {NoteMobile}\r\n                    </div>\r\n                </Breakpoint>\r\n            </>\r\n        )\r\n    }\r\n\r\n}\r\n\r\nconst mapStateToProps = (state, ownProps) => {\r\n    const author = state.users[ownProps.note.authors[0]]\r\n    return {\r\n        author: (author && `${author.firstName} ${author.lastName}`) || 'NA',\r\n        isChecked: state.notes.checkedNotes.includes(ownProps.note._id),\r\n        riseAboveViewNotes: state.notes.riseAboveViewNotes,\r\n        riseAboveNotes: state.notes.riseAboveNotes,\r\n        view: state.globals.view,\r\n        communityId: state.globals.communityId,\r\n        authorObj: state.globals.author,\r\n    }\r\n}\r\n\r\nconst mapDispatchToProps = {\r\n    updateCheckedNotes,\r\n    openContribution,\r\n    newNote,\r\n}\r\n\r\nexport default connect(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(Notes)\r\n","import React, { Component } from 'react';\r\nimport Notes from './Notes';\r\nimport { connect } from 'react-redux'\r\nclass ListOfNotes extends Component {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.getNotes = this.getNotes.bind(this)\r\n    }\r\n\r\n    componentDidMount() {\r\n    }\r\n\r\n    getNotes() {\r\n        const notes = []\r\n        for (let noteId in this.props.hierarchy) {\r\n            if (noteId in this.props.notes)\r\n                notes.push(this.props.notes[noteId])\r\n        }\r\n        //SORT THEM\r\n        return notes.sort((a, b) => { return new Date(b.created) - new Date(a.created) })\r\n\r\n    }\r\n\r\n    render() {\r\n        const notes = this.props.noteLinks || this.getNotes()\r\n        return (<>\r\n            {\r\n                notes.map((note, i) => {\r\n                    const children = this.props.hierarchy && this.props.hierarchy[note._id].children\r\n                    return <div key={i} className=\"shadow p-1 mb-1 rounded\">\r\n                        <Notes note={note} children={children} notes={this.props.notes} />\r\n                    </div>\r\n                })\r\n            }\r\n        </>)\r\n    }\r\n\r\n}\r\n\r\nconst mapStateToProps = (state, ownProps) => {\r\n    return {\r\n        notes: state.notes.viewNotes,\r\n        riseAboveNotes: state.notes.riseAboveNotes\r\n    }\r\n}\r\n\r\nconst mapDispatchToProps = {\r\n}\r\n\r\nexport default connect(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(ListOfNotes)\r\n","import React, { Component } from 'react';\r\nimport { Row, Col } from 'react-bootstrap';\r\nimport { Form, Input, InputGroup, InputGroupAddon, InputGroupText } from 'reactstrap';\r\nimport { newNote } from '../../../store/noteReducer.js'\r\nimport { connect } from 'react-redux'\r\nimport NoteContent from '../../NoteContent/NoteContent'\r\nimport ListOfNotes from './ListOfNotes'\r\nimport { Breakpoint } from 'react-socks'\r\nimport '../../../index.css';\r\nimport '../View.css';\r\n\r\nclass LightView extends Component {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            showView: false,\r\n            showRiseAbove: false,\r\n            filteredData: [],\r\n        };\r\n\r\n        this.getBuildOnHierarchy = this.getBuildOnHierarchy.bind(this)\r\n        this.onCloseDialog = this.onCloseDialog.bind(this);\r\n        this.onConfirmDrawDialog = this.onConfirmDrawDialog.bind(this);\r\n        this.filterResults = this.filterResults.bind(this);\r\n    }\r\n\r\n    // GET BUILDON HIERARCHY\r\n    getBuildOnHierarchy() {\r\n        const hierarchy = {}\r\n        for (let noteId in this.props.viewNotes) {\r\n            hierarchy[noteId] = { children: {} }\r\n        }\r\n        this.props.buildsOn.forEach(note => {\r\n            const parent = note.to\r\n            const child = note.from\r\n            if (!(parent in hierarchy))\r\n                hierarchy[parent] = { children: {} }\r\n            if (!(child in hierarchy))\r\n                hierarchy[child] = { parent: parent, children: {} }\r\n            else\r\n                hierarchy[child]['parent'] = parent\r\n            hierarchy[parent]['children'][child] = hierarchy[child]\r\n        })\r\n        const final_h = {}\r\n        for (let [key, value] of Object.entries(hierarchy)) {\r\n            if (!('parent' in value))\r\n                final_h[key] = value\r\n        }\r\n        return final_h\r\n    }\r\n\r\n    componentDidUpdate(prevProps, prevState) {\r\n      if(this.props.searchQuery !== prevProps.searchQuery || this.props.searchFilter !== prevProps.searchFilter){\r\n        this.filterResults(this.props.searchQuery);\r\n      }\r\n    }\r\n\r\n    newRiseAbove() {\r\n        this.setState({\r\n            showView: false,\r\n            showModel: true,\r\n        })\r\n    }\r\n\r\n    onConfirmDrawDialog(drawing) {\r\n        this.props.addDrawing(drawing);\r\n        this.props.closeDrawDialog();\r\n    }\r\n\r\n    onCloseDialog(dlg) {\r\n        this.props.removeNote(dlg.noteId);\r\n        this.props.closeDialog(dlg.id);\r\n    }\r\n\r\n    filterResults(q) {\r\n        const query = q || this.props.searchQuery;\r\n        let filteredResults = [];\r\n        const notes = Object.values(this.props.viewNotes)\r\n        if (query || this.props.searchFilter) {\r\n            switch (this.props.searchFilter) {\r\n                case \"title\":\r\n                    filteredResults = notes.filter(note => note.title.toLowerCase().includes(query.toLowerCase()));\r\n                    break;\r\n\r\n                case \"content\":\r\n                    filteredResults = notes.filter(function (obj) {\r\n                        if (obj.data && obj.data.English) {\r\n                            return obj.data.English.includes(query);\r\n                        }\r\n                        else if (obj.data && obj.data.body) {\r\n                            return obj.data.body.includes(query);\r\n                        }\r\n                        return false\r\n                    });\r\n\r\n                    break;\r\n\r\n                case \"author\":\r\n                    const authors = [];\r\n                    Object.values(this.props.authors).forEach(obj => {\r\n                        const authName = `${obj.firstName} ${obj.lastName}`.toLowerCase()\r\n                        if (authName.includes(query.toLowerCase())) {\r\n                            authors.push(obj._id);\r\n                        }\r\n                    });\r\n                    filteredResults = notes.filter(note => note.authors.some(author => authors.includes(author)))\r\n\r\n                    break;\r\n                case \"scaffold\":\r\n                    const noteIds = this.props.supports.filter(support => support.from === query).map(support => support.to)\r\n                    filteredResults = notes.filter(note => noteIds.includes(note._id))\r\n                    break;\r\n\r\n                case \"time\":\r\n                    var curr_date = new Date();\r\n                    filteredResults = notes.filter((note) => {\r\n                      const note_date = new Date(note.created);\r\n                      if(note_date !== \"Invalid Date\"){\r\n                        var diff = curr_date - note_date;\r\n                        var secondsDiff = diff/1000;\r\n\r\n                        if((query === \"today\" && secondsDiff <= 86400) ||\r\n                           (query === \"week\" && secondsDiff <= 604800) ||\r\n                           (query === \"month\" && secondsDiff <= 2592000) ||\r\n                           (query === \"year\" && secondsDiff <= 31556952)){ return note; }\r\n                      }\r\n                      return null;\r\n                    });\r\n                    break;\r\n\r\n                default:\r\n                    break;\r\n            }\r\n        }\r\n        this.setState({filteredData: filteredResults});\r\n    }\r\n\r\n    buildOn = (buildOn) => {\r\n        this.props.newNote(this.props.view, this.props.communityId, this.props.author._id, buildOn);\r\n    }\r\n\r\n\r\n    render() {\r\n        const hierarchy = this.getBuildOnHierarchy()\r\n        return (\r\n            <>\r\n                {/*<TopNavBar></TopNavBar>*/}\r\n                <Breakpoint medium up>\r\n\r\n                    <div className=\"row min-width\">\r\n\r\n                        {/* NOTES */}\r\n                        <Col md=\"5\" sm=\"12\" className=\"mrg-1-top pd-2-right v-scroll\">\r\n                            {this.props.searchQuery === \"\" ?\r\n                                (<ListOfNotes hierarchy={hierarchy} />)\r\n                                :\r\n                                (<ListOfNotes noteLinks={this.state.filteredData} />)\r\n                            }\r\n                        </Col>\r\n\r\n                        {/* NOTE CONTENT */}\r\n                        {this.props.checkedNotes.length ?\r\n                            (<>\r\n                                <Col md=\"5\" sm=\"12\" className=\"mrg-1-top v-scroll\">\r\n                                    <NoteContent query={this.props.searchQuery} buildOn={this.buildOn} />\r\n                                </Col>\r\n                            </>)\r\n                            : null\r\n                        }\r\n\r\n                    </div>\r\n\r\n\r\n\r\n                </Breakpoint>\r\n\r\n                <Breakpoint small down>\r\n\r\n                    <div className=\"row min-width\">\r\n\r\n                        {/* NOTES */}\r\n                        <Col md=\"5\" sm=\"12\" className=\"mrg-05-top pd-2-right primary-bg-50\">\r\n                            <Form className=\"mrg-1-bot\">\r\n                                <Row>\r\n                                    <Col>\r\n                                        <InputGroup>\r\n                                            <InputGroupAddon addonType=\"prepend\">\r\n                                                <Input type=\"select\" name=\"filter\" id=\"filter\" onChange={this.handleFilter}>\r\n                                                    <option key=\"title\" value=\"title\">Search By Title</option>\r\n                                                    <option key=\"scaffold\" value=\"scaffold\">Search By Scaffold</option>\r\n                                                    <option key=\"content\" value=\"content\">Search By Content</option>\r\n                                                    <option key=\"author\" value=\"author\">Search By Author</option>\r\n                                                </Input>\r\n                                            </InputGroupAddon>\r\n                                            <Input\r\n                                                className=\"form-control\"\r\n                                                value={this.props.searchQuery}\r\n                                                placeholder=\"Search Your Note\"\r\n                                                onChange={this.handleInputChange}\r\n                                            />\r\n\r\n                                            <InputGroupAddon addonType=\"append\">\r\n                                                <InputGroupText>\r\n                                                    <i className=\"fa fa-search\"></i>\r\n                                                </InputGroupText>\r\n                                            </InputGroupAddon>\r\n\r\n                                            <InputGroupAddon addonType=\"append\">\r\n                                                <InputGroupText style={{ cursor: \"pointer\" }} onClick={this.clearSearch} >\r\n                                                    <i className=\"fa fa-refresh\"></i>\r\n                                                </InputGroupText>\r\n                                            </InputGroupAddon>\r\n                                        </InputGroup>\r\n                                    </Col>\r\n                                </Row>\r\n                            </Form>\r\n                            {this.props.searchQuery === \"\" ?\r\n                                (<ListOfNotes hierarchy={hierarchy} />)\r\n                                :\r\n                                (<ListOfNotes noteLinks={this.state.filteredData} />)\r\n                            }\r\n                        </Col>\r\n                    </div>\r\n                </Breakpoint>\r\n            </>\r\n        );\r\n    }\r\n}\r\n\r\nconst mapStateToProps = (state, ownProps) => {\r\n    return {\r\n        communityId: state.globals.communityId,\r\n        viewId: state.globals.viewId,\r\n        view: state.globals.view,\r\n        author: state.globals.author,\r\n        authors: state.users,\r\n        viewNotes: state.notes.viewNotes,\r\n        checkedNotes: state.notes.checkedNotes,\r\n        buildsOn: state.notes.buildsOn,\r\n        supports: state.notes.supports,\r\n        searchQuery: state.globals.searchQuery,\r\n        searchFilter: state.globals.searchFilter,\r\n    }\r\n}\r\n\r\nconst mapDispatchToProps = {\r\n    newNote\r\n}\r\n\r\nexport default connect(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(LightView)\r\n","import React, { Component } from 'react';\r\nimport { Row, Col, OverlayTrigger, Popover, Accordion, Card, Button } from 'react-bootstrap';\r\nimport { connect } from 'react-redux';\r\nimport $ from 'jquery';\r\nimport { updateViewObject, updateCommunityContextObject } from '../../store/async_actions.js';\r\nimport { setCurrViewSettingsObj } from '../../store/globalsReducer.js';\r\n\r\nclass ViewSettingsPopover extends Component {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      tempViewSettingObj: {buildson: true, language: false, references: false, showAuthor: true, showGroup: false, showTime: true},\r\n      thisViewsViewSettingObj: null,\r\n      communityViewSettingsObj: {buildson: false, language: false, references: false, showAuthor: false, showGroup: false, showTime: false},\r\n    }\r\n\r\n    this.initializeSettings = this.initializeSettings.bind(this);\r\n    this.handleViewTypeChange = this.handleViewTypeChange.bind(this);\r\n    this.handleViewSettingsChange = this.handleViewSettingsChange.bind(this);\r\n    this.toggleViewSettingEnable = this.toggleViewSettingEnable.bind(this);\r\n    this.pushViewSettingsChange = this.pushViewSettingsChange.bind(this);\r\n    this.pushCommunitySettingsChange = this.pushCommunitySettingsChange.bind(this);\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState){\r\n    if(this.props.thisViewsViewSettingObj !== prevProps.thisViewsViewSettingObj || this.props.communityViewSettingsObj !== prevProps.communityViewSettingsObj\r\n            || this.props.view !== prevProps.view || this.props.communitySettings !== prevProps.communitySettings){\r\n      this.initializeSettings();\r\n    }\r\n  }\r\n\r\n  // used to set initial values for each of the viewSettingObj states\r\n  initializeSettings(){\r\n    // assign values for this specific view and the community settings if they exist\r\n    this.setState({thisViewsViewSettingObj: (this.props.thisViewsViewSettingObj !== null ? this.props.thisViewsViewSettingObj : null)})\r\n    if(this.props.communityViewSettingsObj !== null){ this.setState({communityViewSettingsObj: this.props.communityViewSettingsObj}); }\r\n\r\n    // set the current view setting values (tempViewSettingObj) to the settings\r\n    // provided in this priority ---> 1. this specific views viewSetting obj 2. the community context viewSetting obj 3. a default set of values\r\n    var temp = {}\r\n    if(this.props.thisViewsViewSettingObj !== null){\r\n      temp = this.props.thisViewsViewSettingObj;\r\n    } else if(this.props.communityViewSettingsObj !== null){\r\n      temp = this.props.communityViewSettingsObj;\r\n    } else {\r\n      temp = {buildson: true, language: false, references: false, showAuthor: true, showGroup: false, showTime: true};\r\n    }\r\n    this.setState({tempViewSettingObj: temp});\r\n    this.props.setCurrViewSettingsObj(temp);\r\n  }\r\n\r\n  // if the selected view type is different from the current - swap the view\r\n  handleViewTypeChange(e){\r\n    if(e.target.value !== this.props.currentView) this.props.switchView();\r\n  }\r\n\r\n  // a unified function that can update any of the viewSetting states\r\n  handleViewSettingsChange(e){\r\n    // create the new viewSetting object from the target and list siblings\r\n    var viewSettings = {};\r\n    const domElem = e.target.parentNode;\r\n    const siblings = $(domElem).siblings();\r\n    viewSettings[e.target.name] = e.target.checked;\r\n    for(let i = 0; i < siblings.length; i++){\r\n      viewSettings[siblings[i].childNodes[1].name] = siblings[i].childNodes[1].checked;\r\n    }\r\n\r\n    // depending on id of the list update the corresponding state\r\n    if(domElem.parentNode.id === \"tempSettingsPopoverList\"){\r\n      this.setState({tempViewSettingObj: viewSettings});\r\n      this.props.setCurrViewSettingsObj(viewSettings);\r\n    } else if(domElem.parentNode.id === \"viewSettingsPopoverList\"){\r\n      this.setState({thisViewsViewSettingObj: viewSettings});\r\n    } else if(domElem.parentNode.id === \"communitySettingsPopoverList\"){\r\n      this.setState({communityViewSettingsObj: viewSettings});\r\n    }\r\n  }\r\n\r\n  // handles the enabling and disabling of specific view settings by the manager\r\n  // if a view objects viewSetting attribute is null the option is disabled\r\n  // when enabling we just default all values to false, if the user sets values and saves them then it will update the view object and enable specific view settings\r\n  toggleViewSettingEnable(){\r\n    var isCurrentlyEnabled = this.state.thisViewsViewSettingObj !== null;\r\n    if(isCurrentlyEnabled){\r\n      var newObject = JSON.parse(JSON.stringify(this.props.view));\r\n      newObject.data.viewSetting = null;\r\n      this.props.updateViewObject(newObject);\r\n    } else {\r\n      this.setState({thisViewsViewSettingObj: {buildson: false, language: false, references: false, showAuthor: false, showGroup: false, showTime: false}});\r\n    }\r\n  }\r\n\r\n  // updates this specific views settings in redux and on the backend\r\n  pushViewSettingsChange(){\r\n    var newObject = JSON.parse(JSON.stringify(this.props.view));\r\n    newObject.data.viewSetting = Object.assign({}, this.state.thisViewsViewSettingObj);\r\n    this.props.updateViewObject(newObject);\r\n  }\r\n\r\n  // updates this communitys context setting object in redux and on the backend\r\n  pushCommunitySettingsChange(){\r\n    var newObject = JSON.parse(JSON.stringify(this.props.communitySettings));\r\n    newObject.data.viewSetting = Object.assign({}, this.state.communityViewSettingsObj);\r\n    this.props.updateCommunityContextObject(newObject);\r\n  }\r\n\r\n  render() {\r\n    var thisViewsViewSettingEnabled = this.state.thisViewsViewSettingObj !== null;\r\n\r\n    return (\r\n      <OverlayTrigger\r\n          placement=\"auto\"\r\n          trigger=\"click\"\r\n          delay={{ show: 0, hide: 0 }}\r\n          rootClose\r\n          overlay={\r\n            <Popover>\r\n\r\n              {/* VIEW TYPE SELECTION */}\r\n              <Popover.Title>View Type</Popover.Title>\r\n              <Popover.Content id=\"viewTypeContent\">\r\n                <Row>\r\n                  <Col><Button value=\"Enhanced\" onClick={this.handleViewTypeChange} className={this.props.currentView===\"Enhanced\" ? 'activeView' : ''}>Enhanced</Button></Col>\r\n                  <Col><Button value=\"Light\" onClick={this.handleViewTypeChange} className={this.props.currentView===\"Light\" ? 'activeView' : ''}>Light</Button></Col>\r\n                </Row>\r\n              </Popover.Content>\r\n              {/* END VIEW TYPE SELECTION */}\r\n\r\n              {this.props.currentView === \"Enhanced\" ? (\r\n                <Popover.Content className=\"viewSettingsPopoverContent\">\r\n                  <Accordion defaultActiveKey=\"0\">\r\n\r\n                      {/* TEMPORARY VIEW SETTINGS */}\r\n                      <Card>\r\n                          <Card.Header className=\"viewSettingsCardHeader\">\r\n                            <Accordion.Toggle as={Button} variant=\"link\" eventKey=\"0\">View Settings (Temporary) <i className=\"fas fa-angle-down\"/></Accordion.Toggle>\r\n                          </Card.Header>\r\n                          <Accordion.Collapse eventKey=\"0\">\r\n                            <Card.Body className=\"viewSettingsCardBody\">\r\n                                <ul id=\"tempSettingsPopoverList\" className=\"settingsPopoverList\">\r\n                                  <li>Buildson <input type=\"checkbox\" name=\"buildson\" onChange={this.handleViewSettingsChange} checked={this.state.tempViewSettingObj.buildson}></input></li>\r\n                                  <li>Reference <input type=\"checkbox\" name=\"references\" onChange={this.handleViewSettingsChange} checked={this.state.tempViewSettingObj.references}></input></li>\r\n                                  <li>Group <input type=\"checkbox\" name=\"showGroup\" onChange={this.handleViewSettingsChange} checked={this.state.tempViewSettingObj.showGroup}></input></li>\r\n                                  <li>Author <input type=\"checkbox\" name=\"showAuthor\" onChange={this.handleViewSettingsChange} checked={this.state.tempViewSettingObj.showAuthor}></input></li>\r\n                                  <li>Date <input type=\"checkbox\" name=\"showTime\" onChange={this.handleViewSettingsChange} checked={this.state.tempViewSettingObj.showTime}></input></li>\r\n                                </ul>\r\n                                <Button className=\"viewSettingsPopoverButton\" onClick={this.initializeSettings}>Reset <i className=\"fas fa-undo-alt\"></i></Button>\r\n                            </Card.Body>\r\n                          </Accordion.Collapse>\r\n                      </Card>\r\n                      {/* END TEMPORARY VIEW SETTINGS */}\r\n\r\n                      {/* PERMANENT SETTINGS SPECIFIC TO THIS VIEW */}\r\n                      {(this.props.author && this.props.author.role === \"manager\") ? (\r\n                        <Card>\r\n                            <Card.Header className=\"viewSettingsCardHeader\">\r\n                              <Accordion.Toggle as={Button} variant=\"link\" eventKey=\"1\">View Settings (Permanent) <i className=\"fas fa-angle-down\"/></Accordion.Toggle>\r\n                            </Card.Header>\r\n                            <Accordion.Collapse eventKey=\"1\">\r\n                              <Card.Body className=\"viewSettingsCardBody\">\r\n                                  <ul id=\"viewSettingsPopoverList\" className=\"settingsPopoverList\">\r\n                                    <li>Buildson <input type=\"checkbox\" name=\"buildson\" onChange={this.handleViewSettingsChange} disabled={!thisViewsViewSettingEnabled}\r\n                                              checked={thisViewsViewSettingEnabled ? this.state.thisViewsViewSettingObj.buildson : false}></input></li>\r\n                                    <li>Reference <input type=\"checkbox\" name=\"references\" onChange={this.handleViewSettingsChange} disabled={!thisViewsViewSettingEnabled}\r\n                                              checked={thisViewsViewSettingEnabled ? this.state.thisViewsViewSettingObj.references : false}></input></li>\r\n                                    <li>Group <input type=\"checkbox\" name=\"showGroup\" onChange={this.handleViewSettingsChange} disabled={!thisViewsViewSettingEnabled}\r\n                                              checked={thisViewsViewSettingEnabled ? this.state.thisViewsViewSettingObj.showGroup : false}></input></li>\r\n                                    <li>Author <input type=\"checkbox\" name=\"showAuthor\" onChange={this.handleViewSettingsChange} disabled={!thisViewsViewSettingEnabled}\r\n                                              checked={thisViewsViewSettingEnabled ? this.state.thisViewsViewSettingObj.showAuthor : false}></input></li>\r\n                                    <li>Date <input type=\"checkbox\" name=\"showTime\" onChange={this.handleViewSettingsChange} disabled={!thisViewsViewSettingEnabled}\r\n                                              checked={thisViewsViewSettingEnabled ? this.state.thisViewsViewSettingObj.showTime : false}></input></li>\r\n                                  </ul>\r\n                                  <Button className={thisViewsViewSettingEnabled ? \"viewSettingsPopoverButton\" : \"viewSettingsPopoverButton vsDisabled\"} style={{width: \"50%\",}}\r\n                                                                                                        onClick={this.pushViewSettingsChange}>Save <i className=\"far fa-save\"></i></Button>\r\n                                  <Button className=\"viewSettingsPopoverButton\" style={{width: \"50%\",}} onClick={this.toggleViewSettingEnable}>{thisViewsViewSettingEnabled ? \"Disable\" : \"Enable\"}</Button>\r\n                              </Card.Body>\r\n                            </Accordion.Collapse>\r\n                        </Card>\r\n                      ) : null}\r\n                      {/* END PERMANENT SETTINGS SPECIFIC TO THIS VIEW */}\r\n\r\n                      {/* PERMANENT COMMUNITY WIDE SETTINGS */}\r\n                      {(this.props.author && this.props.author.role === \"manager\") ? (\r\n                        <Card>\r\n                            <Card.Header className=\"viewSettingsCardHeader\">\r\n                              <Accordion.Toggle as={Button} variant=\"link\" eventKey=\"2\">Community Settings <i className=\"fas fa-angle-down\"/></Accordion.Toggle>\r\n                            </Card.Header>\r\n                            <Accordion.Collapse eventKey=\"2\">\r\n                              <Card.Body className=\"viewSettingsCardBody\">\r\n                                  <ul id=\"communitySettingsPopoverList\" className=\"settingsPopoverList\">\r\n                                    <li>Buildson <input type=\"checkbox\" name=\"buildson\" onChange={this.handleViewSettingsChange} checked={this.state.communityViewSettingsObj.buildson}></input></li>\r\n                                    <li>Reference <input type=\"checkbox\" name=\"references\" onChange={this.handleViewSettingsChange} checked={this.state.communityViewSettingsObj.references}></input></li>\r\n                                    <li>Group <input type=\"checkbox\" name=\"showGroup\" onChange={this.handleViewSettingsChange} checked={this.state.communityViewSettingsObj.showGroup}></input></li>\r\n                                    <li>Author <input type=\"checkbox\" name=\"showAuthor\" onChange={this.handleViewSettingsChange} checked={this.state.communityViewSettingsObj.showAuthor}></input></li>\r\n                                    <li>Date <input type=\"checkbox\" name=\"showTime\" onChange={this.handleViewSettingsChange} checked={this.state.communityViewSettingsObj.showTime}></input></li>\r\n                                  </ul>\r\n                                  <Button className=\"viewSettingsPopoverButton\" onClick={this.pushCommunitySettingsChange}>Save <i className=\"far fa-save\"></i></Button>\r\n                              </Card.Body>\r\n                            </Accordion.Collapse>\r\n                        </Card>\r\n                      ) : null}\r\n                      {/* END PERMANENT COMMUNITY WIDE SETTINGS */}\r\n                  </Accordion>\r\n                </Popover.Content>\r\n\r\n\r\n              ) : null}\r\n              </Popover>\r\n          }>\r\n          <Button className=\"circle-button pad sidebar-btn\">\r\n              <i className=\"fas fa-cog\"></i>\r\n          </Button>\r\n      </OverlayTrigger>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state, ownProps) => {\r\n    return {\r\n        author: state.globals.author,\r\n        communitySettings: state.globals.communitySettings,\r\n        view: state.globals.view,\r\n        currViewSettingsObj: state.globals.currViewSettingsObj,\r\n        thisViewsViewSettingObj: state.globals.thisViewsViewSettingsObj,\r\n        communityViewSettingsObj: state.globals.communityViewSettingsObj,\r\n    }\r\n}\r\n\r\nconst mapDispatchToProps = {\r\n    setCurrViewSettingsObj,\r\n    updateViewObject,\r\n    updateCommunityContextObject,\r\n}\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(ViewSettingsPopover);\r\n","import React from 'react';\r\nimport {Rnd} from 'react-rnd';\r\nimport {Card, Button} from 'react-bootstrap';\r\nimport './dialog.css';\r\nconst dialog_style = {\r\n    zIndex: 999,\r\n    display: 'flex'\r\n}\r\n\r\nconst Dialog = props => {\r\n    return (\r\n            <Rnd\r\n                id={`contrib-dialog-${props.id}`}\r\n                className={\"contrib-dialog\"}\r\n                style={{...dialog_style, ...props.style}}\r\n                default={{\r\n                    x: 400 + window.pageXOffset,\r\n                    y: 50 + window.pageYOffset,\r\n                    width: 920,\r\n                    height: 500,\r\n                }}\r\n                onClick={props.onClick}\r\n                onMouseDown={props.onMouseDown}\r\n                dragHandleClassName='dlg-card-header'\r\n                bounds='window'\r\n            >\r\n                <Card className='dlg-card'>\r\n                    <Card.Header className='dlg-card-header py-0' style={{alignItems: 'center', display: 'flex'}}>\r\n                        <span>{!props.editable ? 'Note' : props.title}</span>\r\n                        <Button onClick={props.onClose} variant='link' size='sm' style={{marginLeft:'auto'}}>x</Button>\r\n                    </Card.Header>\r\n                    <Card.Body className='dlg-card-body' style={{position: 'relative'}}>\r\n                        {props.children}\r\n                    </Card.Body>\r\n                    <Card.Footer className=\"dlg-card-footer py-0\">\r\n                        {!props.editable ? null :\r\n                          <Button size='sm' className=\"dlg-button\"\r\n                              onClick={props.onConfirm}\r\n                              disabled={false ||!props.editable}\r\n                          >\r\n                              Contribute\r\n                          </Button>\r\n                        }\r\n                        {props.buildon ?\r\n                         <Button size='sm' className=\"dlg-button\"\r\n                                 onClick={props.onBuildOnClick}>\r\n                             Build-on\r\n                         </Button>\r\n                        : ''}\r\n                    </Card.Footer>\r\n                </Card>\r\n            </Rnd>\r\n    )\r\n}\r\n\r\nexport default Dialog;\r\n","import React from 'react';\r\nimport Dialog from '../dialog/Dialog.js'\r\n\r\nclass DrawTool extends React.Component {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.onConfirm = this.onConfirm.bind(this);\r\n        this.onLoad = this.onLoad.bind(this);\r\n        this.getIframeRef = this.getIframeRef.bind(this);\r\n    }\r\n\r\n    onConfirm(){\r\n        var wnd1 = this.iframe_ref.contentWindow;\r\n        var bg = wnd1.svgCanvas.current_drawing_.all_layers[0];\r\n        var wnd2 = wnd1.svgCanvas.current_drawing_.all_layers[1];\r\n\r\n        var widd = wnd2[1].getBBox().width;\r\n        var heig = wnd2[1].getBBox().height;\r\n        if (widd === 0 || heig === 0){\r\n            this.props.onClose()\r\n            return;\r\n        }\r\n\r\n        wnd1.svgCanvas.current_drawing_.svgElem_.setAttribute(\"width\", widd);\r\n        wnd1.svgCanvas.current_drawing_.svgElem_.setAttribute(\"height\", heig);\r\n        bg[1].childNodes[1].setAttribute(\"width\", widd);\r\n        bg[1].childNodes[1].setAttribute(\"height\", heig);\r\n        wnd1.svgCanvas.selectAllInCurrentLayer();\r\n        wnd1.svgCanvas.groupSelectedElements();\r\n        wnd1.svgCanvas.alignSelectedElements('l', 'page');\r\n        wnd1.svgCanvas.alignSelectedElements('t', 'page');\r\n        wnd1.svgCanvas.ungroupSelectedElement();\r\n        wnd1.svgCanvas.clearSelection();\r\n        wnd1.svgCanvas.current_drawing_.svgElem_.setAttribute(\"padding\", '2em');\r\n        wnd1.svgCanvas.setResolution('fit', 100);\r\n        var svg = wnd1.svgCanvas.getSvgString();\r\n\r\n        var canvas = document.createElement(\"canvas\");\r\n\r\n        canvas.width = widd + 4;\r\n        canvas.height = heig + 4;\r\n\r\n        var ctx = canvas.getContext(\"2d\");\r\n\r\n        var img = document.createElement(\"img\");\r\n\r\n        img.setAttribute(\"src\", \"data:image/svg+xml;base64,\" + btoa(svg));\r\n\r\n        img.onload = function () {\r\n            ctx.drawImage(img, 0, 0);\r\n            var p = canvas.toDataURL(\"image/png\");\r\n            const drawing = \"<img alt='\" + svg + \"' src='\" + p + \"'/>\";\r\n\r\n            this.props.onConfirm(drawing);\r\n        }.bind(this);\r\n    }\r\n\r\n    getIframeRef(frame) {\r\n        if(!frame) {\r\n            return\r\n        }\r\n        this.iframe_ref = frame\r\n    }\r\n\r\n    onLoad(e){\r\n        const svg = this.props.svg\r\n        if (svg){\r\n            e.target.contentWindow.svgCanvas.setSvgString(svg)\r\n        }\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <Dialog\r\n                title='DrawTool'\r\n                style={{zIndex: 3000}}\r\n                onClose={this.props.onClose}\r\n                onConfirm={this.onConfirm}\r\n                editable={true}\r\n                confirmButton='Add'>\r\n\r\n                <iframe onLoad={this.onLoad} title='DrawingTool' src='/drawing-tool/svg/index.html' ref={this.getIframeRef} width='100%' height='100%'></iframe>\r\n            </Dialog>\r\n        )\r\n    }\r\n}\r\n\r\nexport default DrawTool\r\n","import React from 'react';\r\nimport { Editor } from '@tinymce/tinymce-react';\r\n/* import './editor.css' */\r\n\r\nclass MCEditor extends React.Component {\r\n\r\n    render() {\r\n        return (\r\n            <div>\r\n                <Editor\r\n                    value={this.props.value}\r\n                    apiKey=\"arg05azt52qbujpnf831szuswhmyhoqute0q48btk5bqigoj\"\r\n                    init={{\r\n                        setup: (editor) => {this.props.onEditorSetup(editor)},\r\n                        content_css: '/editor.css',\r\n                        height: 300,\r\n                        menubar: false,\r\n                        statusbar: false,\r\n                        media_live_embeds: true,\r\n                        plugins: [\r\n                            'advlist autolink lists link image charmap print preview anchor',\r\n                            'searchreplace visualblocks code fullscreen',\r\n                            'insertdatetime media table paste code wordcount media help'\r\n                        ],\r\n                        external_plugins: {\r\n                            'drawingTool': '/drawing-tool/plugin.min.js'\r\n                        },\r\n                        toolbar: 'styleselect | bold italic underline strikethrough | forecolor backcolor bullist numlist | link code | ltr rtl | charmap | drawingTool media'\r\n                    }}\r\n                    onEditorChange={this.props.onEditorChange}\r\n                />\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default MCEditor;\r\n","\r\nconst newScaffoldTag = (supportId, title, isTemplate, addHyphen) => (initText) => {\r\n\r\n    let supportContentId = new Date().getTime().toString();\r\n    var contentTagStr = '<span id=\"' + supportContentId + '\"></span>';\r\n    var text = contentTagStr + initText;\r\n    if (addHyphen) {\r\n        text = ' -&nbsp;' + text + '&nbsp;- ';\r\n    }\r\n\r\n    var tag = '';\r\n    tag = tag + '<br>';\r\n    tag = tag + '&nbsp;&nbsp;'; //important for mce\r\n    if (!isTemplate) {\r\n        tag = tag + '<span id=\"' + supportId + '\" class=\"KFSupportStart mceNonEditable\">';\r\n    } else {\r\n        tag = tag + '<span id=\"' + supportId + '\" class=\"KFSupportStart KFTemplateStart mceNonEditable\">';\r\n    }\r\n    tag = tag + createScaffoldStartTag(title, isTemplate);\r\n    tag = tag + '</span>';\r\n    if (isTemplate) {\r\n        tag = tag + '<p class=\"kfTemplateContent\">';\r\n        tag = tag + '<br><br><br><br>';\r\n    }\r\n    tag = tag + text;\r\n    if (isTemplate) {\r\n        tag = tag + '</p>';\r\n    }\r\n    if (!isTemplate) {\r\n        tag = tag + '<span id=\"' + supportId + '\" class=\"KFSupportEnd mceNonEditable\">';\r\n    } else {\r\n        tag = tag + '<span id=\"' + supportId + '\" class=\"KFSupportEnd KFTemplateEnd mceNonEditable\">';\r\n    }\r\n    tag = tag + createScaffoldEndTag(isTemplate);\r\n    tag = tag + '</span>';\r\n    tag = tag + '&nbsp;&nbsp;'; //important for mce\r\n    tag = tag + '<br>';\r\n    return {tag, supportContentId};\r\n};\r\n\r\nconst createNewScaffoldTag = function(supportId, title, text, isTemplate) {\r\n    var tag = '';\r\n    tag = tag + '<br>';\r\n    tag = tag + '&nbsp;&nbsp;'; //important for mce\r\n    if (!isTemplate) {\r\n        tag = tag + '<span id=\"' + supportId + '\" class=\"KFSupportStart mceNonEditable\">';\r\n    } else {\r\n        tag = tag + '<span id=\"' + supportId + '\" class=\"KFSupportStart KFTemplateStart mceNonEditable\">';\r\n    }\r\n    tag = tag + createScaffoldStartTag(title, isTemplate);\r\n    tag = tag + '</span>';\r\n    if (isTemplate) {\r\n        tag = tag + '<p class=\"kfTemplateContent\">';\r\n        tag = tag + '<br><br><br><br>';\r\n    }\r\n    tag = tag + text;\r\n    if (isTemplate) {\r\n        tag = tag + '</p>';\r\n    }\r\n    if (!isTemplate) {\r\n        tag = tag + '<span id=\"' + supportId + '\" class=\"KFSupportEnd mceNonEditable\">';\r\n    } else {\r\n        tag = tag + '<span id=\"' + supportId + '\" class=\"KFSupportEnd KFTemplateEnd mceNonEditable\">';\r\n    }\r\n    tag = tag + createScaffoldEndTag(isTemplate);\r\n    tag = tag + '</span>';\r\n    tag = tag + '&nbsp;&nbsp;'; //important for mce\r\n    tag = tag + '<br>';\r\n    return tag;\r\n};\r\n\r\n\r\nconst createScaffoldStartTag = function(title, isTemplate) {\r\n    var tag = '';\r\n    tag = tag + ' '; //important for mce\r\n    if (!isTemplate) {\r\n        tag = tag + '<span class=\"kfSupportStartMark\"> &nbsp; </span>';\r\n    } else {\r\n        tag = tag + '<span class=\"kfSupportStartMark kfTemplateStartMark\"> &nbsp; </span>';\r\n    }\r\n    tag = tag + ' '; //important for mce\r\n    if (!isTemplate) {\r\n        tag = tag + '<span class=\"kfSupportStartLabel\">' + title + '</span>';\r\n    } else {\r\n        tag = tag + '<span class=\"kfSupportStartLabel kfTemplateStartLabel\">' + title + '</span>';\r\n    }\r\n    tag = tag + ' '; //important for mce\r\n    return tag;\r\n};\r\n\r\nconst createScaffoldEndTag = function(isTemplate) {\r\n    var tag = '';\r\n    tag = tag + ' '; //important for mce\r\n    if (!isTemplate) {\r\n        tag = tag + '<span class=\"kfSupportEndMark\"> &nbsp; </span>';\r\n    } else {\r\n        tag = tag + '<span class=\"kfSupportEndMark kfTemplateEndMark\"> &nbsp; </span>';\r\n    }\r\n    tag = tag + ' '; //important for mce\r\n    return tag;\r\n};\r\n\r\nexport default { createNewScaffoldTag, newScaffoldTag }\r\n","import React from 'react';\r\nimport {Form, Container, Row, Col} from 'react-bootstrap';\r\nimport { connect } from 'react-redux'\r\nimport {fetchScaffolds} from '../../store/scaffoldReducer.js'\r\nimport scaffoldService from './scaffold.service'\r\nimport './scaffold.css'\r\n\r\nclass ScaffoldSelect extends React.Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {selected: props.initVal};\r\n        this.onSelectChange = this.onSelectChange.bind(this);\r\n    }\r\n\r\n\r\n    componentDidMount() {\r\n        if (!this.props.fetched){\r\n            const {communityId, contextId} = this.props;\r\n            this.props.fetchScaffolds(communityId, contextId);\r\n        }\r\n    }\r\n\r\n    onSelectChange(event) {\r\n        this.setState({selected: event.target.value});\r\n    }\r\n\r\n    scaffoldSelected = (scaffoldId, support) => {\r\n        if (this.props.returnSupport){\r\n            this.props.onScaffoldSelected(support)\r\n            return\r\n        }\r\n        const scaffold = this.props.items[scaffoldId];\r\n        let addhyphen = true;\r\n        let initialText = '';\r\n        const isTemplate = scaffold.data && scaffold.data.isTemplate\r\n        if (isTemplate) {\r\n            addhyphen = false;\r\n            initialText = '<br><br>'\r\n        }\r\n\r\n        const scaffold_text = support._to.title\r\n        const tagCreator = scaffoldService.newScaffoldTag(support.to, scaffold_text, isTemplate, addhyphen);\r\n        this.props.onScaffoldSelected(tagCreator, initialText)\r\n    }\r\n\r\n    render() {\r\n        const scaffolds = this.props.items;\r\n        const options = scaffolds.map((scaffold, i) =>\r\n            <option key={i} value={i}>{scaffold.title}</option>\r\n        );\r\n        let supports = '';\r\n        if (scaffolds.length && scaffolds[this.state.selected].supports) {\r\n            supports = scaffolds[this.state.selected].supports.map((support, i) =>\r\n                <Col className=\"mt-1 p-0\" key={i} md={12}>\r\n                    <div className='KFSupportButton' size='sm' onClick={() => this.scaffoldSelected(this.state.selected, support) }>\r\n                        {support._to.title}\r\n                    </div>\r\n                </Col>\r\n            );\r\n        }\r\n\r\n        return (\r\n            <Container>\r\n                <Row>\r\n                    <Col className='p-0'>\r\n                        <Form>\r\n                            <Form.Group className='mb-1' controlId=\"exampleForm.ControlSelect2\">\r\n                                <Form.Control className=\"scaffold-select-input\" size='sm' as=\"select\" onChange={this.onSelectChange}>\r\n                                    {options}\r\n                                </Form.Control>\r\n                            </Form.Group>\r\n                        </Form>\r\n                    </Col>\r\n                </Row>\r\n                <Row>\r\n                    {supports}\r\n                </Row>\r\n            </Container>\r\n\r\n        );\r\n    }\r\n}\r\n\r\nconst mapStateToProps = (state, ownProps) => {\r\n    return {\r\n        communityId: state.globals.communityId,\r\n        contextId: state.globals.contextId,\r\n        ...state.scaffolds\r\n    }\r\n}\r\n\r\nconst mapDispatchToProps = { fetchScaffolds }\r\n\r\nexport default connect(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(ScaffoldSelect)\r\n","import React, {useState} from 'react';\r\nimport {useSelector} from 'react-redux'\r\nimport { Row, Col, Button} from 'react-bootstrap'\r\nimport {url as serverUrl} from '../../store/api'\r\nimport './attachArea.css'\r\n\r\nconst AttachArea = props => {\r\n\r\n    const attachments = useSelector(state => {\r\n        const atts = []\r\n        props.attachments.forEach((attId) => {\r\n            const att = state.notes.attachments[attId]\r\n            if (att){ atts.push(att) }\r\n        })\r\n        return atts;\r\n    })\r\n    const [selectedImgs, setSelectedImgs] = useState([])\r\n    const getFileNameString = (name) => {\r\n       return name\r\n    }\r\n\r\n    const getFileSizeString = (size) => {\r\n        return size\r\n    }\r\n\r\n    const addImages = () => {\r\n        const  selectedImgs = Array.from(document.getElementById(`attachbox-${props.noteId}`).getElementsByClassName(\"selected\"))\r\n        if (selectedImgs.length === 0) {\r\n            return;\r\n        }\r\n        let html = \"\";\r\n        const maxWidth = 200;\r\n        selectedImgs.forEach((img) => {\r\n            const tagName = img.tagName;\r\n            let width = img.naturalWidth;\r\n            if(width > maxWidth){\r\n                width = maxWidth;\r\n            }\r\n            if (tagName === 'IMG') {\r\n                const data_mce_src = img.getAttribute(\"src\");\r\n                let className = '';\r\n                img.classList.forEach(cls_name => {\r\n                    if (cls_name.length === 24) { //Find 24 char long classes, one of them might be MongoDB id\r\n                        className += cls_name + ' ';\r\n                    }\r\n                })\r\n                html += '<img class=\"inline-attachment ' + className + '\" src=\"' + data_mce_src + '\" width=\"' + width + 'px\" alt=\"\" data-mce-src=\"' + data_mce_src + '\">';\r\n            }\r\n\r\n        })\r\n        props.onNewInlineAttach(html)\r\n\r\n    }\r\n    const selectedImg = (attId, e) => {\r\n        if (selectedImgs.includes(attId)){\r\n            setSelectedImgs((imgs) => imgs.filter( img => img !== attId))\r\n        }else{\r\n            setSelectedImgs((imgs) => [...imgs, attId])\r\n        }\r\n    }\r\n    const deleteAttachment = (attId) => {\r\n        if (window.confirm('Are you sure to delete the attachment?')) {\r\n            props.onAttachDelete(attId)\r\n        }\r\n    }\r\n    return (\r\n        <Col>\r\n            <Row>\r\n                <Col>\r\n                    <span className=''>Insert image or file: </span>\r\n                    <Button className='attach-button mx-2' size='sm' variant='outline-dark' onClick={()=> props.onNewAttachClick(true)}>Inline</Button>\r\n                    <Button className='attach-button mx-2' size='sm' variant='outline-dark' onClick={()=>props.onNewAttachClick(false)}>As an attachment</Button>\r\n                    <Button className='attach-button mx-2' size='sm' variant='outline-dark' onClick={addImages} disabled={selectedImgs.length === 0}>Insert</Button>\r\n                </Col>\r\n            </Row>\r\n            <Row id={`attachbox-${props.noteId}`} className='attachment-box'>\r\n                {\r\n                    attachments.map((attachment) => (\r\n                            <div key={attachment._id} className=\"attachment-inner-box col-auto\">\r\n                                <div className=\"attachment-thumbnail\">\r\n                                    {\r\n                                        attachment.data.type.indexOf('image/') === 0 ?\r\n                                        <img className={attachment._id + \" \" + (selectedImgs.includes(attachment._id) ? 'selected' : '')} src={`${serverUrl}${attachment.data.url}`} onClick={(e) => selectedImg(attachment._id, e)} alt='attachment'/>\r\n                                        :\r\n                                        <a href={`${serverUrl}${(attachment.data.downloadUrl || attachment.data.url)}`} title={attachment.title} download>\r\n                                            <img className={attachment._id} src={`${serverUrl}/manual_assets/kf6images/03-toolbar-attachment.png`}\r\n                                                 title=\"{attachment.title}\" alt='attachment' />\r\n                                        </a>\r\n                                    }\r\n                                </div>\r\n                                <div className=\"attachment-buttons\">\r\n                                    <p>\r\n                                        <a href={`${serverUrl}${(attachment.data.downloadUrl || attachment.data.url)}`}\r\n                                           title={attachment.title} download>\r\n                                            <img className=\"download-attachment\" src={`${serverUrl}/manual_assets/kf6images/cloud-download-2x.png`}\r\n                                                 alt=\"Download\" height=\"15px\" />\r\n                                        </a>\r\n                                    </p>\r\n                                    <p>\r\n                                        <button className=\"delete-attachment\" onClick={() => deleteAttachment(attachment._id)}>\r\n                                            <img src={`${serverUrl}/manual_assets/kf6images/trash.png`} alt='Delete attachment' width=\"10px\" height=\"15px\"/>\r\n                                        </button>\r\n                                    </p>\r\n                                </div>\r\n                                <div className=\"attachment-info\">\r\n                                    <p title=\"{attachment.title}\">{getFileNameString(attachment.title)}</p>\r\n                                    <p>{getFileSizeString(attachment.data.size)}</p>\r\n                                </div>\r\n                            </div>\r\n                ))\r\n                }\r\n            </Row>\r\n        </Col>\r\n    )\r\n\r\n};\r\n\r\nexport default AttachArea;\r\n","import React from 'react';\r\nimport MCEditor from '../editor/MCEditor'\r\nimport AttachPanel from '../attachmentCollapse/AttachPanel.js'\r\nimport {Container, Row, Col, Form} from 'react-bootstrap'\r\nimport ScaffoldSelect from '../scaffold/ScaffoldSelect'\r\nimport AttachArea from '../attachmentArea/AttachArea.js'\r\n\r\nimport './WriteTab.css';\r\nclass WriteTab extends React.Component {\r\n\r\n    constructor(props){\r\n        super(props)\r\n        this.state = {inlineAttach: true, attachPanel: false}\r\n        this.onScaffoldSelected = this.onScaffoldSelected.bind(this);\r\n        this.onNewAttachmentClick = this.onNewAttachmentClick.bind(this);\r\n        this.closeAttachPanel = this.closeAttachPanel.bind(this);\r\n        this.onNewInlineAttach = this.onNewInlineAttach.bind(this);\r\n        this.onAttachDelete = this.onAttachDelete.bind(this)\r\n    }\r\n\r\n    onScaffoldSelected(tagCreator, initialText){\r\n        this.props.onChange({scaffold: {tagCreator, initialText}})\r\n    }\r\n\r\n    onNewAttachmentClick(inline){\r\n        this.setState({inlineAttach: inline, attachPanel: true})\r\n    }\r\n    onNewInlineAttach(inlineAttach) {\r\n        this.props.onChange({attach: inlineAttach})\r\n    }\r\n    closeAttachPanel()  {\r\n        this.setState({attachPanel: false})\r\n    }\r\n    onAttachDelete(attachId) {\r\n        this.props.onChange({deleteAttach: attachId})\r\n    }\r\n    render() {\r\n        const {note, onChange, onEditorSetup} = this.props;\r\n        return (\r\n            <Container className='write-container p-0'>\r\n                    <Row>\r\n                        <Col>\r\n                            <Form.Group className=\"write-title-form\" controlId=\"note-title\">\r\n                                <Form.Control type=\"text\"\r\n                                              className=\"write-tab-input\"\r\n                                              size=\"sm\"\r\n                                              placeholder=\"Enter title\"\r\n                                              value={note.title}\r\n                                              onChange={(val) => {onChange({title: val.target.value})}}/>\r\n                            </Form.Group>\r\n                        </Col>\r\n                    </Row>\r\n                    <Row>\r\n                        <Col md={2} className='pr-0'>\r\n                            <ScaffoldSelect initVal={0} onScaffoldSelected={this.onScaffoldSelected}/>\r\n                        </Col>\r\n                        <Col md={10}>\r\n                            <MCEditor value={note.data.body}\r\n                                      onEditorSetup={onEditorSetup}\r\n                                      onEditorChange={(content, editor) => onChange({ data: {body: content}})}/>\r\n                            <div className='wordcount-bar text-right'>{note.wordCount} words</div>\r\n\r\n                        </Col>\r\n                    </Row>\r\n                    <Row className='mt-2'>\r\n                        <AttachPanel noteId={note._id} onClose={this.closeAttachPanel} onNewInlineAttach={this.onNewInlineAttach} {...this.state}></AttachPanel>\r\n                        <AttachArea\r\n                            noteId={note._id}\r\n                            attachments={note.attachments}\r\n                            onNewAttachClick={this.onNewAttachmentClick}\r\n                            onNewInlineAttach={this.onNewInlineAttach}\r\n                            onAttachDelete={this.onAttachDelete}\r\n                        >\r\n                        </AttachArea>\r\n                    </Row>\r\n            </Container>\r\n        )\r\n    }\r\n}\r\n\r\nexport default WriteTab;\r\n","import React from 'react';\r\n\r\nconst History = props => {\r\n\r\n    const [read, edit] = props.records.reduce(\r\n        (acc, el) => {\r\n            if (el.type === 'read') {\r\n                acc[0].push(el)\r\n            }else{\r\n                acc[1].push(el)\r\n            }\r\n            return acc\r\n        }, [[],[]])\r\n    return (\r\n        <div>\r\n            <h5>Edit logs:</h5>\r\n            <p className='mb-0'>{edit.length} edits</p>\r\n            <ul>\r\n                {edit.map((record) =>\r\n                    <li key={record._id}>{record.date}: {record.author}</li>\r\n                )}\r\n            </ul>\r\n            <h5>Read logs:</h5>\r\n            <p className='mb-0'>{read.length} reads</p>\r\n            <ul>\r\n                {read.map((record) =>\r\n                    <li key={record._id}>{record.date}: {record.author}</li>\r\n                )}\r\n            </ul>\r\n        </div>\r\n    )\r\n\r\n}\r\n\r\nexport default History\r\n","import React from 'react';\r\n\r\nconst Properties = props => {\r\n\r\n    const onPermissionChange = (evt) => {\r\n        props.onChange({permission: evt.target.value})\r\n    }\r\n    //TODO\r\n    const isTemplateChange = (evt) => {\r\n        props.onChange({data: {isTemplate: evt.target.checked}})\r\n    }\r\n\r\n    return (\r\n        <div className=\"m-2\">\r\n            <div>\r\n                <label className='mt-1 font-weight-bold'>Permission:</label>\r\n                <div>\r\n                    <table className=\"KFPermission table table-sm\">\r\n                        <thead>\r\n                            <tr>\r\n                                <th>&nbsp;</th>\r\n                                <th>Authors</th>\r\n                                <th>Group Members</th>\r\n                                <th>Others</th>\r\n                            </tr>\r\n                        </thead>\r\n                                <tbody>\r\n                                    <tr>\r\n                                        <td>\r\n                                            <form action=\"\">\r\n                                                <div className=\"form-check form-check-inline\">\r\n                                                    <input className=\"form-check-input\" type=\"radio\" name='permission' value=\"private\" id=\"contrib-permission1\"\r\n                                                           onChange={onPermissionChange} checked={props.contribution.permission === 'private'}\r\n                                                    />\r\n                                                        <label className=\"form-check-label font-weight-normal\" htmlFor=\"contrib-permission1\">\r\n        &nbsp;private\r\n                                                        </label>\r\n                                                </div>\r\n                                            </form>\r\n                                        </td>\r\n                                        <td>rw</td>\r\n                                        <td>rw</td>\r\n                                        <td>-</td>\r\n                                    </tr>\r\n                                    <tr>\r\n                                        <td>\r\n                                            <form action=\"\">\r\n                                                <div className=\"form-check form-check-inline\">\r\n                                                    <input className=\"form-check-input\" type=\"radio\" value=\"protected\" id=\"contrib-permission2\" name='permission'\r\n                                                           onChange={onPermissionChange} checked={props.contribution.permission === 'protected'}\r\n                                                    />\r\n                                                        <label className=\"form-check-label font-weight-normal\" htmlFor=\"contrib-permission2\">\r\n        &nbsp;protected\r\n                                                        </label>\r\n                                                </div>\r\n                                            </form>\r\n                                        </td>\r\n                                        <td>rw</td>\r\n                                        <td>rw</td>\r\n                                        <td>r</td>\r\n                                    </tr>\r\n                                    <tr>\r\n                                        <td>\r\n                                            <form action=\"\">\r\n                                                <div className=\"form-check form-check-inline\">\r\n                                                    <input className=\"form-check-input\" type=\"radio\" value=\"public\" id=\"contrib-permission3\" name='public'\r\n                                                           onChange={onPermissionChange} checked={props.contribution.permission === 'public'}\r\n                                                    />\r\n                                                        <label className=\"form-check-label font-weight-normal\" htmlFor=\"contrib-permission3\">\r\n        &nbsp;public\r\n                                                        </label>\r\n                                                </div>\r\n                                            </form>\r\n                                        </td>\r\n                                        <td>rw</td>\r\n                                        <td>rw</td>\r\n                                        <td>rw</td>\r\n                                    </tr>\r\n                                </tbody>\r\n                    </table>\r\n                </div>\r\n                <label className=\"mt-1 font-weight-bold\">Status:</label>\r\n                <div className=\"ml-2\">\r\n                    {props.contribution.status}\r\n                </div>\r\n                <label className=\"mt-2 font-weight-bold\">Template:</label>\r\n                <form className=\"ml-2\" action=\"\">\r\n                    <div className=\"form-check  form-check-inline\">\r\n                        <input className=\"form-check-input\" type=\"checkbox\" id=\"c-isTemplate\" checked={props.contribution.data.isTemplate} onChange={isTemplateChange}/>\r\n\r\n                            <label className=\"form-check-label font-weight-normal\" htmlFor=\"c-isTemplate\">\r\n                                isTemplate\r\n                            </label>\r\n                    </div>\r\n                </form>\r\n            </div>\r\n            {/* { props.contribution.type === 'Note' &&\r\n                (<div>\r\n                <label className=\"mt-1 mr-1 font-weight-bold\">Riseabove:</label>\r\n                {\r\n                (props.contribution.type === 'Note' && props.contribution.data && props.contribution.data.riseabove && props.contribution.data.riseabove.viewId) ?\r\n\r\n                \"This note has riseabove view. Please look it at 'Read' tab.\"\r\n                :\r\n\r\n                <button type=\"submit\" className=\"btn btn-primary btn-sm\" onClick={makeRiseAbove()}>MakeRiseabove</button>\r\n                }\r\n                </div>)\r\n                } */}\r\n        </div>\r\n\r\n    )\r\n}\r\n\r\nexport default Properties\r\n","import React, {useState} from 'react';\r\nimport {Button, Row, Col} from 'react-bootstrap'\r\nimport Select from 'react-select'\r\nconst AuthorSelect = props => {\r\n    const select_options = Object.entries(props.authors).map(\r\n        (auth) => { return {value: auth[1]._id, label: `${auth[1].firstName} ${auth[1].lastName}`} })\r\n\r\n    const [selectedOption, setSelectedOption] = useState(null);\r\n    const handleChange = selected => {\r\n        setSelectedOption(selected)\r\n    };\r\n\r\n    return (\r\n        <div>\r\n            <Row>\r\n                <Col>\r\n                    <Select options={select_options} onChange={handleChange} isClearable={true}/>\r\n                </Col>\r\n                <Col md='auto'>\r\n                    <Button disabled={!selectedOption}\r\n                        onClick={() => props.onAuthorSelected(selectedOption)}>Add</Button>\r\n                </Col>\r\n            </Row>\r\n            <p>{select_options.length} possible author(s) in this community.</p>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default AuthorSelect\r\n","import React from 'react';\r\nimport { useSelector } from 'react-redux';\r\nimport { Button, Col, Row } from 'react-bootstrap'\r\nimport { addNotification } from '../../store/notifier.js'\r\nimport AuthorSelect from '../authorSelect/AuthorSelect'\r\nimport Select from 'react-select'\r\n\r\nconst AuthorTab = props => {\r\n    const authors = useSelector((state) => props.contrib.authors.map((auth) => state.users[auth]))\r\n    const communityAuthors = useSelector((state) => state.users)\r\n    const groups = useSelector((state) => state.globals.community.groups)\r\n    const group_options = groups.map((g) => ({value: g._id, label: g.title}))\r\n    const contribGroup = groups.find(group => group._id === props.contrib.group)\r\n    const g = contribGroup ? {value: contribGroup._id, label: contribGroup.title} : {value: null, label: 'No Group selected'}\r\n\r\n\r\n    const removeAuthor = (author, idx) => {\r\n        if (idx === 0) {\r\n            addNotification({title: 'Error!', type:'danger', message:'cannot remove the Primary Author'})\r\n            return;\r\n        }else if (idx >= 0) {\r\n            props.onChange({authors: props.contrib.authors.filter(auth => auth !== author._id)})\r\n        }\r\n    }\r\n\r\n    const addAuthor = (author) => {\r\n        if (!props.contrib.authors.includes(author.value)){\r\n            props.onChange({authors: [...props.contrib.authors, author.value]})\r\n        }\r\n    }\r\n\r\n    const selectGroup = (selected) => {\r\n        props.onChange({group: selected && selected.value})\r\n    }\r\n\r\n    //TODO\r\n    const isEditable = () => {\r\n        return true\r\n    }\r\n    return (\r\n                <div className=\"authorTab mt-2\" style={{height: '100%'}}>\r\n                    <Row>\r\n                        <Col>\r\n                            <h5>Authors:</h5>\r\n                            <ul>\r\n                                {\r\n                                    authors.map((author, idx) => (\r\n\r\n                                        <li key={author._id} style={{cursor: 'move'}}>\r\n                                            {author.firstName} {author.lastName}\r\n                                            <Button size='sm' className='ml-1'\r\n                                                    onClick={() => removeAuthor(author, idx)}>x</Button>\r\n                                        </li>\r\n\r\n                                    ))\r\n                                }\r\n                            </ul>\r\n                        </Col>\r\n                        <Col>\r\n                            <div>\r\n                                <h5>Add author:</h5>\r\n                                <AuthorSelect authors={communityAuthors} onAuthorSelected={addAuthor}/>\r\n                            </div>\r\n                        </Col>\r\n                    </Row>\r\n                    <Row>\r\n                        <Col>\r\n                            <h5>Group:</h5>\r\n                            <div>\r\n                                {\r\n                                    isEditable()?\r\n                                    <form method=\"\" id=\"\" action=\"\">\r\n                                        <Select value={g} options={group_options} onChange={selectGroup} isClearable={true}/>\r\n                                    </form>\r\n                                    :\r\n                                    <div>{g.label}</div>\r\n                                }\r\n                            </div>\r\n                        </Col>\r\n                    </Row>\r\n                </div>\r\n\r\n    )\r\n}\r\n\r\nexport default AuthorTab\r\n","/*global Annotator*/\r\n/*global $*/\r\nimport tinymce from 'tinymce/tinymce';\r\nimport ReactDOM from 'react-dom';\r\n// Default icons are required for TinyMCE 5.3 or above\r\nimport 'tinymce/icons/default';\r\n\r\n// A theme is also required\r\nimport 'tinymce/themes/silver';\r\n// Any plugins you want to use has to be imported\r\nimport 'tinymce/plugins/media';\r\nimport 'tinymce/plugins/image';\r\nimport 'tinymce/plugins/insertdatetime';\r\nimport 'tinymce/plugins/link';\r\nimport 'tinymce/plugins/code';\r\n\r\nexport const setKFPlugin = (elem, annotatorHandler, uname, scaffoldElement) => {\r\n    Annotator.Plugin.KFPlugin = function( /*element*/ ) {\r\n        return {\r\n            pluginInit: function() {\r\n                this.annotator\r\n                    .subscribe('annotationCreated', function(annotation) {\r\n                        if (annotatorHandler) {\r\n                            annotatorHandler.annotationCreated(annotation);\r\n                        }\r\n                    })\r\n                    .subscribe('annotationUpdated', function(annotation) {\r\n                        if (annotatorHandler) {\r\n                            annotatorHandler.annotationUpdated(annotation);\r\n                        }\r\n                    })\r\n                    .subscribe('annotationDeleted', function(annotation) {\r\n                        if (annotatorHandler) {\r\n                            annotatorHandler.annotationDeleted(annotation);\r\n                        }\r\n                    })\r\n                    .subscribe('annotationEditorShown', function(editor, annotation){\r\n                        if (annotatorHandler) {\r\n                            annotatorHandler.displayEditor(editor, annotation);\r\n                        }\r\n                    })\r\n                    .subscribe('annotationViewerShown', function(viewer, annotations) {\r\n                        if (annotatorHandler) {\r\n                            annotatorHandler.displayViewer(viewer, annotations);\r\n                        }\r\n                    })\r\n                    .subscribe('annotationEditorHidden', function(editor, annotation){\r\n                        if (annotatorHandler) {\r\n                            annotatorHandler.editorHidden(editor, annotation);\r\n                        }\r\n                    })\r\n\r\n                ;\r\n\r\n                if (annotatorHandler) {\r\n                    annotatorHandler.annotatorInitialized(this.annotator);\r\n                }\r\n            }\r\n        };\r\n    };\r\n\r\n\r\n    //----------------------------Rich Text Annotator Plugin: START -----------------------------\r\n    /*\r\n      Rich Text Annotator Plugin v1.0 (https://github.com/danielcebrian/richText-annotator)\r\n      Copyright (C) 2014 Daniel Cebrián Robles\r\n      License: https://github.com/danielcebrian/richText-annotator/blob/master/License.rst\r\n      This program is free software; you can redistribute it and/or\r\n      modify it under the terms of the GNU General Public License\r\n      as published by the Free Software Foundation; either version 2\r\n      of the License, or (at your option) any later version.\r\n      This program is distributed in the hope that it will be useful,\r\n      but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n      GNU General Public License for more details.\r\n      You should have received a copy of the GNU General Public License\r\n      along with this program; if not, write to the Free Software\r\n      Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n    */\r\n    // Generated by CoffeeScript 1.6.3\r\n    /* jshint ignore:start */\r\n    var _ref,\r\n        // __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\r\n        __hasProp = {}.hasOwnProperty,\r\n        __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\r\n\r\n\r\n    Annotator.Plugin.RichText = (function(_super) {\r\n        __extends(RichText, _super);\r\n\r\n\r\n        // FILE - GLOBALS -----\r\n        var editorId =\"\";\r\n\r\n        //----------------------\r\n        //Default tinymce configuration\r\n        RichText.prototype.options = {\r\n            tinymce:{\r\n                selector: \"li.annotator-item textarea\",\r\n                content_css: '/editor.css',\r\n                height:\"170px\",\r\n                statusbar: false,\r\n                plugins: \"media image insertdatetime link code\",\r\n                menubar: false,\r\n                toolbar_items_size: 'small',\r\n                extended_valid_elements : \"iframe[src|frameborder|style|scrolling|class|width|height|name|align|id]\",\r\n                toolbar: \"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | code | mysidebar\",\r\n            }\r\n        };\r\n\r\n        function RichText(element,options) {\r\n            _ref = RichText.__super__.constructor.apply(this, arguments);\r\n            return _ref;\r\n        }\r\n\r\n\r\n        RichText.prototype.pluginInit = function() {\r\n            var annotator = this.annotator,\r\n                editor = this.annotator.editor;\r\n            //Check that annotator is working\r\n            if (!Annotator.supported()) {\r\n                return;\r\n            }\r\n\r\n            //Editor Setup\r\n            annotator.editor.addField({\r\n                type: 'input',\r\n                load: this.updateEditor,\r\n            });\r\n\r\n            //Viewer setup\r\n            annotator.viewer.addField({\r\n                load: this.updateViewer,\r\n            });\r\n\r\n\r\n            annotator.subscribe(\"annotationEditorShown\", function(){\r\n                // $(annotator.editor.element).find('.mce-tinymce')[0].style.display='block';\r\n                // $(annotator.editor.element).find('.mce-container').css('z-index',3000000000);\r\n                // annotator.editor.checkOrientation();\r\n            });\r\n            annotator.subscribe(\"annotationEditorHidden\", function(){\r\n                // $(annotator.editor.element).find('.mce-tinymce')[0].style.display='none';\r\n                // $(annotator.editor.element).find(\"#annoSide\").remove();\r\n            });\r\n\r\n            //set listener for tinymce;\r\n            this.options.tinymce.setup = function(ed) {\r\n                RichText.prototype.mceditor = ed\r\n                ed.on('change', function(e) {\r\n                    //set the modification in the textarea of annotator\r\n                    $(editor.element).find('textarea')[0].value = tinymce.activeEditor.getContent();\r\n                });\r\n                ed.on('Init', function(ed){\r\n                    $('.mce-container').css('z-index','3090000000000000000');\r\n\r\n                });\r\n                ed.on('remove', function(){\r\n                    ReactDOM.unmountComponentAtNode(RichText.prototype.scaffoldSidebar)\r\n                })\r\n                ed.ui.registry.addSidebar('mysidebar', {\r\n                    tooltip: 'View Scaffold',\r\n                    icon: 'settings',\r\n                    onSetup: function (api) {\r\n                        const sidebar = api.element()\r\n                        document.sidebar = sidebar\r\n                        sidebar.style.width = \"200px\"\r\n                        sidebar.style.overflow = \"scroll\"\r\n                        sidebar.style.fontSize = \"0.7rem\"\r\n                        ReactDOM.render(scaffoldElement, sidebar, null)\r\n                        RichText.prototype.scaffoldSidebar = sidebar\r\n                    },\r\n                    onShow: function (api) {\r\n                        // var str = \"\\\"\\'components/kfutils/scaffold/scaffold.html\\'\\\"\";\r\n                        // api.element().innerHTML = \"<div id='annoSide'><div ng-include=\"+str+\"></div></div>\";\r\n                        // var scope = angular.element(document.getElementById(\"scaffoldContainer\")).scope();\r\n                        // scope.$apply(function () {\r\n                        //     scope.annotatorScaffoldInit(editorId);\r\n                        // });\r\n                    },\r\n                    onHide: function (api) {\r\n                        // api.element().innerHTML = \"\";\r\n                        // var scope = angular.element(document.getElementById(\"scaffoldContainer\")).scope();\r\n                        // scope.$apply(function () {\r\n                        //     scope.annotatorScaffoldClose();\r\n                        // });\r\n                        //console.log('Hide panel', api.element());\r\n                    }\r\n                });\r\n\r\n            };\r\n            tinymce.init(this.options.tinymce);\r\n        };\r\n\r\n        RichText.prototype.updateEditor = function(field, annotation) {\r\n            var text = typeof annotation.text!=='undefined'?annotation.text:'';\r\n            var count = tinymce.editors.length;\r\n            editorId = tinymce.editors[count-2].id;\r\n            tinymce.get(editorId).setContent(text);\r\n            //tinymce.activeEditor.setContent(text);\r\n            $(field).remove(); //this is the auto create field by annotator and it is not necessary\r\n        };\r\n\r\n        RichText.prototype.updateViewer = function(field, annotation) {\r\n            var textDiv = $(field.parentNode).find('div:first-of-type')[0];\r\n            textDiv.innerHTML =annotation.text;\r\n            $(textDiv).addClass('richText-annotation');\r\n            $(field).remove(); //this is the auto create field by annotator and it is not necessary\r\n        };\r\n\r\n        return RichText;\r\n\r\n    })(Annotator.Plugin);\r\n\r\n            /* jshint ignore:end */\r\n\r\n\r\n            //----------------------------Rich Text Annotator Plugin: END -----------------------------\r\n\r\n    elem.annotator('addPlugin', 'KFPlugin');\r\n    elem.annotator('addPlugin', 'Tags');\r\n    elem.annotator('addPlugin', 'RichText');\r\n\r\n    if (uname) {\r\n        elem.annotator('addPlugin', 'Permissions', {\r\n            user: uname,\r\n            permissions: {\r\n                read: [uname],\r\n                update: [uname],\r\n                delete: [uname],\r\n                admin: [uname]\r\n            },\r\n            showEditPermissionsCheckbox: false\r\n        });\r\n    }\r\n}\r\n\r\nexport const vm2m = (anno) => {\r\n    const isPublic = anno.permissions.read.length === 0;\r\n    if (isPublic) {\r\n        anno.permission = 'protected';\r\n    } else {\r\n        anno.permission = 'private';\r\n    }\r\n    const loc = anno.ranges[0];\r\n    if (loc.start.indexOf('/div[1]') === 0) {\r\n        loc.start = loc.start.substring(7);\r\n    }\r\n    if (loc.end.indexOf('/div[1]') === 0) {\r\n        loc.end = loc.end.substring(7);\r\n    }\r\n    return anno;\r\n};\r\n\r\nexport const m2vm = (anno) => {\r\n    const loc = Object.assign({}, anno.ranges[0]);\r\n    loc.start = '/div[1]' + loc.start;\r\n    loc.end = '/div[1]' + loc.end;\r\n    anno.ranges[0] = loc\r\n    return anno;\r\n};\r\n","import { configureStore } from '@reduxjs/toolkit';\r\nimport { globalsReducer } from './globalsReducer.js'\r\nimport { dialogReducer } from './dialogReducer.js'\r\nimport { noteReducer } from './noteReducer.js'\r\nimport { scaffoldReducer } from './scaffoldReducer.js'\r\nimport { userReducer } from './userReducer.js'\r\n\r\nexport default configureStore({\r\n  reducer: {\r\n      dialogs: dialogReducer,\r\n      notes: noteReducer,\r\n      scaffolds: scaffoldReducer,\r\n      globals: globalsReducer,\r\n      users: userReducer\r\n  },\r\n    devTools: true\r\n});\r\n","import React from 'react';\r\nimport ScaffoldSelect from '../scaffold/ScaffoldSelect'\r\nimport * as annotPlugins from './annotator.service'\r\nimport './annotator.css'\r\nimport store from '../../store/store';\r\nimport { Provider } from 'react-redux';\r\n/*global $*/\r\nclass Annotator extends React.Component {\r\n\r\n    constructor(props) {\r\n        super(props)\r\n        this.contentRef = React.createRef();\r\n        this.annotatorInitialized = this.annotatorInitialized.bind(this)\r\n        this.annotationCreated = this.annotationCreated.bind(this)\r\n        this.annotationUpdated = this.annotationUpdated.bind(this)\r\n        this.annotator = null\r\n\r\n        this.displayEditor = this.displayEditor.bind(this)\r\n        this.displayViewer = this.displayViewer.bind(this)\r\n        this.fixPopupLocation = this.fixPopupLocation.bind(this)\r\n        this.editorHidden = this.editorHidden.bind(this)\r\n        this.loadAnnotations = this.loadAnnotations.bind(this)\r\n        this.onScaffoldSelected = this.onScaffoldSelected.bind(this)\r\n        this.dlg = null\r\n    }\r\n\r\n    componentDidMount() {\r\n        const annotatedElem = $(this.contentRef.current)\r\n        annotatedElem.annotator()\r\n        this.scaffoldElem = (\r\n            <Provider store={store}>\r\n                <ScaffoldSelect initVal={0} onScaffoldSelected={this.onScaffoldSelected}/>\r\n            </Provider>)\r\n\r\n        annotPlugins.setKFPlugin(annotatedElem, {\r\n            annotationCreated: this.annotationCreated,\r\n            annotationUpdated: this.annotationUpdated,\r\n            annotationDeleted: this.props.onDelete,\r\n            displayEditor: this.displayEditor,\r\n            displayViewer: this.displayViewer,\r\n            annotatorInitialized: this.annotatorInitialized,\r\n            editorHidden: this.editorHidden\r\n        }, this.props.author.userName, this.scaffoldElem)\r\n        this.dlg = $(`#contrib-dialog-${this.props.containerId}`)\r\n\r\n    }\r\n\r\n    componentDidUpdate(prevProps, prevState) {\r\n        if (this.props.annotsFetched === 1 && this.props.annotsFetched !== prevProps.annotsFetched) {\r\n            this.loadAnnotations()\r\n        }\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        //Need to remove editor when closing dialog\r\n        if (this.annotator && this.annotator.plugins.RichText.mceditor)\r\n            this.annotator.plugins.RichText.mceditor.remove()\r\n    }\r\n    editorHidden(editor, annotation){\r\n        $(editor.element.find(\".annotator-controls\")).off()\r\n    }\r\n    loadAnnotations(){\r\n        const annotations = Object.values(this.props.annots).map((annot) => {\r\n            const anno = Object.assign({}, annot.data)\r\n            anno.ranges = [...anno.ranges]\r\n            anno.highlights = [...anno.highlights]\r\n            annotPlugins.m2vm(anno)\r\n            return anno\r\n        })\r\n        this.annotator.loadAnnotations(annotations)\r\n        this.props.onAnnotsLoaded()\r\n    }\r\n    annotatorInitialized(annotator){\r\n        this.annotator = annotator\r\n        this.loadAnnotations()\r\n\r\n        var $element = $('div.annotator-adder');\r\n        $element.attr('title', 'Annotation');\r\n        $element.addClass('tooltip1');\r\n        $element.append('<span class=\"tooltiptext\">Annotation</span>');\r\n\r\n        document.annotator = this.annotator\r\n        const adder = annotator.adder.get(0)\r\n        this.observer = new MutationObserver(function(mutationsList){\r\n            for(let mutation of mutationsList) {\r\n                if (mutation.type === 'attributes') {\r\n                    //mutation.oldValue.startsWith(\"display: none\") &&\r\n                    if( adder.style.display !== 'none'){\r\n                        this.fixPopupLocation(annotator.adder)\r\n                        this.observer.takeRecords()\r\n                        return\r\n                    }\r\n                }\r\n            }\r\n        }.bind(this));\r\n        //TODO disconnect? when?\r\n        this.observer.observe(adder, { attributes: true, attributeOldValue: true });\r\n    }\r\n    annotationCreated(annotation){\r\n        this.props.onCreate(annotPlugins.vm2m(annotation))\r\n    }\r\n    annotationUpdated(annotation){\r\n        this.props.onUpdate(annotPlugins.vm2m(annotation))\r\n    }\r\n    displayEditor(editor, annotation){\r\n        /* $(editor.element.find(\".annotator-controls\")).off()*/\r\n        if (!editor.element.hasClass(editor.classes.invert.y)) {\r\n            editor.element.addClass(editor.classes.invert.y);\r\n        }\r\n    }\r\n    fixPopupLocation(popup){\r\n        const dlgOffset = this.dlg.offset()\r\n        const ppOffset = popup.offset()\r\n        popup.offset({top: ppOffset.top - dlgOffset.top, left: ppOffset.left - dlgOffset.left})\r\n    }\r\n    displayViewer(viewer, annotation){\r\n        this.fixPopupLocation(viewer.element)\r\n        viewer.element.addClass(viewer.classes.invert.y);\r\n    }\r\n\r\n    onScaffoldSelected(tagCreator, initialText) {\r\n        const mceditor = this.annotator.plugins.RichText.mceditor\r\n        const selected = mceditor.selection.getContent();\r\n        let text = selected.length ? selected : initialText;\r\n        const {tag, supportContentId} = tagCreator(text);\r\n        mceditor.insertContent(tag)\r\n        //select text after insert\r\n        const contentTag = mceditor.dom.get(supportContentId);\r\n        if (contentTag)\r\n            mceditor.selection.setCursorLocation(contentTag)\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div ref={this.contentRef}>\r\n                <div dangerouslySetInnerHTML={{__html: this.props.content}}>\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n\r\n}\r\n\r\nexport default Annotator\r\n","import React from 'react';\r\nimport { Tabs, Tab, Col, Row, Button } from 'react-bootstrap';\r\nimport WriteTab from '../writeTab/WriteTab'\r\nimport History from '../historyTab/History'\r\nimport Properties from '../propertiesTab/Properties'\r\nimport AuthorTab from '../authorsTab/AuthorTab'\r\nimport Annotator from '../annotator/Annotator'\r\nimport GraphView from '../CommunityView/GraphView/GraphView.jsx'\r\nimport { connect } from 'react-redux'\r\nimport {\r\n    setAnnotationsLoaded,\r\n    fetchAttachments, fetchRecords,\r\n    createAnnotation, deleteAnnotation, modifyAnnotation, deleteAttachment, openContribution\r\n} from '../../store/noteReducer.js'\r\nimport { scaffoldWordCount } from '../../store/kftag.service.js'\r\nimport { dateFormatOptions, fetchCommGroups } from '../../store/globalsReducer.js'\r\nimport './Note.css'\r\n\r\nclass Note extends React.Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            riseAboveNotes: false,\r\n            selectedTab: this.props.mode ? this.props.mode : \"write\",\r\n        }\r\n        this.onEditorSetup = this.onEditorSetup.bind(this)\r\n        this.addDrawing = this.addDrawing.bind(this)\r\n        this.onNoteChange = this.onNoteChange.bind(this)\r\n        this.wordCount = this.wordCount.bind(this)\r\n        this.onTabSelected = this.onTabSelected.bind(this)\r\n        this.onAnnotationCreated = this.onAnnotationCreated.bind(this)\r\n        this.onAnnotationDeleted = this.onAnnotationDeleted.bind(this)\r\n        this.onAnnotationUpdated = this.onAnnotationUpdated.bind(this)\r\n    }\r\n\r\n    componentDidUpdate(prevProps, prevState, snapshot) {\r\n        if (this.props.drawing && prevProps.drawing !== this.props.drawing) {\r\n            this.editor.insertContent(this.props.drawing)\r\n            this.props.onDrawingInserted()\r\n        }\r\n    }\r\n\r\n    onNoteChange(note) {\r\n        if (note.scaffold) {\r\n            const { tagCreator, initialText } = note.scaffold;\r\n            this.addSupport(true, initialText, tagCreator)\r\n        } else if (note.attach) {\r\n            this.editor.insertContent(note.attach)\r\n        } else if (note.deleteAttach) {\r\n            this.props.deleteAttachment(this.props.note._id, note.deleteAttach)\r\n            this.editor.dom.remove(this.editor.dom.select('.' + note.deleteAttach))\r\n        }\r\n        else {\r\n            if (note.data && note.data.body){\r\n                this.props.onNoteChange({ ...note, wordCount: this.wordCount(note.data.body) })\r\n            }else{\r\n                this.props.onNoteChange({ ...note })\r\n            }\r\n        }\r\n    }\r\n\r\n    wordCount(text) {\r\n        return this.editor.plugins.wordcount.getCount() - scaffoldWordCount(text);\r\n    }\r\n\r\n    onEditorSetup(editor) {\r\n        editor.onDrawButton = this.props.onDrawToolOpen;\r\n        this.editor = editor;\r\n    }\r\n\r\n    addDrawing(drawing) {\r\n        // Add draw to editor\r\n        this.editor.insertContent(drawing);\r\n    }\r\n\r\n    addSupport(selection, initialText, tagCreator) {\r\n        const selected = this.editor.selection.getContent();\r\n        let text = selected.length ? selected : initialText;\r\n        const { tag, supportContentId } = tagCreator(text);\r\n        this.editor.insertContent(tag)\r\n        //select text after insert\r\n        if (selection) {\r\n            const contentTag = this.editor.dom.get(supportContentId);\r\n            if (contentTag)\r\n                this.editor.selection.setCursorLocation(contentTag)\r\n        }\r\n    }\r\n\r\n    onTabSelected(tab) {\r\n        this.setState({selectedTab: tab })\r\n        if (tab === 'history') { //Refresh records\r\n            this.props.fetchRecords(this.props.note._id)\r\n        } if (tab === 'author') { //Refresh groups, and authors?\r\n            this.props.fetchCommGroups(this.props.note.communityId)\r\n        }\r\n    }\r\n\r\n    onAnnotationCreated(annotation) {\r\n        console.log(annotation)\r\n        this.props.createAnnotation(this.props.note.communityId, this.props.note._id, this.props.noteAuthor._id, annotation)\r\n    }\r\n\r\n    onAnnotationDeleted(annotation) {\r\n        if (annotation.linkId && annotation.modelId) {\r\n            this.props.deleteAnnotation(annotation.linkId, this.props.note._id, annotation.modelId);\r\n        }\r\n    }\r\n\r\n    onAnnotationUpdated(annotation) {\r\n        if (!annotation.linkId || !annotation.modelId) {\r\n            console.error('ERROR! annoVM doesn\\'t have id on update');\r\n            return;\r\n        }\r\n        const model = Object.assign({}, this.props.note.annos[annotation.modelId])\r\n        if (!model) {\r\n            console.error('ERROR! model couldn\\'t find');\r\n            return;\r\n        }\r\n        model.data = annotation;\r\n        this.props.modifyAnnotation(model, this.props.note.communityId, this.props.note._id)\r\n    }\r\n\r\n    render() {\r\n        const formatter = new Intl.DateTimeFormat('default', dateFormatOptions)\r\n        return (\r\n            <div>\r\n                <div className='contrib-info'>\r\n                    Created By: {this.props.noteAuthor.firstName} {this.props.noteAuthor.lastName} <br />\r\n                    Last modified: {formatter.format(new Date(this.props.note.modified))}\r\n                </div>\r\n                <Tabs activeKey={this.state.selectedTab} onSelect={this.onTabSelected}>\r\n                    <Tab eventKey=\"read\" title=\"read\" mountOnEnter style={{height: '100%'}}>\r\n                        <Row style={{height: '100%'}}>\r\n                                <Col>\r\n                                    <Annotator containerId={this.props.dlgId}\r\n                                        content={this.props.note.data.body}\r\n                                        annots={this.props.note.annos}\r\n                                        annotsFetched={this.props.note.annotsFetched}\r\n                                        author={this.props.noteAuthor}\r\n                                        onCreate={this.onAnnotationCreated}\r\n                                        onUpdate={this.onAnnotationUpdated}\r\n                                        onDelete={this.onAnnotationDeleted}\r\n                                        onAnnotsLoaded={() => this.props.setAnnotationsLoaded({ contribId: this.props.note._id, value: 0 })}\r\n                                    >\r\n                                    </Annotator>\r\n                                </Col>\r\n\r\n                                {this.props.note.data.riseabove && this.props.raViewLinks && this.props.raReadLinks ?\r\n                                 <Col className=\"border border-primary border-4 note-ra-col\">\r\n                                     <Row>\r\n                                         <div className=\"note-ra-text\">Riseabove View:\r\n                                             <Button className=\"sm-button\" variant=\"primary\" href={`/view/${this.props.note.data.riseabove.viewId}`} target=\"_blank\">Open in Window</Button>\r\n                                         </div>\r\n                                     </Row>\r\n                                     <Row className=\"note-ra-rowgraph\">\r\n                                         <GraphView\r\n                                             viewId={this.props.note.data.riseabove.viewId}\r\n                                             viewLinks={this.props.raViewLinks}\r\n                                             readLinks={this.props.raReadLinks}\r\n                                             onNoteClick={(noteId)=>this.props.openContribution(noteId, \"write\")}\r\n                                             onViewClick={(viewId)=> {window.open(`/view/${viewId}`, '_blank')}}\r\n                                         />\r\n                                     </Row>\r\n                                 </Col> : ''\r\n                                }\r\n                        </Row>\r\n                    </Tab>\r\n                    {\r\n                        this.props.mode !== \"read\" ?\r\n\r\n                        <Tab eventKey=\"write\" title=\"write\">\r\n                            <WriteTab\r\n                                note={this.props.note}\r\n                                onScaffoldSelected={this.scaffoldSelected}\r\n                                onChange={this.onNoteChange}\r\n                                onEditorSetup={this.onEditorSetup}\r\n                            ></WriteTab>\r\n                        </Tab>\r\n                        :\r\n                        ''\r\n                    }\r\n                    {this.props.isDemo ? null : (\r\n                      <Tab eventKey=\"author\" title=\"author(s)\">\r\n                          <AuthorTab contrib={this.props.note} onChange={this.onNoteChange} />\r\n                      </Tab>\r\n                    )}\r\n                    <Tab eventKey='history' title='history'><History records={this.props.note.records} /></Tab>\r\n                    {this.props.isDemo ? null : (\r\n                      <Tab eventKey='properties' title='properties'><Properties contribution={this.props.note} onChange={this.props.onNoteChange} /></Tab>\r\n                    )}\r\n\r\n                </Tabs>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nconst mapStateToProps = (state, ownProps) => {\r\n    return {\r\n        isDemo: state.globals.isDemo,\r\n        noteAuthor: ownProps.note && (state.users[ownProps.note.authors[0]] || 'NA'),\r\n        currentAuthor: state.globals.author,\r\n        editable: false || (ownProps.note && ownProps.note.authors.includes(state.globals.author._id)),\r\n        raViewLinks: ownProps.note?.data?.riseabove && state.notes.raViews[ownProps.note.data.riseabove.viewId]?.viewLinks,\r\n        raReadLinks: ownProps.note?.data?.riseabove && state.notes.raViews[ownProps.note.data.riseabove.viewId]?.readLinks,\r\n    }\r\n}\r\n\r\nconst mapDispatchToProps = {\r\n    fetchAttachments, fetchRecords,\r\n    deleteAnnotation, fetchCommGroups, createAnnotation, modifyAnnotation,\r\n    setAnnotationsLoaded, deleteAttachment, openContribution}\r\n\r\nexport default connect(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(Note)\r\n","import React, {useEffect, useState} from 'react'\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport Dialog from './Dialog.js'\r\nimport DrawTool from '../drawDialog/DrawTool.js'\r\nimport Note from '../note/Note.js'\r\nimport {removeNote, postContribution, buildOnNote} from '../../store/noteReducer.js'\r\nimport {closeDialog } from '../../store/dialogReducer.js'\r\n\r\nconst NoteDialog = props => {\r\n\r\n    const dialog = props.dialog\r\n    const reduxNote = useSelector(state => state.notes[dialog.contribId])\r\n    const dispatch = useDispatch();\r\n    const [note, setNote] = useState(null);//make copy of note from redux\r\n    const [drawTool, setDrawTool] = useState(false);\r\n    const [svg, setSvg] = useState(null);\r\n    const [drawing, setDrawing] = useState(null);\r\n\r\n    useEffect(()=>{\r\n        setNote(prevNote => {\r\n            if (prevNote === null) //Initialize once\r\n                return {...reduxNote}\r\n            else //Only update attachmets and records\r\n                return {...prevNote, attachments: reduxNote.attachments, records: reduxNote.records }\r\n        })\r\n    }, [reduxNote])\r\n\r\n\r\n    const onDialogClose = (dlg) => {\r\n        dispatch(closeDialog(dlg.id));\r\n        dispatch(removeNote(dlg.contribId));\r\n    }\r\n\r\n    const onDialogConfirm = () => {\r\n        dispatch(postContribution(note, dialog.id));\r\n    }\r\n\r\n    const onBuildOnClick = (noteId) => {\r\n        dispatch(buildOnNote(noteId));\r\n    }\r\n\r\n    const onNoteChange = (noteChanged) => {\r\n        setNote(prevNote => {\r\n            const newNote = {...prevNote, ...noteChanged}\r\n            newNote.data = { ...prevNote.data, ...noteChanged.data}\r\n            return newNote\r\n        })\r\n    }\r\n\r\n    const openDrawDialog = (svg) => {\r\n        if (svg) {\r\n            setSvg(svg)\r\n        }\r\n        setDrawTool(true)\r\n    }\r\n\r\n    const closeDrawDialog = () => {\r\n        setSvg(null)\r\n        setDrawTool(false);\r\n    }\r\n\r\n    const onDrawingInserted = () => { setDrawing(null)}\r\n\r\n    const onConfirmDrawDialog = (drawing) => {\r\n        setDrawing(drawing)\r\n        closeDrawDialog()\r\n    }\r\n\r\n    return (\r\n        <div>\r\n            <Dialog key={dialog.id}\r\n                    id={dialog.id}\r\n                    onMouseDown={props.onMouseDown}\r\n                    title={dialog.title}\r\n                    style={{zIndex: dialog.zIndex}}\r\n                    onClose={()=>onDialogClose(dialog)}\r\n                    onConfirm={()=> onDialogConfirm(dialog)}\r\n                    confirmButton={dialog.confirmButton}\r\n                    editable={dialog.editable}\r\n                    buildon={dialog.buildOn}\r\n                    onBuildOnClick={()=>onBuildOnClick(dialog.contribId)}\r\n            >\r\n                {note ?\r\n                 <Note\r\n                     key={dialog.contribId}\r\n                     dlgId={dialog.id}\r\n                     note={note}\r\n                     mode={dialog.editable? \"write\": \"read\"}\r\n                     drawing={drawing}\r\n                     onNoteChange={onNoteChange}\r\n                     onDrawToolOpen={openDrawDialog}\r\n                     onDrawingInserted={onDrawingInserted}\r\n                 />\r\n                : null}\r\n\r\n            </Dialog>\r\n            { drawTool ?\r\n             <DrawTool onClose={closeDrawDialog}\r\n                         onConfirm={onConfirmDrawDialog}\r\n                         svg={svg}\r\n             /> : null}\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default NoteDialog;\r\n","import React, {useState} from 'react';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport History from '../historyTab/History'\r\nimport Properties from '../propertiesTab/Properties'\r\nimport AuthorTab from '../authorsTab/AuthorTab'\r\nimport { Tabs, Tab, Row, Col, Form } from 'react-bootstrap';\r\nimport { dateFormatOptions, fetchCommGroups } from '../../store/globalsReducer.js'\r\nimport {fetchRecords} from '../../store/noteReducer.js'\r\nimport {url as serverUrl} from '../../store/api'\r\n\r\nconst Attachment = (props) => {\r\n    const formatter = new Intl.DateTimeFormat('default', dateFormatOptions)\r\n    const timestamp = formatter.format(new Date(props.attachment.modified))\r\n    const attachAuthor = useSelector(state => state.users[props.attachment.authors[0]] || 'NA')\r\n    const dispatch = useDispatch();\r\n    const [selectedTab, setSelectedTab] = useState(\"read\");\r\n    const onTabSelected = (tab) => {\r\n        setSelectedTab(tab)\r\n        if (tab === 'history') { //Refresh records\r\n            dispatch(fetchRecords(props.attachment._id))\r\n        } if (tab === 'author') { //Refresh groups, and authors?\r\n            dispatch(fetchCommGroups(props.attachment.communityId))\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div>\r\n            <div className='contrib-info'>\r\n                Created By: {attachAuthor.firstName} {attachAuthor.lastName} <br />\r\n                Last modified: {timestamp}\r\n            </div>\r\n            <Tabs activeKey={selectedTab} transition={false} onSelect={onTabSelected}>\r\n                <Tab style={{height: '100%'}} eventKey=\"read\" title=\"read\">\r\n\r\n                    <a href={`${serverUrl}${(props.attachment.data.url)}`} title={props.attachment.title} download>\r\n                        { props.attachment.data.url }\r\n                    </a>\r\n                    { props.attachment.data.type === 'application/pdf' ?\r\n                    <object data={`${serverUrl}${(props.attachment.data.url)}`} type=\"application/pdf\" width=\"100%\" height=\"100%\">\r\n\r\n                    </object> : ''}\r\n\r\n                </Tab>\r\n\r\n                {\r\n                    props.mode !== \"read\" ?\r\n                    <Tab eventKey=\"write\" title=\"write\">\r\n                        <Row>\r\n                            <Col>\r\n                                <Form.Group className=\"write-title-form\" controlId=\"note-title\">\r\n                                    <Form.Control type=\"text\"\r\n                                                  className=\"write-tab-input\"\r\n                                                  size=\"sm\"\r\n                                                  placeholder=\"Enter title\"\r\n                                                  value={props.attachment.title}\r\n                                                  onChange={(val) => {props.onChange({title: val.target.value})}}/>\r\n                                </Form.Group>\r\n                            </Col>\r\n                        </Row>\r\n                    </Tab>\r\n                    :\r\n                    ''\r\n                }\r\n\r\n                <Tab eventKey=\"author\" title=\"author(s)\">\r\n                    <AuthorTab contrib={props.attachment} onChange={props.onChange} />\r\n                </Tab>\r\n                <Tab eventKey='history' title='history'><History records={props.attachment.records} /></Tab>\r\n                <Tab eventKey='properties' title='properties'><Properties contribution={props.attachment} onChange={props.onChange} /></Tab>\r\n            </Tabs>\r\n        </div>\r\n\r\n    )\r\n}\r\n\r\nexport default Attachment\r\n","import React from 'react'\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport Dialog from './Dialog.js'\r\nimport Attachment from '../attachment/Attachment.js'\r\nimport {removeNote, postContribution, buildOnNote, editNote} from '../../store/noteReducer.js'\r\nimport {closeDialog } from '../../store/dialogReducer.js'\r\n\r\nconst AttachmentDialog = props => {\r\n\r\n    const dialog = props.dialog\r\n    const attachment = useSelector(state => state.notes[dialog.contribId])\r\n    const dispatch = useDispatch();\r\n\r\n\r\n    const onDialogClose = (dlg) => {\r\n        dispatch(closeDialog(dlg.id));\r\n        dispatch(removeNote(dlg.noteId));\r\n    }\r\n\r\n    const onDialogConfirm = () => {\r\n        dispatch(postContribution(attachment, dialog.id));\r\n    }\r\n\r\n    const onBuildOnClick = (noteId) => {\r\n        dispatch(buildOnNote(noteId));\r\n    }\r\n\r\n    const onChange = (attachmentChanged) => {\r\n        dispatch(editNote({\"_id\": attachment._id, ...attachmentChanged}));\r\n    }\r\n\r\n    return (\r\n        <div>\r\n            <Dialog key={dialog.id}\r\n                    id={dialog.id}\r\n                    onMouseDown={props.onMouseDown}\r\n                    title={dialog.title}\r\n                    style={{zIndex: dialog.zIndex}}\r\n                    onClose={()=>onDialogClose(dialog)}\r\n                    onConfirm={()=> onDialogConfirm(dialog)}\r\n                    confirmButton={dialog.confirmButton}\r\n                    editable={dialog.editable}\r\n                    buildon={dialog.buildOn}\r\n                    onBuildOnClick={()=>onBuildOnClick(dialog.contribId)}\r\n            >\r\n                {attachment ?\r\n                 <Attachment\r\n                     key={dialog.contribId}\r\n                     dlgId={dialog.id}\r\n                     attachment={attachment}\r\n                     mode={dialog.editable? \"write\": \"read\"}\r\n                     onChange={onChange}\r\n                 />\r\n                : null}\r\n\r\n            </Dialog>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default AttachmentDialog;\r\n","import React, {useState} from 'react';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport Dialog from '../dialog/Dialog.js'\r\nimport History from '../historyTab/History'\r\nimport Properties from '../propertiesTab/Properties'\r\nimport AuthorTab from '../authorsTab/AuthorTab'\r\nimport { Tabs, Tab, Row, Col, Form } from 'react-bootstrap';\r\nimport {closeDialog } from '../../store/dialogReducer.js'\r\nimport {removeNote, postContribution, buildOnNote, editNote, fetchRecords} from '../../store/noteReducer.js'\r\nimport { dateFormatOptions, fetchCommGroups } from '../../store/globalsReducer.js'\r\nconst DrawDialog = props => {\r\n    const formatter = new Intl.DateTimeFormat('default', dateFormatOptions)\r\n    const dialog = props.dialog\r\n    const drawing = useSelector(state => state.notes[dialog.contribId])\r\n    const drawingAuthor = useSelector(state => state.users[drawing.authors[0]] || 'NA')\r\n    const timestamp = formatter.format(new Date(drawing.modified))\r\n    let iframe_ref;\r\n    const dispatch = useDispatch();\r\n\r\n    const [selectedTab, setSelectedTab] = useState(\"write\");\r\n\r\n    const onTabSelected = (tab) => {\r\n        setSelectedTab(tab)\r\n        if (tab === 'history') { //Refresh records\r\n            dispatch(fetchRecords(drawing._id))\r\n        } if (tab === 'author') { //Refresh groups, and authors?\r\n            dispatch(fetchCommGroups(drawing.communityId))\r\n        }\r\n    }\r\n\r\n    const onDialogConfirm = () => {\r\n        const wnd = iframe_ref.contentWindow;\r\n        wnd.svgCanvas.setResolution('fit', 100);\r\n        const bg = wnd.svgCanvas.current_drawing_.all_layers[0];\r\n        const point = wnd.svgCanvas.current_drawing_.all_layers[1];\r\n\r\n        const widd = point[1].getBBox().width;\r\n        const heig = point[1].getBBox().height;\r\n        if (widd === 0 || heig === 0){\r\n            onDialogClose()\r\n            return;\r\n        }\r\n        const rec = bg[1].children[1];\r\n        if (rec.attributes.fill.value === 'none'){\r\n            const po = wnd.svgCanvas.current_drawing_.all_layers[1];\r\n            if (po[1].childNodes.length > 1){\r\n                wnd.svgCanvas.current_drawing_.svgElem_.setAttribute(\"width\", widd + 2);\r\n                wnd.svgCanvas.current_drawing_.svgElem_.setAttribute(\"height\", heig + 2)\r\n                const p = wnd.svgCanvas.current_drawing_.all_layers[0];\r\n                p[1].childNodes[1].setAttribute(\"width\", widd);\r\n                p[1].childNodes[1].setAttribute(\"height\", heig);\r\n                wnd.svgCanvas.selectAllInCurrentLayer();\r\n                wnd.svgCanvas.groupSelectedElements();\r\n                wnd.svgCanvas.alignSelectedElements('l', 'page')\r\n                wnd.svgCanvas.alignSelectedElements('t', 'page')\r\n                wnd.svgCanvas.ungroupSelectedElement();\r\n                wnd.svgCanvas.clearSelection();\r\n            }\r\n        }\r\n        wnd.svgCanvas.setResolution('fit', 'fit')\r\n        const newDrawing = {...drawing}\r\n        newDrawing.data = {...newDrawing.data, svg: wnd.svgCanvas.svgCanvasToString()}\r\n        dispatch(postContribution(newDrawing, dialog.id))\r\n    }\r\n\r\n    const onDialogClose = (dlg) => {\r\n        dispatch(closeDialog(dlg.id));\r\n        dispatch(removeNote(dlg.noteId));\r\n    }\r\n\r\n    const getIframeRef = (frame) => {\r\n        if(!frame) {\r\n            return\r\n        }\r\n        iframe_ref = frame\r\n    }\r\n\r\n    const onLoad = (e) => {\r\n        console.log(\"on load draw\")\r\n        const svg = drawing.data.svg\r\n        if (svg){\r\n            e.target.contentWindow.svgCanvas.setSvgString(svg)\r\n            e.target.contentWindow.svgCanvas.setResolution('fit', 'fit')\r\n        }\r\n    }\r\n\r\n    const onChange = (drawingChanged) => {\r\n        dispatch(editNote({\"_id\": drawing._id, ...drawingChanged}));\r\n    }\r\n\r\n    const onBuildOnClick = (noteId) => {\r\n        dispatch(buildOnNote(noteId));\r\n    }\r\n\r\n    return (\r\n            <Dialog key={dialog.id}\r\n                    id={dialog.id}\r\n                    onMouseDown={props.onMouseDown}\r\n                    title={dialog.title}\r\n                    style={{zIndex: dialog.zIndex}}\r\n                    onClose={()=>onDialogClose(dialog)}\r\n                    onConfirm={()=> onDialogConfirm(dialog)}\r\n                    confirmButton={dialog.confirmButton}\r\n                    editable={dialog.editable}\r\n                    buildon={dialog.buildOn}\r\n                    onBuildOnClick={()=>onBuildOnClick(dialog.contribId)}\r\n            >\r\n                <div>\r\n                    <div className='contrib-info'>\r\n                        Created By: {drawingAuthor.firstName} {drawingAuthor.lastName} <br />\r\n                        Last modified: {timestamp}\r\n                    </div>\r\n                    <Tabs activeKey={selectedTab} transition={false} onSelect={onTabSelected}>\r\n                        <Tab eventKey=\"write\" title=\"write\" style={{height: '90%'}}>\r\n                            {drawing ?\r\n                             (<>\r\n                                 <Row>\r\n                                     <Col>\r\n                                         <Form.Group className=\"write-title-form\" controlId=\"note-title\">\r\n                                             <Form.Control type=\"text\"\r\n                                                           className=\"write-tab-input\"\r\n                                                           size=\"sm\"\r\n                                                           placeholder=\"Enter title\"\r\n                                                           value={drawing.title}\r\n                                                           onChange={(val) => {onChange({title: val.target.value})}}/>\r\n                                         </Form.Group>\r\n                                     </Col>\r\n                                 </Row>\r\n                                 <iframe onLoad={onLoad} title='DrawingTool' src='/drawing-tool/svg/index.html' ref={getIframeRef} width='100%' height='100%'></iframe>\r\n                             </>)\r\n                            :\r\n                             ''\r\n                            }\r\n                        </Tab>\r\n                        <Tab eventKey=\"author\" title=\"author(s)\">\r\n                            <AuthorTab contrib={drawing} onChange={onChange} />\r\n                        </Tab>\r\n                        <Tab eventKey='history' title='history'><History records={drawing.records} /></Tab>\r\n                        <Tab eventKey='properties' title='properties'><Properties contribution={drawing} onChange={onChange} /></Tab>\r\n                    </Tabs>\r\n                </div>\r\n\r\n            </Dialog>\r\n        )\r\n}\r\n\r\nexport default DrawDialog\r\n","import React, {useCallback} from 'react';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport {focusDialog } from '../../store/dialogReducer.js'\r\nimport NoteDialog from '../dialog/NoteDialog.js'\r\nimport AttachmentDialog from '../dialog/AttachmentDialog.js'\r\nimport DrawDialog from '../drawDialog/DrawDialog.js'\r\n\r\nconst DialogHandler = props => {\r\n    const dialogs = useSelector(state => state.dialogs);\r\n    const dispatch = useDispatch();\r\n\r\n    const onFocusDialog = useCallback(\r\n        (dlgId) => dispatch(focusDialog(dlgId)),\r\n        [dispatch]\r\n    );\r\n\r\n    return (\r\n        <div>{\r\n            dialogs.dialogs.map((elt, i) => {\r\n\r\n                if (elt.type === 'Note'){\r\n                    return (\r\n                        <NoteDialog\r\n                            key={elt.id}\r\n                            dialog={elt}\r\n                            onMouseDown={() => onFocusDialog(elt.id)}\r\n                        />\r\n                    )\r\n                } else if (elt.type === 'Attachment'){\r\n                    return (\r\n                        <AttachmentDialog\r\n                            key={elt.id}\r\n                            dialog={elt}\r\n                            onMouseDown={() => onFocusDialog(elt.id)}\r\n                        />\r\n                    )\r\n                } else if (elt.type === 'Drawing'){\r\n\r\n                    return (\r\n                        <DrawDialog\r\n                            key={elt.id}\r\n                            dialog={elt}\r\n                            onMouseDown={() => onFocusDialog(elt.id)}\r\n                        />\r\n                    )\r\n                } else {\r\n                    return ''\r\n                }\r\n            })\r\n        }\r\n\r\n        </div>\r\n    )\r\n\r\n}\r\nexport default DialogHandler;\r\n","import React, {useState} from 'react';\r\nimport { useDispatch } from 'react-redux';\r\nimport { Modal, Button, Row, Col, Form } from 'react-bootstrap';\r\nimport { newRiseAbove } from '../../store/async_actions.js'\r\n\r\nconst NewRiseAboveModal = props => {\r\n\r\n    const [title, setTitle] = useState('')\r\n    const dispatch = useDispatch();\r\n\r\n    const createRiseAbove = () => {\r\n        dispatch(newRiseAbove(title))\r\n        props.handleClose()\r\n    }\r\n\r\n\r\n    return (\r\n        <Modal show={props.show} onHide={props.handleClose}>\r\n            <Modal.Header closeButton>\r\n                <Modal.Title>New RiseAbove</Modal.Title>\r\n            </Modal.Header>\r\n            <Modal.Body>\r\n                <Row>\r\n                    <Col>\r\n                        <Form.Group className=\"ra-title-form\" controlId=\"ra-title\">\r\n                            <Form.Control type=\"text\"\r\n                                          size=\"sm\"\r\n                                          placeholder=\"Enter title\"\r\n                                          value={title}\r\n                                          onChange={(val) => {setTitle(val.target.value)}}/>\r\n                        </Form.Group>\r\n                    </Col>\r\n                </Row>\r\n            </Modal.Body>\r\n            <Modal.Footer>\r\n                <Button variant=\"secondary\" onClick={props.handleClose}>\r\n                    Cancel\r\n                </Button>\r\n                <Button variant=\"primary\" onClick={createRiseAbove}>\r\n                    Create\r\n                </Button>\r\n            </Modal.Footer>\r\n        </Modal>\r\n  );\r\n}\r\n\r\nexport default NewRiseAboveModal;\r\n","\r\nimport React, { createContext } from  'react';\r\nimport io from 'socket.io-client';\r\nimport { WS_BASE } from './config.js'\r\nimport { useDispatch } from 'react-redux';\r\nimport {setSocketStatus } from './store/globalsReducer.js'\r\nimport { removeViewLink, removeViewNote } from './store/noteReducer.js'\r\nimport { onViewLink } from './store/async_actions'\r\nimport { url } from './store/api.js'\r\nconst WebSocketContext = createContext(null)\r\n\r\nexport { WebSocketContext }\r\n\r\nexport default (({ children }) => {\r\n    let socket;\r\n    let ws;\r\n\r\n    const dispatch = useDispatch();\r\n\r\n    const emit = (model, message) => {\r\n        socket.emit(model, message);\r\n    }\r\n\r\n\r\n    const syncUpdates = (modelName) => {\r\n        /**\r\n         * Syncs item creation/updates on 'model:save'\r\n         */\r\n        socket.on(modelName + ':save', (item) => {\r\n            if (modelName === 'link' && item.type === 'contains' && item._to.status === 'active'){\r\n                dispatch(onViewLink(item));\r\n            }\r\n        });\r\n\r\n        /**\r\n         * Syncs removed items on 'model:remove'\r\n         */\r\n        socket.on(modelName + ':remove', function(item) {\r\n            if (modelName === 'link' && item._to.status === 'active'){\r\n                dispatch(removeViewLink(item));\r\n                dispatch(removeViewNote({'_id': item.to}))\r\n            }\r\n        });\r\n    };\r\n\r\n    const subscribeToView = (viewId) => {\r\n        socket.emit('subscribe', `linkfrom:${viewId}`);\r\n        socket.emit('subscribe', `noteCount:${viewId}`);\r\n    }\r\n\r\n    const unsubscribeToView = (viewId) => {\r\n        socket.emit('unsubscribe', `linkfrom:${viewId}`);\r\n        socket.emit('unsubscribe', `noteCount:${viewId}`);\r\n    }\r\n    /**\r\n     * Removes listeners for a models updates on the socket\r\n     *\r\n     * @param modelName\r\n     */\r\n    const unsyncUpdates  = (modelName) => {\r\n        socket.removeAllListeners(modelName + ':save');\r\n        socket.removeAllListeners(modelName + ':remove');\r\n    }\r\n\r\n    const openConnection = (subscribe, sync) => {\r\n        if (!socket){\r\n            socket = io.connect(\r\n                url,\r\n                {path: WS_BASE,\r\n                 log: true,\r\n                 \"close timeout\": 60\r\n                 , \"heartbeat timeout\": 60\r\n                 , \"heartbeat interval\": 20\r\n                });\r\n            socket.on('connect', ()=>{\r\n                dispatch(setSocketStatus(true));\r\n                if (subscribe){\r\n                    subscribeToView(subscribe)\r\n                }\r\n                if (sync){\r\n                    syncUpdates(sync)\r\n                }\r\n            });\r\n            socket.on('error', function (data) {\r\n                console.log(data || 'error');\r\n                socket = null;\r\n                dispatch(setSocketStatus(false));\r\n            });\r\n\r\n            socket.on('connect_failed', function (data) {\r\n                console.log(data || 'connect_failed');\r\n                socket = null;\r\n                dispatch(setSocketStatus(false));\r\n            });\r\n\r\n            socket.on('disconnect', function(data){\r\n                socket = null;\r\n                dispatch(setSocketStatus(false));\r\n            })\r\n\r\n        }else{\r\n            if (subscribe){\r\n                subscribeToView(subscribe)\r\n            }\r\n            if (sync){\r\n                syncUpdates(sync)\r\n            }\r\n        }\r\n    }\r\n\r\n    const disconnect = () => {\r\n        if (socket)\r\n            socket.disconnect();\r\n    }\r\n\r\n    ws = {\r\n        socket: socket,\r\n        openConnection: openConnection,\r\n        emit: emit,\r\n        unsyncUpdates: unsyncUpdates,\r\n        syncUpdates: syncUpdates,\r\n        subscribeToView: subscribeToView,\r\n        unsubscribeToView: unsubscribeToView,\r\n        disconnect: disconnect\r\n    }\r\n\r\n    return (\r\n        <WebSocketContext.Provider value={ws}>\r\n            {children}\r\n        </WebSocketContext.Provider>\r\n    )\r\n\r\n})\r\n","import React, { Component } from 'react';\r\nimport { connect } from 'react-redux'\r\nimport { Link } from \"react-router-dom\";\r\nimport { DropdownButton, Dropdown, Button, Row, Col, Popover, Modal, OverlayTrigger, Tooltip } from 'react-bootstrap';\r\nimport { Form, FormGroup, Label, Input } from 'reactstrap';\r\nimport Axios from 'axios';\r\nimport { apiUrl, getCommunity, putCommunity, postLink, getViews } from '../../store/api.js';\r\nimport { setViewId, fetchViewCommunityData, fetchNewViewDifference } from '../../store/globalsReducer.js'\r\nimport { setViewLinks, setBuildsOn, setReadLinks, newNote, openContribution, newDrawing } from '../../store/noteReducer.js'\r\nimport { clearAuthors } from '../../store/userReducer.js';\r\nimport TopNavBar from './TopNavbar.js';\r\nimport AttachPanel from '../attachmentCollapse/AttachPanel.js'\r\nimport GraphView from './GraphView/GraphView.jsx';\r\nimport LightView from './LightView/LightView.js';\r\nimport ViewSettingsPopover from './ViewSettingsPopover.jsx';\r\nimport '../../index.css';\r\nimport \"./View.css\";\r\nimport DialogHandler from '../dialogHandler/DialogHandler.js'\r\nimport NewRiseAboveModal from '../modals/NewRiseAboveModal.js'\r\nimport { WebSocketContext } from '../../WebSocket.js'\r\n\r\nclass View extends Component {\r\n\r\n    constructor(props){\r\n        super(props)\r\n        this.state = {\r\n            token: sessionStorage.getItem('token'),\r\n            currentView: (this.props.location !== undefined && this.props.location.state !== undefined) ? this.props.location.state.currentView : \"Enhanced\",\r\n            communityTitle: (this.props.location !== undefined && this.props.location.state !== undefined) ?\r\n                              (this.props.location.state.communityTitle)\r\n                              :\r\n                              (this.props.demoCommunityTitle !== undefined ? this.props.demoCommunityTitle : null),\r\n            layout: 'preset',\r\n            addView: '',\r\n            showModal: false,\r\n            showView: false,\r\n            showAttachPanel: false,\r\n            showRiseAboveModal: false,\r\n        }\r\n\r\n        this.clearGraphViewProps = this.clearGraphViewProps.bind(this);\r\n        this.onViewClick = this.onViewClick.bind(this);\r\n        this.handleNewViewInput = this.handleNewViewInput.bind(this);\r\n        this.handleNewViewSubmit = this.handleNewViewSubmit.bind(this);\r\n        this.newView = this.newView.bind(this);\r\n        this.handleShow = this.handleShow.bind(this);\r\n    }\r\n\r\n    componentDidMount() {\r\n        var viewId = this.props.viewId ? this.props.viewId : this.props.match.params.viewId;\r\n        this.context.openConnection(viewId, 'link');//Open websocket connection and subscribe to view\r\n        this.props.fetchViewCommunityData(viewId);\r\n    }\r\n\r\n    componentDidUpdate(prevProps, prevState) {\r\n        if(this.props.viewId && this.props.viewId !== prevProps.viewId) {\r\n            this.props.fetchNewViewDifference(this.props.viewId);\r\n            if (this.props.socketStatus && prevProps.viewId){//If changing view and socket connection\r\n                this.context.unsubscribeToView(prevProps.viewId);\r\n                this.context.subscribeToView(this.props.viewId);\r\n            }\r\n        }\r\n    }\r\n\r\n    componentWillUnmount(){\r\n        if (this.props.socketStatus){\r\n            this.context.unsyncUpdates('link');\r\n            this.context.unsubscribeToView(this.props.viewId);\r\n            this.context.disconnect();\r\n        }\r\n    }\r\n\r\n    clearGraphViewProps(){\r\n      this.props.setViewLinks([]);\r\n      this.props.setBuildsOn([]);\r\n      this.props.setReadLinks([]);\r\n      this.props.clearAuthors([]);\r\n    }\r\n\r\n    onViewClick(viewId){\r\n        this.handleShow(false);\r\n        this.props.setViewId(viewId);\r\n        if(this.props.isDemo === false){\r\n          this.props.history.push({\r\n            pathname: `/view/${viewId}`,\r\n            state: { currentView: this.state.currentView, communityTitle: this.state.communityTitle }\r\n          });\r\n        }\r\n    }\r\n\r\n    newView() {\r\n        this.setState({\r\n            showView: true,\r\n            showModel: true,\r\n        })\r\n    }\r\n\r\n    // SET VALUES\r\n    handleNewViewInput = (e) => {\r\n        let target = e.target;\r\n        let name = target.name;\r\n        let value = target.value;\r\n\r\n        this.setState({\r\n            [name]: value\r\n        });\r\n    }\r\n\r\n    handleNewViewSubmit(e) {\r\n        e.preventDefault();\r\n        var config = {\r\n            headers: { Authorization: `Bearer ${this.state.token}` }\r\n        };\r\n\r\n        var addViewUrl = `${apiUrl}/contributions/${this.props.communityId}`;\r\n\r\n        var query = {\r\n            \"authors\": [this.props.author._id],\r\n            \"communityId\": this.props.communityId,\r\n            \"permission\": \"public\",\r\n            \"status\": \"active\",\r\n            \"title\": this.state.addView,\r\n            \"type\": \"View\"\r\n        }\r\n        Axios.post(addViewUrl, query, config)\r\n            .then(result => {\r\n                //get new view Id\r\n                let newViewId = result.data._id\r\n                getCommunity(this.props.communityId).then(data => {\r\n                    data.data.views.push(newViewId)\r\n                    putCommunity(data.data, this.props.communityId).then(obj => {\r\n                        getViews(this.props.communityId).then(viewsObj => {\r\n                            let pos = {\r\n                                x: 1000,\r\n                                y: 1000\r\n                            }\r\n                            postLink(this.props.viewId, newViewId, 'contains', pos).then(linkObj => {\r\n                                alert(\"View Added\")\r\n                                window.location.reload(false);\r\n                            })\r\n                        })\r\n                    })\r\n                }).catch(error => {\r\n                    console.log(error);\r\n                })\r\n            }\r\n            ).catch(\r\n                error => {\r\n                    console.log(error);\r\n\r\n                }\r\n            );\r\n    }\r\n\r\n    handleShow(value) {\r\n        this.setState({\r\n            showModel: value,\r\n        });\r\n    }\r\n\r\n    goToDashboard = () => {\r\n        this.clearGraphViewProps();\r\n        this.props.history.push(\"/dashboard\");\r\n    }\r\n\r\n    switchView = () => {\r\n      var nextView = this.state.currentView === \"Enhanced\" ? \"Light\" : \"Enhanced\";\r\n      this.setState({ currentView: nextView });\r\n    }\r\n\r\n    renderTooltip = (props) => (\r\n        <Tooltip id=\"button-tooltip\" {...props}>\r\n            {props.message}\r\n        </Tooltip>\r\n    );\r\n\r\n    updateLayout = (e) => {\r\n      this.setState({layout: e.target.value});\r\n    }\r\n\r\n    render(){\r\n      let viewToRender = this.state.currentView === \"Enhanced\" ?\r\n                         <GraphView\r\n                             layout={this.state.layout}\r\n                             viewId={this.props.viewId}\r\n                             viewLinks={this.props.viewLinks}\r\n                             readLinks={this.props.readLinks}\r\n                             onViewClick={this.onViewClick}\r\n                             onNoteClick={(noteId)=>this.props.openContribution(noteId, \"write\")}\r\n                             updateParentLayoutProp={this.updateLayout}\r\n                         />\r\n                      :\r\n                         <LightView/>;\r\n\r\n      return(\r\n          <div className=\"container-fluid d-flex flex-column\" id=\"container-fluid-for-view-js\">\r\n              <DialogHandler />\r\n              <AttachPanel\r\n                  attachPanel={this.state.showAttachPanel}\r\n                  viewId={this.props.viewId}\r\n                  onClose={() => this.setState({showAttachPanel: false})}\r\n              />\r\n              <NewRiseAboveModal show={this.state.showRiseAboveModal} handleClose={() => this.setState({showRiseAboveModal: false})}/>\r\n              <div className=\"row\">\r\n                  {<TopNavBar currentView={this.state.currentView} onViewClick={this.onViewClick} goToDashboard={this.goToDashboard} communityTitle={this.state.communityTitle}></TopNavBar>}\r\n              </div>\r\n\r\n              <div className=\"row flex-grow-1\">\r\n\r\n                  {/* SIDEBAR */}\r\n                  <div className=\"col-md\" id=\"sticky-sidebar\">\r\n                    <div className=\"row sidebar-list\">\r\n\r\n                      {this.props.isDemo === false ? (\r\n                        <div className=\"sidebar-list-col col col-sm col-md-12\">\r\n                        <OverlayTrigger\r\n                            placement=\"top\"\r\n                            delay={{ show: 250, hide: 400 }}\r\n                            overlay={this.renderTooltip({ message: \"Create New Contribution\" })}>\r\n                        <DropdownButton drop=\"right\" className=\"dropdown-btn-parent\" title={<i className=\"fas fa-plus-circle\"></i>}>\r\n\r\n                            <Dropdown.Item onClick={() => this.props.newNote(this.props.view, this.props.communityId, this.props.author._id)}>\r\n                                New Note\r\n                            </Dropdown.Item>\r\n\r\n                            <Dropdown.Item onClick={() => this.newView()}>\r\n                                New View\r\n                            </Dropdown.Item>\r\n\r\n                            <Dropdown.Item onClick={() => this.setState({showAttachPanel: true})}>\r\n                                New Attachment\r\n                            </Dropdown.Item>\r\n\r\n                            <Dropdown.Item onClick={() => this.props.newDrawing(this.props.viewId, this.props.communityId, this.props.author._id)}>\r\n                                New Drawing\r\n                            </Dropdown.Item>\r\n                        </DropdownButton>\r\n                        </OverlayTrigger>\r\n                        </div>\r\n                      ) : null}\r\n\r\n                      {/*<div className=\"sidebar-list-col col col-sm col-md-12\">\r\n                      <OverlayTrigger\r\n                          placement=\"auto\"\r\n                          delay={{ show: 250, hide: 400 }}\r\n                          overlay={this.renderTooltip({ message: \"Exit Community\" })}>\r\n                          <Button onClick={this.goToDashboard} className=\"circle-button sidebar-btn\"><i className=\"fas fa-home\"></i></Button>\r\n                      </OverlayTrigger>\r\n                      </div>*/}\r\n\r\n                      <div className=\"sidebar-list-col col col-sm col-md-12\">\r\n                        <ViewSettingsPopover\r\n                            currentView={this.state.currentView}\r\n                            switchView={this.switchView}\r\n                        />\r\n                      </div>\r\n\r\n                      {this.state.currentView === \"Enhanced\" ? (\r\n                        <div className=\"sidebar-list-col col col-sm col-md-12\">\r\n                          <OverlayTrigger\r\n                              placement=\"auto\"\r\n                              trigger=\"click\"\r\n                              delay={{ show: 0, hide: 0 }}\r\n                              rootClose\r\n                              overlay={\r\n                                <Popover id=\"layoutPopover\">\r\n                                  <Popover.Title>Layouts (Temporary)</Popover.Title>\r\n                                  <Popover.Content>\r\n                                    <Row><Button value=\"preset\" onClick={this.updateLayout} className={this.state.layout===\"preset\" ? 'activeLayout' : ''}>Original</Button></Row>\r\n                                    <Row><Button value=\"grid\" onClick={this.updateLayout} className={this.state.layout===\"grid\" ? 'activeLayout' : ''}>Grid</Button></Row>\r\n                                    <Row><Button value=\"circle\" onClick={this.updateLayout} className={this.state.layout===\"circle\" ? 'activeLayout' : ''}>Circle</Button></Row>\r\n                                    <Row><Button value=\"spread\" onClick={this.updateLayout} className={this.state.layout===\"spread\" ? 'activeLayout' : ''}>Spread</Button></Row>\r\n                                    <Row><Button value=\"cose\" onClick={this.updateLayout} className={this.state.layout===\"cose\" ? 'activeLayout' : ''}>Cose</Button></Row>\r\n                                  </Popover.Content>\r\n                                </Popover>\r\n                              }>\r\n                              <Button className=\"circle-button pad sidebar-btn\">\r\n                                  <i className=\"fas fa-object-group\"></i>\r\n                              </Button>\r\n                          </OverlayTrigger>\r\n                        </div>\r\n                      ) : null }\r\n\r\n                    </div>\r\n                  </div>\r\n                  {/* END SIDEBAR */}\r\n\r\n                  {/* MAIN CANVAS */}\r\n                  <div className=\"col-md\" id=\"main-canvas\">\r\n                      {viewToRender}\r\n                  </div>\r\n                  {/* END MAIN CANVAS */}\r\n\r\n              </div>\r\n\r\n              {/* MODAL */}\r\n              <Modal show={this.state.showModel} onHide={() => this.handleShow(false)}>\r\n\r\n                  {this.state.showView ? (\r\n                      <>\r\n                          <Modal.Header closeButton>\r\n                              <Modal.Title>\r\n                                  <Row>\r\n                                      <Col>Views</Col>\r\n                                  </Row>\r\n                                  <Row>\r\n                                      <Col>\r\n                                          <Row>\r\n                                              <Form onSubmit={this.handleNewViewSubmit} className=\"form\">\r\n                                                  <Col>\r\n                                                      <FormGroup>\r\n                                                          <Label htmlFor=\"addView\" style={{ fontSize: \"1rem\" }}>Add View</Label>\r\n                                                          <Input type=\"text\" id=\"addView\" placeholder=\"Enter View Name\" name=\"addView\" value={this.state.addView} onChange={this.handleNewViewInput} />\r\n                                                      </FormGroup>\r\n                                                  </Col>\r\n                                                  <Col>\r\n                                                      <Button varient=\"secondary\" type=\"submit\">Add</Button>\r\n                                                  </Col>\r\n                                              </Form>\r\n                                          </Row>\r\n                                      </Col>\r\n                                  </Row>\r\n                              </Modal.Title>\r\n                          </Modal.Header>\r\n                          <Modal.Body style={{ 'maxHeight': 'calc(100vh - 210px)', 'overflowY': 'auto' }}>\r\n                              {this.props.myViews.map((obj, i) => {\r\n                                  return <Row key={i} value={obj.title} className=\"mrg-05-top\">\r\n                                      <Col><Link onClick={() => this.onViewClick(obj._id)}> {obj.title} </Link></Col>\r\n                                  </Row>\r\n                              })}\r\n                          </Modal.Body>\r\n                      </>) : null}\r\n\r\n                  <Modal.Footer>\r\n                      <Button variant=\"secondary\" onClick={() => this.handleShow(false)}>\r\n                          Close\r\n                  </Button>\r\n                  </Modal.Footer>\r\n              </Modal>\r\n              {/* END MODAL */}\r\n\r\n          </div>\r\n      )\r\n    }\r\n}\r\nView.contextType = WebSocketContext;\r\n\r\nconst mapStateToProps = (state, ownProps) => {\r\n    return {\r\n        isDemo: state.globals.isDemo,\r\n        token: state.globals.token,\r\n        currentServer: state.globals.currentServer,\r\n        communityId: state.globals.communityId,\r\n        viewId: state.globals.viewId,\r\n        view: state.globals.view,\r\n        author: state.globals.author,\r\n        myViews: state.globals.views,\r\n        socketStatus: state.globals.socketStatus,\r\n        viewLinks: state.notes.viewLinks,\r\n        readLinks: state.notes.readLinks,\r\n    }\r\n}\r\n\r\nconst mapDispatchToProps = {\r\n    setViewId,\r\n    setViewLinks,\r\n    setBuildsOn,\r\n    setReadLinks,\r\n    clearAuthors,\r\n    fetchViewCommunityData,\r\n    fetchNewViewDifference,\r\n    openContribution,\r\n    newNote,\r\n    newDrawing\r\n};\r\n\r\nexport default connect(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(View)\r\n","import React, {Component} from 'react';\r\nimport { withRouter } from 'react-router';\r\nimport { connect } from 'react-redux';\r\nimport { compose } from 'redux';\r\nimport { Modal, Button } from 'react-bootstrap';\r\nimport LoginForm from './LoginForm.jsx';\r\nimport SignUpForm from './SignUpForm.jsx';\r\nimport View from '../CommunityView/View.js';\r\nimport $ from 'jquery';\r\nimport '../../../node_modules/bootstrap/dist/js/bootstrap.bundle.min.js';\r\nimport { setDemoStatus, setGlobalToken, setCurrentServer, setCommunityId, setViewId, fetchLoggedUser } from '../../store/globalsReducer.js';\r\nimport { setViewLinks, setBuildsOn, setReadLinks } from '../../store/noteReducer.js'\r\nimport { clearAuthors } from '../../store/userReducer.js';\r\nimport { setToken, setServer } from '../../store/api';\r\nimport { getUserToken } from './../../legacy_api/user.js';\r\nimport { DEMOUSERNAME, DEMOUSERPASSWORD, DEMOSERVER, DEMOCOMMUNITYID, DEMOCOMMUNITYTITLE, DEMOVIEWID } from '../../config.js';\r\n\r\nimport './Login.css';\r\nimport sample_view from './../../assets/sample_view.gif';\r\n\r\nclass Login extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      modalContent: null,\r\n      showModal: false,\r\n      modalDialogClassName: \"login-modal-dialog\",\r\n    }\r\n\r\n    this.handleShow = this.handleShow.bind(this);\r\n    this.handleClose = this.handleClose.bind(this);\r\n    this.toggleFullScreenModal = this.toggleFullScreenModal.bind(this);\r\n  }\r\n\r\n  handleShow(){\r\n    this.setState({showModal: true});\r\n    var self = this;\r\n    var demoTokenPromise = getUserToken(DEMOUSERNAME, DEMOUSERPASSWORD, DEMOSERVER);\r\n    demoTokenPromise.then(function(result) {\r\n      var token = result.token;\r\n      setServer(DEMOSERVER);\r\n      setToken(token);\r\n      sessionStorage.setItem('token', token);\r\n      sessionStorage.setItem('communityId', DEMOCOMMUNITYID);\r\n      sessionStorage.setItem('viewId', DEMOVIEWID);\r\n      self.props.setDemoStatus(true);\r\n      self.props.setGlobalToken(token);\r\n      self.props.fetchLoggedUser();\r\n      self.props.setCommunityId(DEMOCOMMUNITYID);\r\n      self.props.setViewId(DEMOVIEWID);\r\n      self.props.setCurrentServer(DEMOSERVER);\r\n      self.setState({\r\n        modalContent: <View demoCommunityTitle={DEMOCOMMUNITYTITLE}></View>\r\n      })\r\n    });\r\n  }\r\n\r\n  handleClose(){\r\n    // clear the redux store values from the demo\r\n    this.props.setDemoStatus(false);\r\n    this.props.setViewLinks([]);\r\n    this.props.setBuildsOn([]);\r\n    this.props.setReadLinks([]);\r\n    this.props.clearAuthors([]);\r\n    this.setState({\r\n      showModal: false,\r\n      modalContent: null,\r\n      modalDialogClassName: \"login-modal-dialog\",\r\n    });\r\n  }\r\n\r\n  toggleFullScreenModal(){\r\n    var newClass = \"\";\r\n    if(this.state.modalDialogClassName === \"login-modal-dialog\"){ newClass = \"login-modal-dialogfullscreen\"; }\r\n    else if(this.state.modalDialogClassName === \"login-modal-dialogfullscreen\"){ newClass = \"login-modal-dialog\"; }\r\n    this.setState({modalDialogClassName: newClass});\r\n  }\r\n\r\n  componentDidMount(){\r\n    // enables the popover for refreshing servers on login tool tip\r\n    $('[data-toggle=\"tooltip\"]').tooltip()\r\n    $('[data-toggle=\"popover\"]').popover()\r\n    if($(window).width() <= 768) {\r\n      document.getElementById(\"popover\").setAttribute(\"data-trigger\", \"focus\");\r\n    }\r\n  }\r\n\r\n  render() {\r\n    let formToRender;\r\n    if(this.props.currentLoginForm === \"Login\"){\r\n      formToRender = <LoginForm></LoginForm>;\r\n    } else if(this.props.currentLoginForm === \"SignUp\"){\r\n      formToRender = <SignUpForm></SignUpForm>;\r\n    }\r\n\r\n    return(\r\n      <div className='container-fluid login-main'>\r\n\r\n        <div className = \"row login-row\">\r\n\r\n            <div className = \"col-md-6 login-col login\" id = \"login\">\r\n              {formToRender}\r\n            </div>\r\n\r\n\r\n            <div className = \"col-md-6 login-about\">\r\n\r\n              <div className = \"login-about-wrapper\">\r\n                <h1>What is knowledgeforum.org?</h1>\r\n                <p>A knowledge forum is an electronic group workspace designed to support the process of knowledge building.\r\n                    There are multiple installations of knowledge forums hosted by many universities and private entities all over the world.\r\n                    Knowledgeforum.org unites all of these installations and hence the stakeholders to help confluence knowledge building research,\r\n                    widen the reach of the tool & provide a central location for all global stakeholders.</p>\r\n\r\n                  <div className=\"login-overlay-container login-demo-image\" onClick={this.handleShow} id=\"demo-image-container\">\r\n                    <img className=\"d-block w-100\" src={sample_view} alt={\"First slide\"}></img>\r\n                    <div className=\"login-overlay\">\r\n                        <div className=\"login-overlay-text\">Demo a Knowledge Forum</div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <Modal dialogClassName={this.state.modalDialogClassName} show={this.state.showModal} onHide={this.handleClose}>\r\n                    <Modal.Header>\r\n                      <Modal.Title className=\"login-modal-title\">\r\n                          Knowledge Forum Demo\r\n                          <a href=\"/#\" className=\"kf-demo-modaltitle-btn\" onClick={this.handleClose}><i className=\"fas fa-times\"></i></a>\r\n                          <a href=\"/#\" className=\"kf-demo-modaltitle-btn\" onClick={this.toggleFullScreenModal}><i className=\"fas fa-expand-alt\"></i></a>\r\n                      </Modal.Title>\r\n                    </Modal.Header>\r\n                    <Modal.Body className=\"login-modal-body\" style={{padding: 0}}>\r\n                      {this.state.modalContent}\r\n                    </Modal.Body>\r\n                    <Modal.Footer>\r\n                      <Button variant=\"primary\" onClick={this.handleClose} className=\"login-modal-btn\" style={{'backgroundColor': '#2d5085'}}>\r\n                        Close\r\n                      </Button>\r\n                    </Modal.Footer>\r\n                </Modal>\r\n\r\n              </div>\r\n            </div>\r\n\r\n\r\n          </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state, ownProps) => {\r\n    return {\r\n        currentLoginForm: state.globals.currentLoginForm,\r\n    }\r\n}\r\n\r\nconst mapDispatchToProps = {\r\n    setDemoStatus,\r\n    setGlobalToken,\r\n    setCurrentServer,\r\n    setCommunityId,\r\n    setViewId,\r\n    setViewLinks,\r\n    setBuildsOn,\r\n    setReadLinks,\r\n    clearAuthors,\r\n    fetchLoggedUser,\r\n}\r\n\r\nexport default compose(\r\n    withRouter,\r\n    connect(mapStateToProps, mapDispatchToProps)\r\n)(Login)\r\n","/*\r\n* THIS FILE PROVIDES HELPER FUNCTIONS FOR LOGIN COMPONENT\r\n*/\r\nimport {getServerName, extractTokenFromStorage} from '../../config.js';\r\nimport {getUserInfo, getUserCommunities} from '../../legacy_api/user.js';\r\nimport {getCommunities, postCommunityRegistration} from '../../legacy_api/community.js';\r\n\r\n// adds the users servers to the side bar\r\nexport function appendUserServers(dashboard_component){\r\n  var uname = localStorage.getItem(\"Username\");\r\n  var data = JSON.parse(localStorage.getItem(uname));\r\n  var servers = [];\r\n\r\n  dashboard_component.setState({username: uname});\r\n\r\n  for(var i = 0; i < data.length; i++){\r\n    var serverName = getServerName(data[i][0]);\r\n\r\n    // set the last active server as the default\r\n    if(data[i][2] === \"active\"){\r\n      dashboard_component.setState({currentServerURL: data[i][0]});\r\n      dashboard_component.setState({currentServerName: getServerName(data[i][0])});\r\n      dashboard_component.setState({token: data[i][1]});\r\n      servers.push({\r\n        name: serverName,\r\n        class: 'active',\r\n        url: data[i][0]\r\n      });\r\n      loadServer(data[i][0], dashboard_component);\r\n    } else {\r\n      servers.push({\r\n        name: serverName,\r\n        class: '',\r\n        url: data[i][0]\r\n      });\r\n    }\r\n  }\r\n\r\n  dashboard_component.setState({serverList: servers});\r\n}\r\n\r\n\r\n// replaces the \"join community\" and \"my knowledge building communities\" sections\r\n// with the relevant information for the specified server\r\nexport function loadServer(server, dashboard_component){\r\n  var token = extractTokenFromStorage(server);\r\n\r\n  // LOAD USER COMMUNITY DATA AND UPDATE REACT STATE\r\n  var userCommunitiesData = getUserCommunities(token, server);\r\n  userCommunitiesData.then(function(result) {\r\n    result.sort((a, b) => compareStrings(a._community.title, b._community.title));\r\n    updateUserCommunities(result, server, dashboard_component);\r\n  });\r\n\r\n  // LOAD USER DATA AND UPDATE REACT STATE\r\n  var userInfo = getUserInfo(token, server);\r\n  userInfo.then(function(result) {\r\n    if(result.error === true){\r\n      tokenErrorHandler();\r\n    } else {\r\n      dashboard_component.setState({name: result.firstName + ' ' + result.lastName});\r\n      dashboard_component.setState({userId: result._id});\r\n    }\r\n\r\n  });\r\n\r\n  // LOAD SERVER COMMUNITY DATA AND UPDATE REACT STATE\r\n  var serverCommunitiesData = getCommunities(token, server);\r\n  serverCommunitiesData.then(function(result) {\r\n    result.sort((a, b) => compareStrings(a.title, b.title));\r\n    updateCommunities(result, dashboard_component);\r\n  });\r\n\r\n}\r\n\r\n// updates the server community data react state\r\nfunction updateCommunities(result, dashboard_component){\r\n  var serverCommunityData = [];\r\n  for(var i = 0; i < result.length; i++){\r\n    var title = result[i].title;\r\n    var communityId = result[i]._id;\r\n    serverCommunityData.push({title: title, communityId: communityId});\r\n  }\r\n\r\n  const community_options = serverCommunityData.map(c => ({\r\n    \"value\": c.communityId,\r\n    \"label\": c.title\r\n  }));\r\n\r\n  dashboard_component.setState({serverCommunityData: community_options});\r\n}\r\n\r\n\r\n// updates the user community data react state\r\nfunction updateUserCommunities(data, server, dashboard_component) {\r\n  var userCommunityData = [];\r\n\r\n  // for loop to append the users communities\r\n  for(var i = 0; i < data.length; i++){\r\n    if(data[i] && data[i]._id){\r\n      userCommunityData.push({\r\n          title: data[i]._community.title,\r\n          server: dashboard_component.state.currentServerURL,\r\n          token: dashboard_component.state.token,\r\n          communityId: data[i].communityId\r\n      });\r\n    }\r\n  }\r\n\r\n  dashboard_component.setState({userCommunityData: userCommunityData});\r\n}\r\n\r\n\r\n// registers the user for a community\r\nexport function joinCommunity(userId, server, registrationKey, communityId, dashboard_component){\r\n  var token = extractTokenFromStorage(server);\r\n  var ref = dashboard_component;\r\n  var promise = postCommunityRegistration(token, communityId, server, userId, registrationKey);\r\n  promise.then(result => {\r\n    document.getElementById('communityKey').value = '';\r\n    if(result[0].status !== 201){\r\n      ref.setState({joinCommunityErrorMessage: \"Registration key does not match or you are already registered.\"});\r\n    } else {\r\n      ref.setState({joinCommunityErrorMessage: \"\"});\r\n      loadServer(server, ref);\r\n    }\r\n  })\r\n}\r\n\r\n\r\n// function to handle an expired/invalid user token\r\n// called if response status is 401 (might be errors other than invalid token)\r\nfunction tokenErrorHandler(){\r\n  alert(\"User authorization token expired\");\r\n  logout();\r\n}\r\n\r\n\r\n// clears local storage of the username and their user tokens and redircts to the login page\r\nexport function logout(dashboard_component){\r\n  var uname = localStorage.getItem(\"Username\");\r\n  var userinfo = JSON.parse(localStorage.getItem(uname));\r\n\r\n  if(uname === null || userinfo === null){\r\n    localStorage.clear();\r\n  } else {\r\n    for(var i in userinfo){\r\n      userinfo[i][1] = \"\";\r\n    }\r\n    localStorage.setItem(uname, JSON.stringify(userinfo));\r\n    localStorage.removeItem(\"Username\");\r\n  }\r\n\r\n  dashboard_component.props.history.push('/');\r\n}\r\n\r\n\r\n// function to add to buttons to toggle the side bar\r\nexport function toggleSidebar(){\r\n  var div = document.getElementById('wrapper');\r\n  if (div.className === \"d-flex\") {\r\n    div.className = \"d-flex toggled\";\r\n  } else {\r\n    div.className = \"d-flex\";\r\n  }\r\n}\r\n\r\n\r\n// function to return which string is higher alphabetically\r\n// 1 if a is higher, -1 if b is higher, 0 if a == b\r\nfunction compareStrings(a, b){\r\n    if(a.toLowerCase() < b.toLowerCase()) { return -1; }\r\n    if(a.toLowerCase() > b.toLowerCase()) { return 1; }\r\n    return 0;\r\n}\r\n","// returns a promise that on fullfillment returns all the communities from the specified server\r\nexport function getCommunities(token, server) {\r\n  return fetch(server + 'api/communities', {\r\n    method: \"GET\",\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': 'Bearer ' + token\r\n    },\r\n  }).then(function(response) {\r\n      if(response.status !== 200){\r\n        console.log(\"Error: \" + server + 'api/communities');\r\n        console.log(response);\r\n      }\r\n      return response.json();\r\n  }).then(function(body) {\r\n      return (body);\r\n  }).catch(function(error) {\r\n      return (\"Error:\", error);\r\n  });\r\n}\r\n\r\n\r\n// returns a promise that on fullfillment returns all the views from the specified community on the specified server\r\nexport function getCommunityViews(token, communityId, server){\r\n  return fetch(server + 'api/communities/' + communityId + '/views', {\r\n    method: \"GET\",\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': 'Bearer ' + token\r\n    },\r\n  }).then(function(response) {\r\n      if(response.status !== 200){\r\n        console.log(\"Error: \" + server + 'api/communities/' + communityId + '/views');\r\n        console.log(response);\r\n      }\r\n      return response.json();\r\n  }).then(function(body) {\r\n      return (body);\r\n  }).catch(function(error) {\r\n      return (\"Error:\", error);\r\n  });\r\n}\r\n\r\n\r\n// returns a promise that on fullfillment returns the welcome view from the specified community on the specified server\r\nexport function getCommunityWelcomeView(token, communityId, server){\r\n  return fetch(server + 'api/communities/' + communityId + '/views', {\r\n    method: \"GET\",\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': 'Bearer ' + token\r\n    },\r\n  }).then(function(response) {\r\n      if(response.status !== 200){\r\n        console.log(\"Error: \" + server + 'api/communities/' + communityId + '/views');\r\n        console.log(response);\r\n      }\r\n      return response.json();\r\n  }).then(function(body) {\r\n      return (body[0]);\r\n  }).catch(function(error) {\r\n      return (\"Error:\", error);\r\n  });\r\n}\r\n\r\n\r\n// returns a promise that on fullfillment returns the authors from the specified community on the specified server\r\nexport function getCommunityAuthors(token, communityId, server){\r\n  return fetch(server + 'api/communities/' + communityId + '/authors', {\r\n    method: \"GET\",\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': 'Bearer ' + token\r\n    },\r\n  }).then(function(response) {\r\n    if(response.status !== 200){\r\n      console.log(\"Error: \" + server + 'api/communities/' + communityId + '/authors');\r\n      console.log(response);\r\n    }\r\n    return response.json();\r\n  }).then(function(body) {\r\n    return (body);\r\n  }).catch(function(error) {\r\n    return (\"Error:\", error);\r\n  });\r\n}\r\n\r\n\r\n// registers a given user to the specified community on the specified server\r\nexport function postCommunityRegistration(token, communityId, server, userId, registrationKey){\r\n  var body = {\r\n    'communityId': communityId,\r\n    'registrationKey': registrationKey,\r\n    'userId': userId\r\n  };\r\n\r\n  return fetch(server + 'api/authors', {\r\n    method: \"POST\",\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': 'Bearer ' + token\r\n    },\r\n    body: JSON.stringify(body),\r\n  }).then(function(response) {\r\n      if(response.status !== 200){\r\n        console.log(\"Error: \" + server + 'api/authors');\r\n        console.log(response);\r\n        return response;\r\n      } else {\r\n        return response.json();\r\n      }\r\n  }).then(function(body) {\r\n      return (\"Success:\", [body, server]);\r\n  }).catch(function(error) {\r\n      return (\"Error:\", error);\r\n  });\r\n}\r\n","import React, {Component} from 'react';\r\nimport { connect } from 'react-redux'\r\nimport Select from 'react-select';\r\n\r\nimport { setGlobalToken, setCurrentServer, setCommunityId, setViewId, fetchLoggedUser } from '../../store/globalsReducer.js';\r\n\r\nimport $ from 'jquery';\r\nimport { setToken, setServer } from '../../store/api';\r\nimport { getCommunityWelcomeView } from '../../legacy_api/community.js';\r\nimport { appendUserServers, loadServer, joinCommunity, toggleSidebar, logout } from './Dashboard_helper.js';\r\nimport { getServerURL } from '../../config.js';\r\n\r\nimport './Dashboard.css';\r\n\r\nclass Dashboard extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      token: null,\r\n      username: null,\r\n      name: null,\r\n      userId: null,\r\n      currentServerURL: null,\r\n      currentServerName: null,\r\n      serverList: [],\r\n      userCommunityData: [],\r\n      serverCommunityData: [],\r\n      selectedCommunityToJoin: null,\r\n      communityRegistrationKey: null,\r\n      joinCommunityErrorMessage: null,\r\n      viewType: JSON.parse(localStorage.getItem(localStorage.getItem('Username')))[0][3]\r\n    }\r\n\r\n    this.enterCommunity = this.enterCommunity.bind(this);\r\n  }\r\n\r\n  inputChangeHandler = (event) => {\r\n    let name = event.target.name;\r\n    let value = event.target.value;\r\n    this.setState({[name]: value});\r\n  }\r\n\r\n  serverSelectHandler = (event) => {\r\n    var domElement = event.target;\r\n    var serverName = event.target.innerText;\r\n    var serverURL = getServerURL(event.target.innerText);\r\n    var serverTokenPairs = JSON.parse(localStorage.getItem(this.state.username));\r\n\r\n    this.setState({currentServerURL: getServerURL(serverName)});\r\n    this.setState({currentServerName: serverName});\r\n\r\n    // handles active tag in html\r\n    $(domElement).addClass('active').siblings().removeClass('active');\r\n\r\n    // handles the active tag in local storage\r\n    var activeServerURL = getServerURL(serverName);\r\n    var serverTokenPair = [];\r\n    for(var i in serverTokenPairs){\r\n      var server = serverTokenPairs[i][0];\r\n      var token = serverTokenPairs[i][1];\r\n      var status = (server === activeServerURL) ? \"active\" : \"inactive\";\r\n      var viewType = serverTokenPairs[i][3];\r\n      if(server === activeServerURL) { this.setState({token: serverTokenPairs[i][1]}); }\r\n      serverTokenPair.push([server, token, status, viewType]);\r\n    }\r\n    localStorage.setItem(this.state.username, JSON.stringify(serverTokenPair));\r\n\r\n    // loads the server specific data\r\n    loadServer(serverURL, this);\r\n  }\r\n\r\n  handleViewChange = (event) => {\r\n    var selectedViewType = {value: event.value, label: event.label};\r\n    this.setState({viewType: selectedViewType});\r\n\r\n    // handles the view type preference in local storage\r\n    var serverTokenPairs = JSON.parse(localStorage.getItem(this.state.username));\r\n    var newServerTokenPair = [];\r\n    for(var i in serverTokenPairs){\r\n      newServerTokenPair.push([serverTokenPairs[i][0], serverTokenPairs[i][1], serverTokenPairs[i][2], selectedViewType]);\r\n    }\r\n    localStorage.setItem(this.state.username, JSON.stringify(newServerTokenPair));\r\n  }\r\n\r\n  handleCommunityDropDownChange = (event) => {\r\n    this.setState({selectedCommunityToJoin: {value: event.value, label: event.label}});\r\n  }\r\n\r\n  enterCommunity(c){\r\n    var welcomeViewId = getCommunityWelcomeView(c.token, c.communityId, c.server);\r\n    var self = this;\r\n\r\n    welcomeViewId.then(function(response){\r\n      if(self.state.viewType.value === \"Classic\") {\r\n        var aTag = document.createElement('a');\r\n        aTag.href = c.server + 'auth/jwt?token=' + c.token + '&redirectUrl=/view/' + response._id;\r\n        aTag.target = \"_blank\";\r\n        document.body.appendChild(aTag);\r\n        aTag.click();\r\n      } else if(self.state.viewType.value === \"Enhanced\" || self.state.viewType.value === \"Light\") {\r\n        setServer(c.server);\r\n        setToken(c.token);\r\n        sessionStorage.setItem('token', c.token);\r\n        sessionStorage.setItem('communityId', c.communityId);\r\n        sessionStorage.setItem('viewId', response._id);\r\n        self.props.setGlobalToken(c.token);\r\n        self.props.fetchLoggedUser();\r\n        self.props.setCommunityId(c.communityId);\r\n        self.props.setViewId(response._id);\r\n        self.props.setCurrentServer(c.server);\r\n        self.props.history.push({\r\n          pathname: `/view/${response._id}`,\r\n          state: { currentView: self.state.viewType.value, communityTitle: c.title }\r\n        });\r\n      }\r\n\r\n    }).catch(function(error){\r\n      console.log(error);\r\n    });\r\n  }\r\n\r\n  componentDidMount() {\r\n    appendUserServers(this);\r\n  }\r\n\r\n  render(){\r\n    return (\r\n      <div className=\"d-flex\" id=\"wrapper\">\r\n\r\n        <div className=\"sidebar-custom dashboard-sidebar-custom\" id=\"sidebar-wrapper\">\r\n          <h1 className=\"sidebar-heading dashboard-sidebar-heading\">Your Servers:</h1>\r\n          <div className=\"list-group list-group-flush\">\r\n            <ul className = \"dashboard-server-list\" id = \"server-list\">{this.state.serverList.map((s) =>\r\n                    <li key={s.name} onClick={this.serverSelectHandler} className={s.class}>{s.name}</li>)}</ul>\r\n            <div className=\"dashboard-viewDropDownContainer\">\r\n              <p>View Type:</p>\r\n              <Select isSearchable={false}\r\n                      value = {this.state.viewType}\r\n                      onChange = {this.handleViewChange}\r\n                      options={[\r\n                        { value: 'Classic', label: 'Classic' },\r\n                        { value: 'Enhanced', label: 'Enhanced' },\r\n                        { value: 'Light', label: 'Light' },\r\n                      ]} />\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div id=\"page-content-wrapper\">\r\n\r\n          <nav className=\"navbar navbar-expand-lg navbar-light bg-light border-bottom dashboard-navbar\">\r\n            <button className=\"d-none d-md-block btn btn-primary dashboard-select-server\" id=\"menu-toggle\" onClick={toggleSidebar}>Select Server</button>\r\n            <button className=\"d-md-none btn btn-primary dashboard-select-server\" id=\"menu-toggle\" onClick={toggleSidebar}><i className=\"fas fa-server\"></i></button>\r\n            <div className=\"dashboard-currentInfo\" id=\"currentInfo\">{this.state.name}<div></div>{this.state.currentServerName}</div>\r\n\r\n            <button className=\"navbar-toggler\" type=\"button\" data-toggle=\"collapse\" data-target=\"#navbarSupportedContent\" aria-controls=\"navbarSupportedContent\" aria-expanded=\"false\" aria-label=\"Toggle navigation\">\r\n              <span className=\"navbar-toggler-icon\"></span>\r\n            </button>\r\n\r\n            <div className=\"collapse navbar-collapse\" id=\"navbarSupportedContent\">\r\n              <ul className=\"navbar-nav ml-auto mt-2 mt-lg-0\">\r\n                <li className=\"nav-item\">\r\n                  <button className=\"nav-link dashboard-nav-link btn btn-link\" href=\"\" id=\"logout\" onClick={() => logout(this)}>Logout</button>\r\n                </li>\r\n              </ul>\r\n            </div>\r\n          </nav>\r\n\r\n          <div className=\"container-fluid\" id=\"dashboard-mainContentContainer\">\r\n            <div className = \"row\">\r\n\r\n              <div className = \"col-md-6 dashboard-mainContentCol userCommunitiesTableCol\">\r\n                <h1>My Knowledge Building Communities</h1>\r\n                <table className=\"dashboard-userCommunities table\" id = \"userCommunities\">\r\n                  <tbody>\r\n                    {this.state.userCommunityData.map((c) => {\r\n                        return(\r\n                          <tr key={c.communityId} onClick={() => this.enterCommunity(c)}>\r\n                            <td className=\"dashboard-userCommunities-row\">\r\n                              {c.title}<button className=\"dashboard-enterButton\" type=\"button\"><i className=\"fas fa-door-open\"></i></button>\r\n                            </td>\r\n                          </tr>)\r\n                    })}\r\n                  </tbody>\r\n                </table>\r\n              </div>\r\n\r\n              <div className = \"col-md-6 dashboard-mainContentCol\">\r\n                <h1>Join Community</h1>\r\n                <form className=\"col-lg-8 col-md-10 col-sm-12 dashboard-joinCommunityForm\" id = \"joinCommunityForm\" autoComplete=\"off\">\r\n\r\n                  <label htmlFor=\"server\">Community:</label><br></br>\r\n                  <Select value={this.state.selectedCommunityToJoin}\r\n                          className=\"dashboard-communityChoiceDropdown\"\r\n                          id=\"communityChoiceDropdown\"\r\n                          options={this.state.serverCommunityData}\r\n                          onChange={this.handleCommunityDropDownChange}\r\n                          required>\r\n                  </Select><br></br>\r\n\r\n                  <label htmlFor=\"communityKey\">Community Registration Key:</label><br></br>\r\n                  <input className=\"dashboard-communityKeyInput\" type=\"text\" id=\"communityKey\" name=\"communityRegistrationKey\" required onChange={this.inputChangeHandler}></input><br></br>\r\n\r\n                  <div>\r\n                    <p style={{color: 'red'}} id = \"errorMessage\">{this.state.joinCommunityErrorMessage}</p>\r\n                  </div>\r\n\r\n                  <input className = \"dashboard-joinButton\" type=\"button\" value=\"Join\"\r\n                      onClick={() => joinCommunity(this.state.userId, this.state.currentServerURL, this.state.communityRegistrationKey, this.state.selectedCommunityToJoin.value, this)} id=\"joinCommunityButton\"></input>\r\n\r\n                </form>\r\n              </div>\r\n\r\n            </div>\r\n\r\n          </div>\r\n        </div>\r\n\r\n\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nconst mapDispatchToProps = {\r\n    setGlobalToken,\r\n    setCurrentServer,\r\n    setCommunityId,\r\n    setViewId,\r\n    fetchLoggedUser,\r\n}\r\n\r\nexport default connect(\r\n    null,\r\n    mapDispatchToProps,\r\n)(Dashboard)\r\n","import React from 'react'\r\nimport {Route, Redirect} from 'react-router-dom'\r\nimport { useSelector } from 'react-redux';\r\n\r\nconst ProtectedRoute = ({ component: Component, ...rest }) => {\r\n    const loggedIn = useSelector(state=> state.globals.isAuthenticated);\r\n    return (<Route {...rest} render={(props) => (\r\n       loggedIn ?\r\n        <Component {...props} />\r\n        : <Redirect to='/' />\r\n    )} />)\r\n}\r\nexport default ProtectedRoute;\r\n","import React from 'react';\r\nimport { BrowserRouter as Router, Switch, Route } from 'react-router-dom';\r\nimport { useDispatch } from 'react-redux';\r\nimport ReactNotification from 'react-notifications-component';\r\nimport Login from './components/Login/Login.jsx';\r\nimport Dashboard from './components/Dashboard/Dashboard.jsx';\r\nimport View from './components/CommunityView/View.js'\r\nimport { setGlobalToken, setCurrentServer, fetchLoggedUser } from './store/globalsReducer.js'\r\nimport { setToken, setServer } from './store/api.js'\r\nimport { getLoginData } from './components/Login/Login_helper.js'\r\nimport ProtectedRoute from './ProtectedRoute.jsx'\r\nimport 'react-notifications-component/dist/theme.css'\r\nfunction App() {\r\n\r\n    const dispatch = useDispatch();\r\n    //Check if user loged in, if logged in set token,server and user info in store\r\n    const [server, token, ] = getLoginData();\r\n    if (token) {\r\n        setToken(token);\r\n        setServer(server);\r\n        dispatch(setGlobalToken(token))\r\n        dispatch(setCurrentServer(server))\r\n        dispatch(fetchLoggedUser())\r\n    }\r\n\r\n    return (\r\n        <div id=\"sub-root\">\r\n            <ReactNotification />\r\n            <Router>\r\n                <Switch>\r\n                    <Route exact path=\"/\" component={Login}/>\r\n                    <ProtectedRoute exact path=\"/dashboard\" component={Dashboard}></ProtectedRoute>\r\n                    <ProtectedRoute path=\"/view/:viewId\" component={View}></ProtectedRoute>\r\n                    <ProtectedRoute component={Dashboard}></ProtectedRoute>\r\n                </Switch>\r\n            </Router>\r\n        </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport 'bootstrap/dist/css/bootstrap.min.css';\r\nimport App from './App';\r\nimport { Provider } from 'react-redux';\r\nimport store from './store/store';\r\nimport WebSocketProvider from './WebSocket.js'\r\n\r\nReactDOM.render(\r\n    <Provider store={store}>\r\n        <WebSocketProvider>\r\n            <App />\r\n        </WebSocketProvider>\r\n    </Provider>,\r\n    document.getElementById('root')\r\n);\r\n"],"sourceRoot":""}